/*!
     * jQuery Tiny Pub/Sub - v0.6 - 1/10/2011
     * http://benalman.com/
     *
     * Copyright (c) 2010 "Cowboy" Ben Alman
     * Dual licensed under the MIT and GPL licenses.
     * http://benalman.com/about/license/
     *
     * We purposely use an older version of the Tiny Pub/Sub implementation
     * because we want to keep API parity with existing code.
     * Newer versions meant the 'event' object would be passed as the first
     * argument to the subscriber/callback and this meant changing all our
     * EventEmitter code. I decided it was best to avoid that issue and use
     * an older version whose only difference is to strip off the first
     * argument so as to result in a true refactoring where we don't tamper
     * with the interface, just the implementation.
     */

//Modernizr is available under the MIT license

/**
 * @license
 * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>
 * Build: `lodash include="debounce"`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */

define("vendor/events/pubsub",["jquery"],function(e){var t=e({});e.eventHistory=[],e.on=function(n,r){function i(){return r.apply(this,Array.prototype.slice.call(arguments,1))}i.guid=r.guid=r.guid||(e.guid?e.guid++:e.event.guid++),t.on(n,i)},e.off=function(){t.off.apply(t,arguments)},e.emit=function(){e.eventHistory.push(arguments[0]),t.trigger.apply(t,arguments)}}),define("module/bootstrap",["jquery","config","vendor/events/pubsub"],function(e,t){var n={pubsub:e,$:e,config:t,window:window};return n}),define("module/translator",[],function(){function n(n,r){if(!n)throw t.TRANSLATION_UNDEFINED;if(!e(n))throw t.TRANSLATION_NOT_AN_OBJECT;this.translation=n,this.locale=r||"en-GB"}var e=function(e){return Object.prototype.toString.call(e)==="[object Object]"},t={TRANSLATION_UNDEFINED:"Translator Error : Translator expects a translation object as its first parameter",TRANSLATION_NOT_AN_OBJECT:"Translator Error : Translator expects an object literal as its first parameter"};return n.prototype.get=function(e){return this.translation[e]?this.translation[e]:null},n.prototype.getLocale=function(){return this.locale},n}),define("translator",["module/translator","config","translation"],function(e,t,n){return new e(n,t.locale)}),define("module/ajaxForm/ajaxForm",["module/bootstrap","config","translator"],function(e,t,n){var r=e.$,i=function(){this.errorMessage=n.get("thereWasAProblem");var t=this;e.pubsub.on("ajaxForm:submit",function(e,n){t.submit(e,n)})};return i.prototype.submit=function(t,n){e.pubsub.emit("ajaxForm:renderWait"),r.ajax({url:n+".json",dataType:"json",type:"POST",data:t,success:function(t){var n=t.body;switch(t.reply){case"success":e.pubsub.emit("ajaxForm:success",[n]);break;case"feedback":e.pubsub.emit("ajaxForm:feedback",[n]);break;default:e.pubsub.emit("ajaxForm:error",[n])}},error:r.proxy(function(t){e.pubsub.emit("ajaxForm:error",[this.errorMessage,t])},this)})},i}),define("module/ajaxForm/ajaxFormView",["module/bootstrap","translator"],function(e,t){function n(t){var n=e.$(t.parentNode);e.$(t).val()?n.addClass("input-has-content"):n.removeClass("input-has-content")}function r(n){this.translator=t,this.elm=e.$(n),this.url=this.elm.attr("action"),this.fields=e.$("input, textarea",this.elm),this.attach()}return r.prototype={attach:function(){var t=this;this.elm.on("submit",function(e){e.preventDefault(),t.send()});var n=function(t){var n=e.$(t).parent(),r=e.$(t).val()!=="";n.toggleClass("input-has-content",r)},r=function(t){var r=t.target;if(!!e.$(r).prop("nodeName").match(/(INPUT|TEXTAREA)/)){var i=t.type.toLowerCase()==="focus"?"add":"remove";e.$(r).parent().toggleClass("input-has-focus",i),n(r)}};return this.fields.on("focus",r),this.fields.on("blur",r),this.fields.on("keyup",function(t){var r=t.target;!e.$(r).prop("nodeName").match(/(INPUT|TEXTAREA)/)||n(r)}),e.pubsub.on("ajaxForm:success",function(n){t.elm.removeClass("feedback"),t.elm.addClass("successful-submit"),t.elm.before('<div id="successMsg"><p>'+n+'</p><button><span class="cta">'+t.translator.get("sendAnotherComment")+"</span></button></div>"),e.$("#successMsg button").on("click",function(){e.pubsub.emit("ajaxForm:showForm")})}),e.pubsub.on("ajaxForm:feedback",function(r){e.$("p.feedback",this.elm).remove(),t.elm.addClass("feedback"),e.pubsub.emit("ajaxForm:stopWait"),e.$(t.fields).each(function(t,i){var s=e.$(i).attr("name"),o=e.$(i).val().trim();r[s]!==undefined&&(e.$(i).val(o),e.$(i).parent().addClass("invalid"),n(i),e.$(i.parentNode).append('<p class="feedback">'+r[i.name]+"</p>"))})}),e.pubsub.on("ajaxForm:error",function(n,r){t.elm.removeClass("feedback"),t.elm.addClass("error"),e.pubsub.emit("ajaxForm:stopWait"),t.elm.before('<div id="errorMsg"><p>'+n+"</p><button><span>"+t.translator.get("retry")+"</span></button>"),e.$("#errorMsg button").on("click",function(){t.send()})}),e.pubsub.on("ajaxForm:showForm",function(){e.$("#"+t.elm.attr("id")+" fieldset p").remove(),t.fields.each(function(t,r){e.$(r).val(""),n(r)}),t.elm.removeClass("successful-submit").removeClass("error"),e.$("#successMsg, #errorMsg").remove()}),e.pubsub.on("ajaxForm:stopWait",function(){t.elm.removeClass("wait"),e.$(".spin",t.elm).remove()}),e.pubsub.on("ajaxForm:renderWait",function(){t.elm.addClass("wait"),e.$("fieldset",t.elm).removeClass("invalid"),e.$("#successMsg, #errorMsg").remove(),t.elm.append('<div class="spin"></div>')}),this},send:function(){var t=[];this.fields.each(function(n,r){var i=e.$(r);t.push(i.attr("name")+"="+i.val())}),e.pubsub.emit("ajaxForm:submit",[t.join("&"),this.url])}},r}),define("vendor/analytics/siteCatalyst",["module/bootstrap","config"],function(e,t){function n(n){function r(e){var t=new RegExp("[\\&|\\?]"+e+"=([^\\&\\#]+)"),n=window.location.search.match(t);return n?n[1]:""}function m(e,t){var n=window.config||!1;if(n){if(e.match(/\./i)){var r=e.split("."),i=n,s=0;for(s=0;s<r.length;s++){if(!i[r[s]])return t?t:"";i=i[r[s]]}return i}return n[e]?n[e]:t?t:""}return t?t:""}function g(){var e=0,t=400,n=600,r=1008,i=document.documentElement.clientWidth,s="group1";return i>=t&&i<n?s="group2":i>=n&&i<r?s="group3":i>=r&&(s="group4"),s}function b(e){e.eVar0=e.getQueryParam("ocid"),e.getQueryParam("scope")!==""&&e.getQueryParam("q")!==""&&(e.eVar1=e.getQueryParam("q"),e.events=e.apl(e.events,"event1",",",1))}function w(){var e=this;e.version="1.2.1";var t=window;t.s_c_in||(t.s_c_il=[],t.s_c_in=0),e._il=t.s_c_il,e._in=t.s_c_in,e._il[e._in]=e,t.s_c_in++,e._c="s_c";var n=t.fb;n||(n=null);var r=t,i,s;try{i=r.parent;for(s=r.location;i&&i.location&&s&&""+i.location!=""+s&&r.location&&""+i.location!=""+r.location&&i.location.host==s.host;)r=i,i=r.parent}catch(o){}e.Sa=function(e){try{console.log(e)}catch(t){}},e.ja=function(e){return""+parseInt(e)==""+e},e.replace=function(e,t,n){return!e||e.indexOf(t)<0?e:e.split(t).join(n)},e.escape=function(t){var n,r;if(!t)return t;t=encodeURIComponent(t);for(n=0;n<7;n++)r="+~!*()'".substring(n,n+1),t.indexOf(r)>=0&&(t=e.replace(t,r,"%"+r.charCodeAt(0).toString(16).toUpperCase()));return t},e.unescape=function(t){if(!t)return t;t=t.indexOf("+")>=0?e.replace(t,"+"," "):t;try{return decodeURIComponent(t)}catch(n){}return unescape(t)},e.Ja=function(){var n=t.location.hostname,r=e.fpCookieDomainPeriods,i;r||(r=e.cookieDomainPeriods);if(n&&!e.ca&&!/^[0-9.]+$/.test(n)&&(r=r?parseInt(r):2,r=r>2?r:2,i=n.lastIndexOf("."),i>=0)){for(;i>=0&&r>1;)i=n.lastIndexOf(".",i-1),r--;e.ca=i>0?n.substring(i):n}return e.ca},e.c_r=e.cookieRead=function(t){t=e.escape(t);var n=" "+e.d.cookie,r=n.indexOf(" "+t+"="),i=r<0?r:n.indexOf(";",r);return t=r<0?"":e.unescape(n.substring(r+2+t.length,i<0?n.length:i)),t!="[[B]]"?t:""},e.c_w=e.cookieWrite=function(t,n,r){var i=e.Ja(),s=e.cookieLifetime,o;return n=""+n,s=s?(""+s).toUpperCase():"",r&&s!="SESSION"&&s!="NONE"&&((o=n!=""?parseInt(s?s:0):-60)?(r=new Date,r.setTime(r.getTime()+o*1e3)):r==1&&(r=new Date,o=r.getYear(),r.setYear(o+5+(o<1900?1900:0)))),t&&s!="NONE"?(e.d.cookie=t+"="+e.escape(n!=""?n:"[[B]]")+"; path=/;"+(r&&s!="SESSION"?" expires="+r.toGMTString()+";":"")+(i?" domain="+i+";":""),e.cookieRead(t)==n):0},e.C=[],e.B=function(t,n,r){if(e.da)return 0;e.maxDelay||(e.maxDelay=250);var i=0,s=(new Date).getTime()+e.maxDelay,o=e.d.cb,u=["webkitvisibilitychange","visibilitychange"];o||(o=e.d.eb);if(o&&o=="prerender"){if(!e.M){e.M=1;for(r=0;r<u.length;r++)e.d.addEventListener(u[r],function(){var t=e.d.cb;t||(t=e.d.eb),t=="visible"&&(e.M=0,e.delayReady())})}i=1,s=0}else r||e.q("_d")&&(i=1);return i&&(e.C.push({m:t,a:n,t:s}),e.M||setTimeout(e.delayReady,e.maxDelay)),i},e.delayReady=function(){var t=(new Date).getTime(),n=0,r;for(e.q("_d")&&(n=1);e.C.length>0;){r=e.C.shift();if(n&&!r.t&&r.t>t){e.C.unshift(r),setTimeout(e.delayReady,parseInt(e.maxDelay/2));break}e.da=1,e[r.m].apply(e,r.a),e.da=0}},e.setAccount=e.sa=function(t){var n,r;if(!e.B("setAccount",arguments))if(e.account=t,e.allAccounts){n=e.allAccounts.concat(t.split(",")),e.allAccounts=[],n.sort();for(r=0;r<n.length;r++)(r==0||n[r-1]!=n[r])&&e.allAccounts.push(n[r])}else e.allAccounts=t.split(",")},e.W=function(t,n,r,i,s){var o="",u,a,f,l,c=0;t=="contextData"&&(t="c");if(n){for(u in n)if(!Object.prototype[u]&&(!s||u.substring(0,s.length)==s)&&n[u]&&(!r||r.indexOf(","+(i?i+".":"")+u+",")>=0)){f=!1;if(c)for(a=0;a<c.length;a++)u.substring(0,c[a].length)==c[a]&&(f=!0);if(!f&&(o==""&&(o+="&"+t+"."),a=n[u],s&&(u=u.substring(s.length)),u.length>0))if(f=u.indexOf("."),f>0)a=u.substring(0,f),f=(s?s:"")+a+".",c||(c=[]),c.push(f),o+=e.W(a,n,r,i,f);else if(typeof a=="boolean"&&(a=a?"true":"false"),a){if(i=="retrieveLightData"&&s.indexOf(".contextData.")<0)switch(f=u.substring(0,4),l=u.substring(4),u){case"transactionID":u="xact";break;case"channel":u="ch";break;case"campaign":u="v0";break;default:e.ja(l)&&(f=="prop"?u="c"+l:f=="eVar"?u="v"+l:f=="list"?u="l"+l:f=="hier"&&(u="h"+l,a=a.substring(0,255)))}o+="&"+e.escape(u)+"="+e.escape(a)}}o!=""&&(o+="&."+t)}return o},e.La=function(){var t="",n,r,i,s,o,u,a,f,l="",c="",h=r="";if(e.lightProfileID)n=e.P,(l=e.lightTrackVars)&&(l=","+l+","+e.ma.join(",")+",");else{n=e.e;if(e.pe||e.linkType)if(l=e.linkTrackVars,c=e.linkTrackEvents,e.pe&&(r=e.pe.substring(0,1).toUpperCase()+e.pe.substring(1),e[r]))l=e[r].pb,c=e[r].ob;l&&(l=","+l+","+e.H.join(",")+","),c&&(c=","+c+",",l&&(l+=",events,")),e.events2&&(h+=(h!=""?",":"")+e.events2)}for(r=0;r<n.length;r++){s=n[r],o=e[s],i=s.substring(0,4),u=s.substring(4),!o&&s=="events"&&h&&(o=h,h="");if(o&&(!l||l.indexOf(","+s+",")>=0)){switch(s){case"timestamp":s="ts";break;case"dynamicVariablePrefix":s="D";break;case"visitorID":s="vid";break;case"marketingCloudVisitorID":s="mid";break;case"analyticsVisitorID":s="aid";break;case"audienceManagerVisitorID":s="aamid";break;case"audienceManagerLocationHint":s="aamlh";break;case"pageURL":s="g",o.length>255&&(e.pageURLRest=o.substring(255),o=o.substring(0,255));break;case"pageURLRest":s="-g";break;case"referrer":s="r";break;case"vmk":case"visitorMigrationKey":s="vmt";break;case"visitorMigrationServer":s="vmf",e.ssl&&e.visitorMigrationServerSecure&&(o="");break;case"visitorMigrationServerSecure":s="vmf",!e.ssl&&e.visitorMigrationServer&&(o="");break;case"charSet":s="ce";break;case"visitorNamespace":s="ns";break;case"cookieDomainPeriods":s="cdp";break;case"cookieLifetime":s="cl";break;case"variableProvider":s="vvp";break;case"currencyCode":s="cc";break;case"channel":s="ch";break;case"transactionID":s="xact";break;case"campaign":s="v0";break;case"resolution":s="s";break;case"colorDepth":s="c";break;case"javascriptVersion":s="j";break;case"javaEnabled":s="v";break;case"cookiesEnabled":s="k";break;case"browserWidth":s="bw";break;case"browserHeight":s="bh";break;case"connectionType":s="ct";break;case"homepage":s="hp";break;case"plugins":s="p";break;case"events":h&&(o+=(o!=""?",":"")+h);if(c){u=o.split(","),o="";for(i=0;i<u.length;i++)a=u[i],f=a.indexOf("="),f>=0&&(a=a.substring(0,f)),f=a.indexOf(":"),f>=0&&(a=a.substring(0,f)),c.indexOf(","+a+",")>=0&&(o+=(o?",":"")+u[i])}break;case"events2":o="";break;case"contextData":t+=e.W("c",e[s],l,s),o="";break;case"lightProfileID":s="mtp";break;case"lightStoreForSeconds":s="mtss",e.lightProfileID||(o="");break;case"lightIncrementBy":s="mti",e.lightProfileID||(o="");break;case"retrieveLightProfiles":s="mtsr";break;case"deleteLightProfiles":s="mtsd";break;case"retrieveLightData":e.retrieveLightProfiles&&(t+=e.W("mts",e[s],l,s)),o="";break;default:e.ja(u)&&(i=="prop"?s="c"+u:i=="eVar"?s="v"+u:i=="list"?s="l"+u:i=="hier"&&(s="h"+u,o=o.substring(0,255)))}o&&(t+="&"+s+"="+(s.substring(0,3)!="pev"?e.escape(o):o))}s=="pev3"&&e.g&&(t+=e.g)}return t},e.u=function(e){var t=e.tagName;return""+e.nb!="undefined"||""+e.Xa!="undefined"&&(""+e.Xa).toUpperCase()!="HTML"?"":(t=t&&t.toUpperCase?t.toUpperCase():"",t=="SHAPE"&&(t=""),t&&((t=="INPUT"||t=="BUTTON")&&e.type&&e.type.toUpperCase?t=e.type.toUpperCase():!t&&e.href&&(t="A")),t)},e.fa=function(e){var t=e.href?e.href:"",n,r,i;return n=t.indexOf(":"),r=t.indexOf("?"),i=t.indexOf("/"),t&&(n<0||r>=0&&n>r||i>=0&&n>i)&&(r=e.protocol&&e.protocol.length>1?e.protocol:l.protocol?l.protocol:"",n=l.pathname.lastIndexOf("/"),t=(r?r+"//":"")+(e.host?e.host:l.host?l.host:"")+(h.substring(0,1)!="/"?l.pathname.substring(0,n<0?0:n)+"/":"")+t),t},e.D=function(t){var n=e.u(t),r,i,s="",o=0;if(n){r=t.protocol,i=t.onclick,t.href&&(n=="A"||n=="AREA")&&(!i||!r||r.toLowerCase().indexOf("javascript")<0)?s=e.fa(t):i?(s=e.replace(e.replace(e.replace(e.replace(""+i,"\r",""),"\n",""),"	","")," ",""),o=2):n=="INPUT"||n=="SUBMIT"?(t.value?s=t.value:t.innerText?s=t.innerText:t.textContent&&(s=t.textContent),o=3):t.src&&n=="IMAGE"&&(s=t.src);if(s)return{id:s.substring(0,100),type:o}}return 0},e.kb=function(t){for(var n=e.u(t),r=e.D(t);t&&!r&&n!="BODY";)if(t=t.parentElement?t.parentElement:t.parentNode)n=e.u(t),r=e.D(t);if(!r||n=="BODY")t=0;return t&&(n=t.onclick?""+t.onclick:"",n.indexOf(".tl(")>=0||n.indexOf(".trackLink(")>=0)&&(t=0),t},e.Va=function(){var n,r,i=e.linkObject,s=e.linkType,o=e.linkURL,u,a;e.Q=1,i||(e.Q=0,i=e.j);if(i){n=e.u(i);for(r=e.D(i);i&&!r&&n!="BODY";)if(i=i.parentElement?i.parentElement:i.parentNode)n=e.u(i),r=e.D(i);if(!r||n=="BODY")i=0;if(i){var f=i.onclick?""+i.onclick:"";if(f.indexOf(".tl(")>=0||f.indexOf(".trackLink(")>=0)i=0}}else e.Q=1;!o&&i&&(o=e.fa(i)),o&&!e.linkLeaveQueryString&&(u=o.indexOf("?"),u>=0&&(o=o.substring(0,u)));if(!s&&o){var l=0,c=0,h;if(e.trackDownloadLinks&&e.linkDownloadFileTypes){f=o.toLowerCase(),u=f.indexOf("?"),a=f.indexOf("#"),u>=0?a>=0&&a<u&&(u=a):u=a,u>=0&&(f=f.substring(0,u)),u=e.linkDownloadFileTypes.toLowerCase().split(",");for(a=0;a<u.length;a++)(h=u[a])&&f.substring(f.length-(h.length+1))=="."+h&&(s="d")}if(e.trackExternalLinks&&!s&&(f=o.toLowerCase(),e.ia(f))){e.linkInternalFilters||(e.linkInternalFilters=t.location.hostname),u=0,e.linkExternalFilters?(u=e.linkExternalFilters.toLowerCase().split(","),l=1):e.linkInternalFilters&&(u=e.linkInternalFilters.toLowerCase().split(","));if(u){for(a=0;a<u.length;a++)h=u[a],f.indexOf(h)>=0&&(c=1);c?l&&(s="e"):l||(s="e")}}}e.linkObject=i,e.linkURL=o,e.linkType=s;if(e.trackClickMap||e.trackInlineStats)if(e.g="",i)s=e.pageName,o=1,i=i.sourceIndex,s||(s=e.pageURL,o=0),t.s_objectID&&(r.id=t.s_objectID,i=r.type=1),s&&r&&r.id&&n&&(e.g="&pid="+e.escape(s.substring(0,255))+(o?"&pidt="+o:"")+"&oid="+e.escape(r.id.substring(0,100))+(r.type?"&oidt="+r.type:"")+"&ot="+n+(i?"&oi="+i:""))},e.Ma=function(){var t=e.Q,n=e.linkType,r=e.linkURL,i=e.linkName;n&&(r||i)&&(n=n.toLowerCase(),n!="d"&&n!="e"&&(n="o"),e.pe="lnk_"+n,e.pev1=r?e.escape(r):"",e.pev2=i?e.escape(i):"",t=1),e.abort&&(t=0);if(e.trackClickMap||e.trackInlineStats){n={},r=0;var s=e.cookieRead("s_sq"),o=s?s.split("&"):0,u,a,f;s=0;if(o)for(u=0;u<o.length;u++)a=o[u].split("="),i=e.unescape(a[0]).split(","),a=e.unescape(a[1]),n[a]=i;i=e.account.split(",");if(t||e.g){t&&!e.g&&(s=1);for(a in n)if(!Object.prototype[a])for(u=0;u<i.length;u++){s&&(f=n[a].join(","),f==e.account&&(e.g+=(a.charAt(0)!="&"?"&":"")+a,n[a]=[],r=1));for(o=0;o<n[a].length;o++)f=n[a][o],f==i[u]&&(s&&(e.g+="&u="+e.escape(f)+(a.charAt(0)!="&"?"&":"")+a+"&u=0"),n[a].splice(o,1),r=1)}t||(r=1);if(r){s="",u=2,!t&&e.g&&(s=e.escape(i.join(","))+"="+e.escape(e.g),u=1);for(a in n)!Object.prototype[a]&&u>0&&n[a].length>0&&(s+=(s?"&":"")+e.escape(n[a].join(","))+"="+e.escape(a),u--);e.cookieWrite("s_sq",s)}}}return t},e.Na=function(){if(!e.bb){var t=new Date,n=r.location,i,s,o,u=o=s=i="",a="",f="",l="1.2",c=e.cookieWrite("s_cc","true",0)?"Y":"N",h="",p="",d=0;if(t.setUTCDate&&(l="1.3",d.toPrecision&&(l="1.5",i=[],i.forEach))){l="1.6",o=0,s={};try{o=new Iterator(s),o.next&&(l="1.7",i.reduce&&(l="1.8",l.trim&&(l="1.8.1",Date.parse&&(l="1.8.2",Object.create&&(l="1.8.5")))))}catch(v){}}i=screen.width+"x"+screen.height,o=navigator.javaEnabled()?"Y":"N",s=screen.pixelDepth?screen.pixelDepth:screen.colorDepth,a=e.w.innerWidth?e.w.innerWidth:e.d.documentElement.offsetWidth,f=e.w.innerHeight?e.w.innerHeight:e.d.documentElement.offsetHeight,t=!1;try{e.b.addBehavior("#default#homePage"),h=e.b.lb(n)?"Y":"N"}catch(m){}try{e.b.addBehavior("#default#clientCaps"),p=e.b.connectionType}catch(g){}if(t)for(;d<t.length&&d<30;){if(n=t[d].name)n=n.substring(0,100)+";",u.indexOf(n)<0&&(u+=n);d++}e.resolution=i,e.colorDepth=s,e.javascriptVersion=l,e.javaEnabled=o,e.cookiesEnabled=c,e.browserWidth=a,e.browserHeight=f,e.connectionType=p,e.homepage=h,e.plugins=u,e.bb=1}},e.G={},e.loadModule=function(n,r){var i=e.G[n];if(!i){i=t["AppMeasurement_Module_"+n]?new t["AppMeasurement_Module_"+n](e):{},e.G[n]=e[n]=i,i.ua=function(){return i.wa},i.xa=function(t){if(i.wa=t)e[n+"_onLoad"]=t,e.B(n+"_onLoad",[e,i],1)||t(e,i)};try{Object.defineProperty?Object.defineProperty(i,"onLoad",{get:i.ua,set:i.xa}):i._olc=1}catch(s){i._olc=1}}r&&(e[n+"_onLoad"]=r,e.B(n+"_onLoad",[e,i],1)||r(e,i))},e.q=function(t){var n,r;for(n in e.G)if(!Object.prototype[n]&&(r=e.G[n])){r._olc&&r.onLoad&&(r._olc=0,r.onLoad(e,r));if(r[t]&&r[t]())return 1}return 0},e.Qa=function(){var t=Math.floor(Math.random()*1e13),n=e.visitorSampling,r=e.visitorSamplingGroup;r="s_vsn_"+(e.visitorNamespace?e.visitorNamespace:e.account)+(r?"_"+r:"");var i=e.cookieRead(r);if(n){i&&(i=parseInt(i));if(!i){if(!e.cookieWrite(r,t))return 0;i=t}if(i%1e4>v)return 0}return 1},e.I=function(t,n){var r,i,s,o,u,a;for(r=0;r<2;r++){i=r>0?e.$:e.e;for(s=0;s<i.length;s++)if(o=i[s],(u=t[o])||t["!"+o]){if(!n&&(o=="contextData"||o=="retrieveLightData")&&e[o])for(a in e[o])u[a]||(u[a]=e[o][a]);e[o]=u}}},e.qa=function(t,n){var r,i,s,o;for(r=0;r<2;r++){i=r>0?e.$:e.e;for(s=0;s<i.length;s++)o=i[s],t[o]=e[o],!n&&!t[o]&&(t["!"+o]=1)}},e.Ia=function(e){var t,n,r,i,s,o=0,u,a="",f="";if(e&&e.length>255&&(t=""+e,n=t.indexOf("?"),n>0&&(u=t.substring(n+1),t=t.substring(0,n),i=t.toLowerCase(),r=0,i.substring(0,7)=="http://"?r+=7:i.substring(0,8)=="https://"&&(r+=8),n=i.indexOf("/",r),n>0&&(i=i.substring(r,n),s=t.substring(n),t=t.substring(0,n),i.indexOf("google")>=0?o=",q,ie,start,search_key,word,kw,cd,":i.indexOf("yahoo.co")>=0&&(o=",p,ei,"),o&&u)))){if((e=u.split("&"))&&e.length>1){for(r=0;r<e.length;r++)i=e[r],n=i.indexOf("="),n>0&&o.indexOf(","+i.substring(0,n)+",")>=0?a+=(a?"&":"")+i:f+=(f?"&":"")+i;a&&f?u=a+"&"+f:f=""}n=253-(u.length-f.length)-t.length,e=t+(n>0?s.substring(0,n):"")+"?"+u}return e},e.za=!1,e.Z=!1,e.ib=function(t){e.marketingCloudVisitorID=t,e.Z=!0,e.z()},e.J=!1,e.X=!1,e.ta=function(t){e.analyticsVisitorID=t,e.X=!0,e.z()},e.ya=!1,e.Y=!1,e.hb=function(t){e.audienceManagerVisitorID=t,e.audienceManagerVisitorID&&e.visitor.getAudienceManagerLocationHint&&(e.audienceManagerLocationHint=e.visitor.getAudienceManagerLocationHint()),e.Y=!0,e.z()},e.isReadyToTrack=function(){var t=!0,n=e.visitor;if(n&&n.isAllowed()){!e.J&&!e.analyticsVisitorID&&n.getAnalyticsVisitorID&&(e.analyticsVisitorID=n.getAnalyticsVisitorID([e,e.ta]),!e.analyticsVisitorID)&&(e.J=!0);if(e.za&&!e.Z&&!e.marketingCloudVisitorID||e.J&&!e.X&&!e.analyticsVisitorID||e.ya&&!e.Y&&!e.audienceManagerVisitorID)t=!1}return t},e.k=n,e.l=0,e.callbackWhenReadyToTrack=function(t,r,i){var s;s={},s.Da=t,s.Ca=r,s.Aa=i,e.k==n&&(e.k=[]),e.k.push(s),e.l==0&&(e.l=setInterval(e.z,100))},e.z=function(){var t;if(e.isReadyToTrack()){e.l&&(clearInterval(e.l),e.l=0);if(e.k!=n)for(;e.k.length>0;)t=e.k.shift(),t.Ca.apply(t.Da,t.Aa)}},e.va=function(t){var r,i,s=n,o=n;if(!e.isReadyToTrack()){r=[];if(t!=n)for(i in s={},t)s[i]=t[i];return o={},e.qa(o,!0),r.push(s),r.push(o),e.callbackWhenReadyToTrack(e,e.track,r),!0}return!1},e.Ka=function(){var t=e.cookieRead("s_fid"),n="",r="",i;i=8;var s=4;if(!t||t.indexOf("-")<0){for(t=0;t<16;t++)i=Math.floor(Math.random()*i),n+="0123456789ABCDEF".substring(i,i+1),i=Math.floor(Math.random()*s),r+="0123456789ABCDEF".substring(i,i+1),i=s=16;t=n+"-"+r}return e.cookieWrite("s_fid",t,1)||(t=0),t},e.t=e.track=function(n,i){var s,o=new Date,u="s"+Math.floor(o.getTime()/108e5)%10+Math.floor(Math.random()*1e13),a=o.getYear();a="t="+e.escape(o.getDate()+"/"+o.getMonth()+"/"+(a<1900?a+1900:a)+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+" "+o.getDay()+" "+o.getTimezoneOffset()),e.q("_s"),e.B("track",arguments)||(e.va(n)||(i&&e.I(i),n&&(s={},e.qa(s,0),e.I(n)),e.Qa()&&(!e.analyticsVisitorID&&!e.marketingCloudVisitorID&&(e.fid=e.Ka()),e.Va(),e.usePlugins&&e.doPlugins&&e.doPlugins(e),e.account&&(e.abort||(e.trackOffline&&!e.timestamp&&(e.timestamp=Math.floor(o.getTime()/1e3)),o=t.location,e.pageURL||(e.pageURL=o.href?o.href:o),!e.referrer&&!e.ra&&(e.referrer=r.document.referrer,e.ra=1),e.referrer=e.Ia(e.referrer),e.q("_g")),e.Ma()&&!e.abort&&(e.Na(),a+=e.La(),e.Ua(u,a)),e.abort||e.q("_t"))),n&&e.I(s,1)),e.timestamp=e.linkObject=e.j=e.linkURL=e.linkName=e.linkType=t.mb=e.pe=e.pev1=e.pev2=e.pev3=e.g=0)},e.tl=e.trackLink=function(t,n,r,i,s){return e.linkObject=t,e.linkType=n,e.linkName=r,s&&(e.i=t,e.p=s),e.track(i)},e.trackLight=function(t,n,r,i){return e.lightProfileID=t,e.lightStoreForSeconds=n,e.lightIncrementBy=r,e.track(i)},e.clearVars=function(){var t,n;for(t=0;t<e.e.length;t++)if(n=e.e[t],n.substring(0,4)=="prop"||n.substring(0,4)=="eVar"||n.substring(0,4)=="hier"||n.substring(0,4)=="list"||n=="channel"||n=="events"||n=="eventList"||n=="products"||n=="productList"||n=="purchaseID"||n=="transactionID"||n=="state"||n=="zip"||n=="campaign")e[n]=void 0},e.Ua=function(t,n){var r,i=e.trackingServer;r="";var s=e.dc,o="sc.",u=e.visitorNamespace;i?e.trackingServerSecure&&e.ssl&&(i=e.trackingServerSecure):(u||(u=e.account,i=u.indexOf(","),i>=0&&(u=u.gb(0,i)),u=u.replace(/[^A-Za-z0-9]/g,"")),r||(r="2o7.net"),s=s?(""+s).toLowerCase():"d1",r=="2o7.net"&&(s=="d1"?s="112":s=="d2"&&(s="122"),o=""),i=u+"."+s+"."+o+r),r=e.ssl?"https://":"http://",r+=i+"/b/ss/"+e.account+"/"+(e.mobile?"5.":"")+"1/JS-"+e.version+(e.ab?"T":"")+"/"+t+"?AQB=1&ndh=1&"+n+"&AQE=1",e.Pa&&(r=r.substring(0,2047)),e.Ga(r),e.N()},e.Ga=function(t){e.c||e.Oa(),e.c.push(t),e.O=e.r(),e.pa()},e.Oa=function(){e.c=e.Ra(),e.c||(e.c=[])},e.Ra=function(){var n,r;if(e.T()){try{(r=t.localStorage.getItem(e.R()))&&(n=t.JSON.parse(r))}catch(i){}return n}},e.T=function(){var n=!0;if(!e.trackOffline||!e.offlineFilename||!t.localStorage||!t.JSON)n=!1;return n},e.ga=function(){var t=0;return e.c&&(t=e.c.length),e.v&&t++,t},e.N=function(){if(!e.v)if(e.ha=n,e.S)e.O>e.F&&e.na(e.c),e.V(500);else{var t=e.Ba();if(t>0)e.V(t);else if(t=e.ea())e.v=1,e.Ta(t),e.Ya(t)}},e.V=function(t){e.ha||(t||(t=0),e.ha=setTimeout(e.N,t))},e.Ba=function(){var t;return!e.trackOffline||e.offlineThrottleDelay<=0?0:(t=e.r()-e.la,e.offlineThrottleDelay<t?0:e.offlineThrottleDelay-t)},e.ea=function(){if(e.c.length>0)return e.c.shift()},e.Ta=function(t){if(e.debugTracking){var n="AppMeasurement Debug: "+t;t=t.split("&");var r;for(r=0;r<t.length;r++)n+="\n	"+e.unescape(t[r]);e.Sa(n)}},e.Ya=function(n){var r;r||(r=new Image,r.alt=""),r.ba=function(){try{e.U&&(clearTimeout(e.U),e.U=0),r.timeout&&(clearTimeout(r.timeout),r.timeout=0)}catch(t){}},r.onload=r.$a=function(){r.ba(),e.Fa(),e.K(),e.v=0,e.N()},r.onabort=r.onerror=r.Ha=function(){r.ba(),(e.trackOffline||e.S)&&e.v&&e.c.unshift(e.Ea),e.v=0,e.O>e.F&&e.na(e.c),e.K(),e.V(500)},r.onreadystatechange=function(){r.readyState==4&&(r.status==200?r.$a():r.Ha())},e.la=e.r(),r.src=n,r.abort&&(e.U=setTimeout(r.abort,5e3)),e.Ea=n,e.jb=t["s_i_"+e.replace(e.account,",","_")]=r;if(e.useForcedLinkTracking&&e.A||e.p)e.forcedLinkTrackingTimeout||(e.forcedLinkTrackingTimeout=250),e.L=setTimeout(e.K,e.forcedLinkTrackingTimeout)},e.Fa=function(){if(e.T()&&!(e.ka>e.F))try{t.localStorage.removeItem(e.R()),e.ka=e.r()}catch(n){}},e.na=function(n){if(e.T()){e.pa();try{t.localStorage.setItem(e.R(),t.JSON.stringify(n)),e.F=e.r()}catch(r){}}},e.pa=function(){if(e.trackOffline){if(!e.offlineLimit||e.offlineLimit<=0)e.offlineLimit=10;for(;e.c.length>e.offlineLimit;)e.ea()}},e.forceOffline=function(){e.S=!0},e.forceOnline=function(){e.S=!1},e.R=function(){return e.offlineFilename+"-"+e.visitorNamespace+e.account},e.r=function(){return(new Date).getTime()},e.ia=function(e){return e=e.toLowerCase(),e.indexOf("#")!=0&&e.indexOf("about:")!=0&&e.indexOf("opera:")!=0&&e.indexOf("javascript:")!=0?!0:!1},e.setTagContainer=function(t){var n,r,i;e.ab=t;for(n=0;n<e._il.length;n++)if((r=e._il[n])&&r._c=="s_l"&&r.tagContainerName==t){e.I(r);if(r.lmq)for(n=0;n<r.lmq.length;n++)i=r.lmq[n],e.loadModule(i.n);if(r.ml)for(i in r.ml)if(e[i])for(n in t=e[i],i=r.ml[i],i)!Object.prototype[n]&&(typeof i[n]!="function"||(""+i[n]).indexOf("s_c_il")<0)&&(t[n]=i[n]);if(r.mmq)for(n=0;n<r.mmq.length;n++)i=r.mmq[n],e[i.m]&&(t=e[i.m],t[i.f]&&typeof t[i.f]=="function"&&(i.a?t[i.f].apply(t,i.a):t[i.f].apply(t)));if(r.tq)for(n=0;n<r.tq.length;n++)e.track(r.tq[n]);r.s=e;break}},e.Util={urlEncode:e.escape,urlDecode:e.unescape,cookieRead:e.cookieRead,cookieWrite:e.cookieWrite,getQueryParam:function(n,r,i){var s;return r||(r=e.pageURL?e.pageURL:t.location),i||(i="&"),n&&r&&(r=""+r,s=r.indexOf("?"),s>=0&&(r=i+r.substring(s+1)+i,s=r.indexOf(i+n+"="),s>=0&&(r=r.substring(s+i.length+n.length+1),s=r.indexOf(i),s>=0&&(r=r.substring(0,s)),r.length>0)))?e.unescape(r):""}},e.H=["timestamp","dynamicVariablePrefix","visitorID","marketingCloudVisitorID","analyticsVisitorID","audienceManagerVisitorID","audienceManagerLocationHint","fid","vmk","visitorMigrationKey","visitorMigrationServer","visitorMigrationServerSecure","charSet","visitorNamespace","cookieDomainPeriods","fpCookieDomainPeriods","cookieLifetime","pageName","pageURL","referrer","contextData","currencyCode","lightProfileID","lightStoreForSeconds","lightIncrementBy","retrieveLightProfiles","deleteLightProfiles","retrieveLightData","pe","pev1","pev2","pev3","pageURLRest"],e.e=e.H.concat(["purchaseID","variableProvider","channel","server","pageType","transactionID","campaign","state","zip","events","events2","products","tnt"]),e.ma=["timestamp","charSet","visitorNamespace","cookieDomainPeriods","cookieLifetime","contextData","lightProfileID","lightStoreForSeconds","lightIncrementBy"],e.P=e.ma.slice(0),e.$=["account","allAccounts","debugTracking","visitor","trackOffline","offlineLimit","offlineThrottleDelay","offlineFilename","usePlugins","doPlugins","configURL","visitorSampling","s.visitorSamplingGroup","linkObject","linkURL","linkName","linkType","trackDownloadLinks","trackExternalLinks","trackClickMap","trackInlineStats","linkLeaveQueryString","linkTrackVars","linkTrackEvents","linkDownloadFileTypes","linkExternalFilters","linkInternalFilters","useForcedLinkTracking","forcedLinkTrackingTimeout","trackingServer","trackingServerSecure","ssl","abort","mobile","dc","lightTrackVars","maxDelay"];for(i=0;i<=75;i++)e.e.push("prop"+i),e.P.push("prop"+i),e.e.push("eVar"+i),e.P.push("eVar"+i),i<6&&e.e.push("hier"+i),i<4&&e.e.push("list"+i);i=["resolution","colorDepth","javascriptVersion","javaEnabled","cookiesEnabled","browserWidth","browserHeight","connectionType","homepage","plugins"],e.e=e.e.concat(i),e.H=e.H.concat(i),e.ssl=t.location.protocol.toLowerCase().indexOf("https")>=0,e.charSet="UTF-8",e.contextData={},e.offlineThrottleDelay=0,e.offlineFilename="AppMeasurement.offline",e.la=0,e.O=0,e.F=0,e.ka=0,e.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx",e.w=t,e.d=t.document;try{e.Pa=navigator.appName=="Microsoft Internet Explorer"}catch(u){}e.K=function(){e.L&&(t.clearTimeout(e.L),e.L=n),e.i&&e.A&&e.i.dispatchEvent(e.A),e.p&&(typeof e.p=="function"?e.p():e.i&&e.i.href&&(e.d.location=e.i.href)),e.i=e.A=e.p=0},e.oa=function(){e.b=e.d.body,e.b?(e.o=function(n){var r,i,s,o,u;if(!(e.d&&e.d.getElementById("cppXYctnr")||n&&n.Wa)){if(e.aa){if(!e.useForcedLinkTracking){e.b.removeEventListener("click",e.o,!0),e.aa=e.useForcedLinkTracking=0;return}e.b.removeEventListener("click",e.o,!1)}else e.useForcedLinkTracking=0;e.j=n.srcElement?n.srcElement:n.target;try{if(e.j&&(e.j.tagName||e.j.parentElement||e.j.parentNode))if(s=e.ga(),e.track(),s<e.ga()&&e.useForcedLinkTracking&&n.target){for(o=n.target;o&&o!=e.b&&o.tagName.toUpperCase()!="A"&&o.tagName.toUpperCase()!="AREA";)o=o.parentNode;if(o&&(u=o.href,e.ia(u)||(u=0),i=o.target,n.target.dispatchEvent&&u&&(!i||i=="_self"||i=="_top"||i=="_parent"||t.name&&i==t.name))){try{r=e.d.createEvent("MouseEvents")}catch(a){r=new t.MouseEvent}if(r){try{r.initMouseEvent("click",n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget)}catch(f){r=0}r&&(r.Wa=1,n.stopPropagation(),n.Za&&n.Za(),n.preventDefault(),e.i=n.target,e.A=r)}}}}catch(l){}e.j=0}},e.b&&e.b.attachEvent)?e.b.attachEvent("onclick",e.o):e.b&&e.b.addEventListener&&(navigator&&(navigator.userAgent.indexOf("WebKit")>=0&&e.d.createEvent||navigator.userAgent.indexOf("Firefox/2")>=0&&t.MouseEvent)&&(e.aa=1,e.useForcedLinkTracking=1,e.b.addEventListener("click",e.o,!0)),e.b.addEventListener("click",e.o,!1)):setTimeout(e.oa,30)},e.oa()}function E(e){var t,n=window.s_c_il,r,i=e.split(","),s,o,u=0;if(n)for(r=0;!u&&r<n.length;){t=n[r];if(t._c=="s_c"&&t.account)if(t.account==e)u=1;else{t.allAccounts||(t.allAccounts=t.account.split(","));for(s=0;s<i.length;s++)for(o=0;o<t.allAccounts.length;o++)i[s]==t.allAccounts[o]&&(u=1)}r++}return u||(t=new w),t.setAccount(e),t}function S(){var e=window,t=e.s_giq,n,r,i;if(t)for(n=0;n<t.length;n++)r=t[n],i=E(r.oun),i.setAccount(r.un),i.setTagContainer(r.tagContainerName);e.s_giq=0}if(t==null||navigator.userAgent.match(/Series40; Nokia/))return;this.document=n||document;var i=this,s=t.suitenameMap,o=t.service,u=r("ocid"),a=t.asset?t.asset.headline:"(none)";e.pubsub.on("rollingNews:openAccordion",function(e){var t=e.closest(".rolling-news").attr("data-asset-id"),n=e.find("a")[0].href,r={ev:"event11",gn:"ws::"+n,ch:"ws::"+t,c5:"ws::story",c6:"D=ch",c7:"ws::"+t+">"+"story",c15:"D=gn",c25:"BBCMobile",c45:o,c57:"no",v0:u,r:document.referrer};i.track(s,r)}),e.pubsub.on("video:play",function(e){var n=e.opts.mediaType,r={ev:"event6",c21:a,c22:"ws::"+n,pe:"lnk_o",pev1:window.location.origin+t.pathPrefix,pev2:"video_start"};i.track(s,r)}),e.pubsub.on("video:end",function(e){var n=e.opts.mediaType,r={ev:"event7",c21:a,c22:"ws::"+n,pe:"lnk_o",pev1:window.location.origin+t.pathPrefix,pev2:"video_end"};i.track(s,r)});var f="0.16",c="2014-04-07",p="TM",d=!1;document.domain.match(/pal\.sandbox\.dev\.bbc\.co|on\.bbcnewshq\.co|int\.bbc\.co|test\.bbc\.co|stage\.bbc\.co|live\.bbc\.co/i)&&(d=!0);var y=new w;y.account="bbcwsresponsivedev",d?d&&(y.account="bbcwsresponsivedev"):y.account="bbcwglobalprod,"+m("suitenameMap"),y.trackDownloadLinks=!1,y.trackExternalLinks=!1,y.trackInlineStats=!0,y.linkDownloadFileTypes="exe,zip,wav,mp3,mp4,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx",y.linkLeaveQueryString=!1,y.linkTrackVars="None",y.linkTrackEvents="None",y.usePlugins=!0,y.events="event2",y.pageName="ws::"+document.title.replace(/ - /g,"|").toLowerCase(),y.eVar3=m("asset.headline"),y.eVar4=m("asset.asset_id");switch(m("asset.type").toLowerCase()){case"pgl":y.eVar5="GALLERY";break;case"map":y.eVar5="VIDEO";break;case"idx":y.eVar5="INDEX";break;case"sty":y.eVar5="STORY",document.getElementsByClassName("player-wrapper").length>0&&(y.eVar5="STORY-VIDEO");break;case"fix":y.eVar5="STORY";break;case"lep":y.eVar5="STORY";break;case"blog":y.eVar5="BLOGS & FORUMS";break;case"cop":y.eVar5="correspondant page";break;case"link":y.eVar5="STORY";break;case"csp":y.eVar5="STORY";break;default:y.eVar5="OTHER"}y.eVar5="ws::"+y.eVar5,y.eVar6="ws::"+m("asset.section.id",document.location.pathname.split("/")[2]),y.eVar10=m("asset.first_created.date"),y.eVar12=m("asset.author"),y.eVar15=document.location.pathname,y.eVar15.length>254&&(y.eVar15=y.eVar15.substring(0,243)+"-too long"),y.eVar25="BBC|RD|"+g(),y.eVar31="ws::"+y.eVar25.replace("BBC|",""),y.eVar32="",y.eVar45=m("service"),m("isWorldService")&&(y.eVar55="worldservice"),m("asset.options.allowAdvertising")?y.eVar57="yes":y.eVar57="no",y.eVar55="worldservice",y.eVar20="js-e|app",y.prop60="ws::"+f+" : "+c,y.doPlugins=b,y.trackingServer="sa.bbc.com",y.trackingServerSecure="ssa.bbc.com",y.getQueryParam=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))},y.apl=new Function("L","v","d","u","var s=this,m=0;if(!L)L='';if(u){var i,n,a=s.split(L,d);for(i=0;i<a.length;i++){n=a[i];m=m||(u==1?(n==v):(n.toLowerCase()==v.toLowerCase()));}}if(!m)L=L?L+d+v:v;return L"),y.t(),w.getInstance=E,window.s_objectID||(window.s_objectID=0),S()}return n.prototype.track=function(e,t){var n=(Math.random()+Math.pow(10,-9)).toString().substr(2,8),r=[];for(var i in t)r.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));r=r.join("&");var s="http://sa.bbc.com/b/ss/bbcwglobalprod,"+e+"/5/"+n+"?"+r,o=new Image;o.src=s,o.className="tracking-image",this.document.body.appendChild(o)},n}),define("vendor/istats/istats",[],function(){function w(e){return typeof e.istats=="undefined"&&(e.istats={}),typeof e.istats.enabled=="undefined"&&(e.istats.enabled=!0),e}function E(e){return e?w(e).istats:window.istats}function S(){if(typeof b=="string")return u.type="internal",b}function x(e){history.replaceState?history.replaceState({},"",document.location.pathname+e):document.location.hash=e}function T(e){e||(e=document.location.hash);if(e!==""){var t=e.match(h.clickThrough),n,r="",i=[];if(t===null)return;t[2]&&(r="#"+t[2]),x(r),n=t[1];if(n==="")return;u.type="click through",i=n.split("&");for(var s in i)i.hasOwnProperty(s)&&!h.hashLabels.test(i[s])&&(i[s]="ct_"+i[s]);return n=i.join("&"),n}}function N(){var e=!0,t=!0,n=E().enabled;return window.bbcFlagpoles_istats&&(t=window.bbcFlagpoles_istats!=="ON"),t||!n?e=!1:C(),e}function C(){return!n&&typeof istatsTrackingUrl!="undefined"&&(n=istatsTrackingUrl),n}function k(e,t){return e.className?(" "+e.className+" ").indexOf(" "+t+" ")===-1?!1:!0:!1}function L(e,t){var n=e.className?e.className+" ":"";k(e,t)||(e.className=n+t)}function A(e,t){var n=e.className.split(" "),r=[],i=n.length;while(i--)n[i]!==t&&r.unshift(n[i]);e.className=r.length?r.join(" "):""}function O(e){var t=e.match(h.domain);return t?t[1]:e}function M(e,t){var n=e;do{if(n.nodeName=="A")return n;if(n===t)return!1}while(n=n.parentNode)}function _(e){if(!t._isWebUrl(e))return;if(t._isExternal(e))return"external";if(t._isDownload(e))return"download";if(t._isInternal(e))return"internal"}function D(e,t,n,r,i){e.istats={linkType:t,linkTrackerUrl:n,linkLocation:r,linkElement:i}}function P(e,t,n,r){var i=r.altKey||r.ctrlKey||r.metaKey||r.shiftKey,s=function(){};i||(s=function(){d.notify(t,"redirect.istats",r)!==!1&&(window.location.href=n.href)}),clearTimeout(c),c=setTimeout(function(){d.notify(t,"trackingfail.istats",r),s()},a),H(e,function(){clearTimeout(c),d.notify(t,"trackingsuccess.istats",r)!==!1&&s()},r),i||(r.preventDefault?r.preventDefault():event.returnValue=!1)}function H(e,t,n){var r;e+="&ns__t="+(new Date).getTime(),e+="&ns_jspageurl="+escape(document.location&&document.location.href?document.location.href:document.URL),n&&n.istats.linkTrackerUrl&&(n.istats.linkTrackerUrl=e),r=new Image,typeof t=="function"&&(r.onload=function(){t()}),u.url=e,r.src=e,r.className="tracking-image",document.body.appendChild(r)}function B(e){if(typeof e[s]!="undefined")return;e[s]={eventsKey:g.length,linkTypesTracked:{}},g.push(y())}function j(e,t,n){var r=new Date,i=31536e6,s=window.location.host,o,u,a;return typeof n=="undefined"&&(n=i),r.setTime(r.getTime()+n),u="; expires="+r.toGMTString(),o=O(s),a=e+"="+encodeURIComponent(t)+u+"; domain="+o+"; path=/",document.cookie=a,a}function F(e){var t=e+"=",n=document.cookie.split(";"),r;for(var i=0,s=n.length;i<s;i++){r=n[i];while(r.charAt(0)===" ")r=r.substring(1,r.length);if(r.indexOf(t)===0)return decodeURIComponent(r.substring(t.length,r.length))}return null}function I(e){F(e)!==null&&j(e,"",-1)}var e={},t=e,n,r="sa_labels",i="istats-notrack",s="_istats_"+Math.random(),o={internal:!0,external:!0,download:!0,clickthrough:!0,promoimage:!0},u={type:"",url:""},a=2e3,f=1e4,l=500,c,h={ignore:/.+\.(jpe?g|gif|png)$/i,webUrl:/^(\.\.?\/|\/|https?:\/\/|[^\/.:]+([\/.]|$))/i,pseudoProtocol:/^(mailto:|javascript:|about:|view-source:|data:)/i,internalUrl:/^(?:\/\/|https?:\/\/)?(?:[^.]+\.)*(bbc(?:\.co\.uk|\.com)|doubleclick\.net)(:|\/|$)/i,downloadUrl:/.+\.(pdf|te?xt|rtf|docx?|xlsx?|pptx?|od[tpsgbf]|mp[234]|m4a|mpeg|exe|dmg|zip|tgz)$/i,relativeUrl:/^(\.\.?\/|\/[^\/]|([^\/.:]+([\/.]|$)))/i,clickThrough:/^#sa-(.*?)(?:-sa(.*))?$/,hashLabels:/^ct_|ns_(fee|campaign|linkname|mchannel|source)=(.+?)$/,domain:/(bbc(?:\.co\.uk|\.com))$/i},p={},d={types:{"trackingfail.istats":!0,"trackingsuccess.istats":!0,"redirect.istats":!0,"cookiecreated.istats":!0}},v={},m={},g=[],y=function(){var e={};for(var t in d.types)e[t]=[];return e},b=F(r);return w(window),b!==null&&(E()._linkTracked=!0),N()&&C(),I(r),e.getConfig=E,e._setTrackingServiceUrl=C,e._getTrackingServiceUrl=function(){return n},e.setCountername=function(e){n=n.replace(/([\?&]name=)[^&]*/ig,"$1"+e)},e.getCountername=function(){var e=n.match(/[\?&]name=([^&]*)/i);if(e)return e[1]},e.track=function(e,t){if(!N())return;if(!o[e])throw'Given linkType, "'+e+'" is not valid.';t=t||{},t.region||(t.region=[document.body]),typeof t.region.push=="undefined"&&(t.region=[t.region]);var n=t.region.length;while(n--){var r=t.region[n];B(r,e);var i=r[s];i.linkTypesTracked[e]=t||{},i.trackerAttached||(function(e){p.attach(e,"click",function(t){m.dispatch(e,t)})}(r),i.trackerAttached=!0)}},e.observe=function(e,t,n){if(!d.types[t])throw'Cannot observe: Given eventType, "'+t+'" in unknown.';typeof e.push=="undefined"&&(e=[e]);var r=e.length;while(r--)B(e[r]),g[e[r][s].eventsKey][t].push(n)},e._isInternal=function(t){return e._isWebUrl(t)&&(h.relativeUrl.test(t)||h.internalUrl.test(t))},e._isExternal=function(n){return e._isWebUrl(n)&&!t._isInternal(n)},e._isDownload=function(e){return h.webUrl.test(e)&&h.downloadUrl.test(e)},e._isWebUrl=function(e){return h.webUrl.test(e)&&!h.ignore.test(e)&&!h.pseudoProtocol.test(e)},e._getDomainFromHost=O,e._getLabelsFromHashString=T,e._createCookie=j,e._inspectTracking=function(e){return typeof e!="undefined"&&(u=e),u},e.log=function(t,r,i,s){var o="",a;if(!N())return;r=encodeURIComponent(r),t=encodeURIComponent(t);for(var f in i)o+="&"+encodeURIComponent(f)+"="+encodeURIComponent(i[f]);t.toLowerCase()==="pageview"?(e.setCountername(r),a=n):a=n+"&ns_type=hidden"+"&action_type="+t+"&action_name="+r,a+=o,u.type="logging actions",H(a,s)},e.addNoTrack=function(e){L(e,i)},e.removeNoTrack=function(e){A(e,i)},d.notify=function(e,t,n){var r=g[e[s].eventsKey][t];for(var i=0,o=r.length;i<o;i++)if(typeof r[i]=="function"&&r[i](n)===!1)return!1},p.attach=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},p.detach=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},p.getTarget=function(e){return e=e||window.event,e.target||e.srcElement},m.dispatch=function(e,t){var n=M(p.getTarget(t),this),r,o,u,a,f;if(!n||!n.href)return;a=(new Date).getTime(),f=n.istatsTimestamp&&a-n.istatsTimestamp<l;if(f||k(n,i))return;r=_(n.href),o=m[r],u=e[s].linkTypesTracked[r];if(!r||!o||!u)return;n.istatsTimestamp=a,t.istats=t.istats||{},m[r](e,n,t)},m.external=function(e,t,r){var i=e[s].linkTypesTracked.external||{},o=encodeURIComponent(t.href)||"",a=t.id?"&extlink_id="+encodeURIComponent(t.id):"",f=i.linkLocation?"&link_location="+encodeURIComponent(i.linkLocation):"",l=n+"&ns_type=hidden&action_type=extlink&extlink_url="+o+a+f;u.type="external",D(r,"external",l,i.linkLocation,t),P(l,e,t,r)},m.download=function(e,t,r){var i=e[s].linkTypesTracked.download||{},o=encodeURIComponent(t.href)||"",a=t.id?"&download_id="+encodeURIComponent(t.id):"",f=i.linkLocation?"&link_location="+encodeURIComponent(i.linkLocation):"",l=n+"&ns_type=hidden&action_type=download&download_url="+o+a+f;u.type="download",D(r,"download",l,i.linkLocation,t),P(l,e,t,r)},m.internal=function(e,t,n){var i=e[s].linkTypesTracked.internal||{},o="intlink_from_url="+encodeURIComponent(document.location.href),u="&intlink_ts="+(new Date).getTime(),a=t.id?"&intlink_id="+encodeURIComponent(t.id):"",l=t.linktrack?"&"+t.linktrack:"",c=i.linkLocation?"&link_location="+encodeURIComponent(i.linkLocation):"",h=o+u+a+l+c;j(r,h,f),d.notify(e,"cookiecreated.istats",n)},e.init=function(){var e;if(!N()&&typeof n!="string")return;e=S()||T(),e&&(H(n+"&"+e),E()._linkTracked=!0)},e}),define("module/stats/statsSubscriber",["module/bootstrap","vendor/istats/istats"],function(e,t){function n(e,n){this.config=e||{},this.istats=n||t,this.pageviews=[],this.hidden=[],this.links=[],this.istats.init(),this.processConfig(),this.bindEvents()}return n.prototype={bindEvents:function(){var t=this;e.pubsub.on("component:loaded",function(e){t.handleComponentLoaded(e)})},handleComponentLoaded:function(e){if(!this.linksContainsComponentName(e))return;this.registerTrackingLink(this.getLinkByName(e))},getLinkByName:function(e){for(var t=0,n=this.links.length;t<n;t++){var r=this.links[t];if(r.name===e)return r}return},linksContainsComponentName:function(e){for(var t=0,n=this.links.length;t<n;t++){var r=this.links[t];if(r.name===e)return!0}return!1},addPageviews:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.pageviews.push(n),this.registerPageview(n)}},addHidden:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.hidden.push(n),this.registerHiddenEvent(n)}},addTrackingLinks:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.links.push(n),this.registerTrackingLink(n)}},applyCountername:function(e,t){var n=this.istats.getCountername(),r=Array.prototype.slice.call(t);return r.unshift(n),e.apply(this,r)},applyLabels:function(e,t){return e.apply(this,t)},registerPageview:function(t){var n=this,r=t.on,i=t.countername;e.pubsub.on(r,function(){var e=typeof i=="function"?n.applyCountername(i,arguments):i;n.istats.log("pageview",e)})},registerHiddenEvent:function(t){var n=this,r=t.on,i=t.action_type||"event",s=t.action_name,o=t.labels||{};e.pubsub.on(r,function(){var e=n.appendLabels(o,arguments);n.istats.log(i,s,e)})},registerTrackingLink:function(e){var t=e.type||"internal",n=e.name,r=e.selector,i=e.labels;if(Object.prototype.toString.call(r)==="[object Array]")for(var s=0;s<r.length;s++)this.track(t,n,r[s],i);else this.track(t,n,r,i)},track:function(t,n,r,i){var s=e.$(r);if(s.length>0){var o=s.find("a");for(var u=0,a=o.length;u<a;u++){var f=o[u],l="story_slot=%d".replace("%d",u+1);i&&(i=this.appendLabels(i,arguments),l+="&"+e.$.param(i)),f.linktrack===undefined?f.linktrack="":f.linktrack+="&",f.linktrack+=l}this.istats.track(t,{region:s,linkLocation:n})}},processConfig:function(){var e=this.config.pageviews||{};this.addPageviews(e);var t=this.config.hidden||{};this.addHidden(t);var n=this.config.links||{};this.addTrackingLinks(n)},appendLabels:function(e,t){return typeof e=="function"?this.applyLabels(e,t):e}},n}),define("module/stats/statsConfig",[],function(){var e=function(e){var t="";return typeof e.name!="undefined"?t=e.name:t="rmp",t};return{links:[{name:"top-stories",selector:"#top-stories .unit"},{name:"features-and-analysis",selector:[".features-and-analysis",".collection--featuresandanalysis"]},{name:"top-stories-promo",selector:".collection--topstoriespromo"},{name:"most-read",selector:".component--mostpopular .panel-read"},{name:"most-watched",selector:".component--mostpopular .panel-watched"},{name:"from-other-news-sites",selector:"#comp-from-other-news-sites",type:"external"},{name:"local-live-internal",selector:"#comp-local-live"},{name:"local-live-external",selector:"#comp-local-live",type:"external"},{name:"narrow-navigation-primary",selector:".navigation--narrow__toplevel"},{name:"narrow-navigation-secondary",selector:".secondary-navigation--narrow"},{name:"wide-navigation-primary",selector:".navigation--wide"},{name:"wide-navigation-primary-overflow",selector:".js-navigation-panel-primary"},{name:"wide-navigation-secondary",selector:".navigation-wide-list--secondary"},{name:"wide-navigation-secondary-overflow",selector:".js-navigation-panel-secondary"},{name:"navigation-bottom",selector:".navigation--bottom"},{name:"your-local-news",selector:".find-local-wide__location",action_name:"Locator"},{name:"connected-stream-internal",selector:["#comp-connected-stream .update .update__image","#comp-connected-stream .update .update__headline","#comp-connected-stream .update .update__body"]},{name:"connected-stream-external",selector:"#comp-connected-stream .update .update__body",type:"external"}],pageviews:[{on:"tabs:activate:mostread",countername:"news.popular.read.page"},{on:"tabs:activate:topstories",countername:"news.page"},{on:"tabs:activate:livetext",countername:function(e){return e.replace(/(\d+).*$/,"$1.page")}},{on:"tabs:activate:keypoints",countername:function(e){return e.replace(/(\d+).*$/,"$1.keypoints.page")}},{on:"tabs:activate:contribute",countername:function(e){return e.replace(/(\d+).*$/,"$1.contribute.page")}},{on:"map:asset:request:success",countername:function(e,t,n){return n.countername||e}}],hidden:[{on:"nav:header:open",action_name:"top_navigation_open"},{on:"nav:footer:open",action_name:"bottom_navigation_open"},{on:"locator:submitSearch",action_name:"news.locator"},{on:"locator:geoLocation",action_name:"news.locator"},{on:"video:load",action_type:"video",action_name:"load",labels:function(t){return{player_name:e(t)}}},{on:"video:play",action_type:"video",action_name:"play",labels:function(t){return{player_name:e(t)}}},{on:"video:pause",action_type:"video",action_name:"pause",labels:function(t){return{player_name:e(t)}}},{on:"video:end",action_type:"video",action_name:"end",labels:function(t){return{player_name:e(t)}}},{on:"tabs:activate:maprelated",action_type:"tabchange",action_name:"map-index",labels:{tab_name:"related"}},{on:"tabs:activate:maptopstories",action_type:"tabchange",action_name:"map-index",labels:{tab_name:"topstories"}},{on:"tabs:activate:mapmostwatched",action_type:"tabchange",action_name:"map-index",labels:{tab_name:"mostwatched"}},{on:"map:index:toggle",action_type:"toggle",action_name:"map-index",labels:function(e,t){return{section:e,toggle:t}}},{on:"map:asset:summary",action_type:"toggle",action_name:"map-asset-summary",labels:function(e){return{toggle:e}}},{on:"map:index:topstories",action_type:"toggle",action_name:"map-index-topstories",labels:function(e){return{toggle:e}}},{on:"medianav:select",action_type:"select",action_name:"medianav",labels:function(e,t){return{headline:e.headline,live:e.video.live,index:t}}},{on:"gallery:picture:click",action_type:"click",action_name:"gallery-enhanced"},{on:"gallery:viewer:toggle",action_type:"toggle",action_name:"gallery-enhanced-back",labels:function(e){return{position:e}}},{on:"gallery:caption:toggle",action_type:"toggle",action_name:"gallery-enhanced-caption",labels:function(e){return{toggle:e}}},{on:"gallery:imageonly:toggle",action_type:"toggle",action_name:"gallery-enhanced-image-only",labels:function(e){return{toggle:e}}},{on:"gallery:paginate:click",action_type:"click",action_name:"gallery-enhanced-paginate",labels:function(e,t){return{visibility:e,position:t}}},{on:"stories:more:success",action_type:"select",action_name:"blog-morestories",labels:function(e,t){return{request_count:t.requestCount}}},{on:"stories:fullyloaded",action_type:"event",action_name:"blog-fullyloaded"},{on:"stats:nav:narrow:primary:visibility",action_type:"toggle",action_name:"nav-narrow-primary-visibility",labels:function(e){return{visibility:e}}},{on:"stats:nav:narrow:secondary:visibility",action_type:"toggle",action_name:"nav-narrow-secondary-visibility",labels:function(e){return{visibility:e}}},{on:"stats:nav:narrow:footer:visibility",action_type:"toggle",action_name:"nav-narrow-footer-visibility",labels:function(e){return{visibility:e}}},{on:"stats:nav:narrow:top:primary:accordion:visibility",action_type:"toggle",action_name:"nav-narrow-top-primary-accordion-visibility",labels:function(e,t){return{visibility:e,link:t}}},{on:"stats:nav:narrow:bottom:primary:accordion:visibility",action_type:"toggle",action_name:"nav-narrow-bottom-primary-accordion-visibility",labels:function(e,t){return{visibility:e,link:t}}},{on:"stats:nav:wide:primary:overflow:visibility",action_type:"toggle",action_name:"nav-wide-primary-overflow-visibility",labels:function(e){return{visibility:e}}},{on:"stats:nav:wide:secondary:overflow:visibility",action_type:"toggle",action_name:"nav-wide-secondary-overflow-visibility",labels:function(e){return{visibility:e}}},{on:"stats:nav:narrow:click",action_type:"click",action_name:"nav-narrow-click",labels:function(e,t,n){return{link:e,url:t,strategy:n}}},{on:"stats:nav:wide:outsidePanel:click",action_type:"click",action_name:"nav-wide-outsidePanel-click",labels:function(e,t,n,r){return{link:e,url:t,strategy:n,withinMorePanel:r}}},{on:"stats:nav:wide:insidePanel:click",action_type:"click",action_name:"nav-wide-insidePanel-click",labels:function(e,t,n,r){return{link:e,url:t,strategy:n,withinMorePanel:r}}},{on:"banner:ticker:toggle",action_type:"toggle",action_name:"banner-ticker-click",labels:function(e){return{toggle:e}}},{on:"eucountry:toggle",action_type:"toggle",action_name:"eucountry-click",labels:function(e){return{toggle:e}}},{on:"euexplainer:toggle",action_type:"toggle",action_name:"euexplainer-click",labels:function(e){return{toggle:e}}},{on:"election:map:zoom",action_type:"zoom",action_name:"election-map-zoom",labels:function(e){return{zoom:e}}},{on:"scotref:map",action_type:"click",action_name:"scotref-map",labels:function(e){return{action:e}}},{on:"election:findaresult:change",action_type:"change",action_name:"election-findaresult-change",labels:function(e){return{url:e}}},{on:"stats:comments:open",action_type:"comments",action_name:"show_comments"},{on:"find-local:overlay:toggle",action_type:"find-local-news",action_name:"Locator",labels:function(e){return{visibility:e}}},{on:"find-local:overlay:done",action_type:"done",action_name:"Locator"},{on:"stream:refresh",action_type:"click",action_name:"stream-refresh"},{on:"stream:showmore",action_type:"click",action_name:"stream-showmore"},{on:"scotref:summary:filter",action_type:"click",action_name:"scotref-table-filter",labels:function(e){return{click:e}}}]}}),define("module/nav/nav",["module/bootstrap"],function(e){var t=e.$,n=function(e,t){this.button=e,this.nav=t,this.state=!1,this.name=this.button&&this.button.attr?this.button.attr("data-event"):"",this.setupBindings(),this.setupListeners()};return n.prototype={getName:function(){return this.name},setupListeners:function(){e.pubsub.on("nav:all:close",t.proxy(this.close,this)),e.pubsub.on(this.getEventName("close"),t.proxy(this.close,this)),e.pubsub.on("nav:all:open",t.proxy(this.open,this)),e.pubsub.on(this.getEventName("open"),t.proxy(this.open,this)),e.pubsub.on("tabs:click",t.proxy(this.close,this))},setupBindings:function(){this.button.on("click",t.proxy(function(t){t.preventDefault(),this.state?e.pubsub.emit(this.getEventName("close"),"close"):e.pubsub.emit(this.getEventName("open"),"open")},this)),this.nav.on("click",t.proxy(function(t){e.pubsub.emit(this.getEventName("close"),"close")},this))},close:function(){this.state=!1,t(".site-brand").removeClass(this.getOpenClass()),t("#js-navigation-sections-wrapper").removeClass(this.getOpenClass()),t(".navigation--footer").removeClass(this.getOpenClass())},open:function(){e.pubsub.emit("nav:all:close","close"),this.state=!0,!t(".navigation--footer").hasClass(this.getOpenClass())&&this.getName()==="footer"?t(".navigation--footer").addClass(this.getOpenClass()):(t("#js-navigation-sections-wrapper").addClass(this.getOpenClass()),t(".site-brand").addClass(this.getOpenClass()))},getOpenClass:function(){return"navigation__"+this.getName()+"--open"},getEventName:function(e){return"nav:"+this.getName()+":"+e}},n}),define("module/nav/navManager",["module/bootstrap","module/nav/nav","translator","config"],function(e,t,n,r){var i=e.$;return{init:function(){var e=i("#js-navigation-cta-header"),t=i("<button>"+e.html()+"</button>");i.each(e.prop("attributes"),function(){this.name!=="href"&&t.attr(this.name,this.value)}),e.replaceWith(t),this.bottomNav=i("#js-navigation-sections").removeAttr("role").removeAttr("aria-label"),this.topButton=i("#js-navigation-cta-header"),this.topNavPlaceholder=i(".navigation--open .navigation__panel"),this.createFooterButton(n.get("section")),this.cloneNavToHead(),this.createNavs()},createFooterButton:function(e){var t=r.service.charAt(0).toUpperCase()+r.service.slice(1);this.bottomNav.before('<button class="navigation__cta-footer" data-event="footer" role="navigation" aria-label="'+t+'">'+e+"</button>"),this.bottomButton=i(".navigation__cta-footer")},cloneNavToHead:function(){var e=this.bottomNav[0].cloneNode(!0);e.id="js-navigation-sections-header",this.bottomNav.addClass("footer").attr("id","js-navigation-sections-footer"),this.topNavPlaceholder.append(e),this.topNav=i(e)},createNavs:function(){new t(this.topButton,this.topNav),new t(this.bottomButton,this.bottomNav)}}}),define("module/featureDetector",["config"],function(e){function a(){return/forceVideoSupport/.test(window.location.href)}function f(){return/forceHLS/.test(window.location.href)}function l(e){var t=/forceTouchSupport=(on|off)/.exec(window.location.search);return t&&t[1]?t[1]===e:!1}function c(e,n){return t.hasOwnProperty(n)||(t[n]=u[e+n]?u[e+n]():undefined),t[n]}var t={},n=/OS ([0-9])/,r=document.documentElement,i="modernizr",s=document.createElement(i),o=s.style,u={isIos:function(){return/(iPod|iPad|iPhone)/.test(navigator.userAgent)},isIosVersion:function(e){var t=n.exec(navigator.userAgent);return t&&t[1]?Number(t[1])>=e?!0:!1:!1},isIos4:function(){return this.isIosVersion(4)},isAndroid:function(){return/Android/i.test(navigator.userAgent)},isAndroidMobile2:function(){return this.isAndroid()&&/Mobile/i.test(navigator.userAgent)&&/Android 2./.test(navigator.userAgent)},isAndroidMobile22:function(){return this.isAndroid()&&/Mobile/i.test(navigator.userAgent)&&/2.2/.test(navigator.userAgent)},isIE10:function(){return/MSIE 10/.test(navigator.userAgent)},isWindowsPhone:function(){return/Windows Phone/.test(navigator.userAgent)},isChrome:function(){return/Chrome/.test(navigator.userAgent)},canUseHistoryApi:function(){return window.history&&window.history.pushState},isHolepunched:function(){return!!document.getElementById("js-holepunched")},isContinuousPlayEnabled:function(){return!!document.getElementById("continuous-play-enabled")},isShowingDesktopAds:function(){return!!document.getElementById("advert-post-script-load")},isCollectingGNLAnalytics:function(){return!!document.getElementById("gnlAnalyticsEnabled")},canPlayHls:function(){return f()||this.isChrome()?!0:this._canPlayType("application/x-mpegURL")},canPlayAppleHls:function(){return a()?!0:this._canPlayType("application/vnd.apple.mpegurl")&&this.isIos()&&this.isIosVersion(5)&&!this._isWsChannelPage()},canPlayAppleHlsWs:function(){return a()?!0:this._canPlayType("application/vnd.apple.mpegurl")&&this.isIos()&&this._isWsChannelPage()},canPlayH264:function(){return a()?!0:this._canPlayType('video/mp4; codecs="avc1.42E01E"')||this.isAndroidMobile22()},canPlayBump:function(){var t=e.configuration||{};return t.cms&&t.cms==="topcat"?this.isLargeScreen()&&!this.isTouchDevice():!0},_canPlayType:function(t){var n=document.createElement("video");if(n.canPlayType){var r=n.canPlayType(t);return e.configuration.cms==="topcat"&&!e.isChannelPage?r==="probably":r==="probably"||r==="maybe"}},_contains:function(e,t){return!!~(""+e).indexOf(t)},_injectElementWithStyles:function(e,t,n,s){var o,u,a,f,l=document.createElement("div"),c=document.body,h=c||document.createElement("body");if(parseInt(n,10))while(n--)a=document.createElement("div"),a.id=s?s[n]:i+(n+1),l.appendChild(a);return o=["&#173;",'<style id="s',i,'">',e,"</style>"].join(""),l.id=i,(c?l:h).innerHTML+=o,h.appendChild(l),c||(h.style.background="",h.style.overflow="hidden",f=r.style.overflow,r.style.overflow="hidden",r.appendChild(h)),u=t(l,e),c?l.parentNode.removeChild(l):(h.parentNode.removeChild(h),r.style.overflow=f),!!u},_testProps:function(e,t){for(var n in e){var r=e[n];if(!this._contains(r,"-")&&o[r]!==undefined)return t==="pfx"?r:!0}return!1},_testPropsAll:function(e,t,n){var r="Webkit Moz O ms",i=r.split(" "),s=e.charAt(0).toUpperCase()+e.slice(1),o=(e+" "+i.join(s+" ")+s).split(" ");return this._testProps(o,t)},canCssColumn:function(){return!!this._testPropsAll("columnCount")},canCssTransition:function(){return!!this._testPropsAll("transition")},whichTransitionEnd:function(){var e=document.createElement("fakeelement"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var n in t)if(e.style[n]!==undefined)return t[n]},canCssTransform:function(){return!!this._testPropsAll("transform")},canCssPreserve3d:function(){if(!this.canCssTransform())return!1;var e=!!this._testPropsAll("transformStyle");return e&&this._injectElementWithStyles("#modernizr { transform-style: preserve-3d; -webkit-transform-style: preserve-3d; -moz-transform-style: preserve-3d; -o-transform-style: preserve-3d; }",function(t,n){if(!window.getComputedStyle)return!1;var r="preserve-3d",i=window.getComputedStyle(t),s=i.getPropertyValue("-webkit-transform-style")===r,o=i.getPropertyValue("-moz-transform-style")===r,u=i.getPropertyValue("-o-transform-style")===r,a=i.getPropertyValue("transform-style")===r;e=a||u||o||s}),e},canCssTransform3d:function(){var e=!!this._testPropsAll("perspective");return e&&"webkitPerspective"in r.style&&this._injectElementWithStyles("@media (transform-3d), (-webkit-transform-3d) { #modernizr{ left: 9px; position: absolute; height: 3px; }}",function(t,n){e=t.offsetLeft===9&&t.offsetHeight===3}),e},canTouchEvents:function(){return"ontouchstart"in window},canSVG:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},isTouchDevice:function(){return l("off")?!1:l("on")||this.canTouchEvents()||"onmsgesturechange"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:!1},isLargeScreen:function(){var e=window.innerWidth>0?window.innerWidth:screen.width;return e>1024?!0:!1},_isWsChannelPage:function(){return e.isChannelPage&&e.configuration.cms==="topcat"}};return{can:function(e){return c("can",e)},is:function(e){return c("is",e)},which:function(e){return c("which",e)},__cacheClear:function(){t={}}}}),define("module/navigation/overflow",["module/bootstrap","translator"],function(e,t){function s(s,o,u){function S(){var e=f.filter(function(e){return this.offsetTop>0}).length;return e?!0:!1}function x(){b=n('<li class="navigation__more-button-container">                    <button class="navigation__more-button navigation-arrow" data-panel-id="'+l+'">'+t.get("navMoreButton")+'<span class="off-screen">'+t.get("navMoreLabel")+"</span></button>                </li>"),w=b.find(".navigation__more-button"),a.append(b)}function T(){var t=e.config.features2&&(e.config.features2.rtl||e.config.cssPostfix==="-rtl")?"padding-left":"padding-right";a.css(t,b.width()+"px"),a.css("max-width",p-b.width()+"px")}function N(){var e;e=(new RegExp("\\b"+d+"\\b","i")).test(this.className),e&&this.blur(),w.removeClass(d)}function C(){var e=n('<div class="navigation-panel__content"><div class="navigation-panel__inner"></div></div>'),t=n('<div class="navigation-panel navigation-panel--wide navigation-panel--closed '+l+'"></div>');t.append(e),E=e.find(".navigation-panel__inner"),s.after(t),k(),t=e=null,u.statsName&&r.emit("component:loaded",u.statsName)}function k(){var e=f,t=e.length,n=-1,r=[],i,s=!1;while(++n<t){var o=e[n],u=o.offsetTop>0;o.className=o.className.replace(/\binvisible\b/,"");if(u){s||(A(L(e,n)),s=!0);var a=o.cloneNode(!0);a=O(a),r.push(a),o.className+=" invisible"}}i=M(r),E.html(i),H()}function L(t,n){var r=t[n-1].offsetLeft;return r+=e.config.features2&&(e.config.features2.rtl||e.config.cssPostfix==="-rtl")?-b.width():t[n-1].offsetWidth,r}function A(e){b.css("left",e+"px")}function O(e){var t=e.getElementsByTagName("a");return t.length&&(t[0].className="navigation-panel-toplevel__link"),e}function M(e){var t=i.documentElement.clientWidth,n=document.createDocumentFragment();v=[],m=e,g=D(t),y=Math.ceil(m.length/g),B();for(var r=0,s=g;r<s;r++){var o=_();o.className+=" navigation-panel-toplevel--columnised-"+g;for(var u=0,a=v[r].length;u<a;u++)o.appendChild(v[r][u].cloneNode(!0));a>0&&n.appendChild(o)}return n}function _(){var e=document.createElement("ul");return e.className="navigation-panel-toplevel",e}function D(e){var t;return e>=h[2]&&e<h[3]?t=2:e>=h[3]&&e<h[4]?t=3:t=4,t}function P(){var e=0,t=1;return function(){v.push(m.slice(e,e+y)),e+=y,t++,t<=g?B():(e=0,t=1)}}function H(){a.length&&a[0].getElementsByClassName("invisible selected").length===1?(b&&b.addClass("selected"),u.overflowEvents&&r.emit("nav:selectedIsHidden")):(b&&b.removeClass("selected"),u.overflowEvents&&r.emit("nav:selectedIsVisible"))}var a=s.find("ul"),f=a.find("li"),l=a.attr("data-panel-id"),c=!1,h={2:600,3:740,4:1008},p=992,d="navigation__more-button--highlight",v,m,g,y,b,w,E;u=u||{},this.toggleMoreButtonHighlight=function(){var t;w.hasClass(d)?(N(),t="hidden"):(w.addClass(d),t="visible"),e.pubsub.emit("stats:nav:wide:"+o+":overflow:visibility",[t])},this.removeMoreButtonHighlight=function(){typeof w!="undefined"&&w.removeClass(d)},this.checkOverflowStatus=function(){S()?(c=!0,b?(b.removeClass("hidden"),k()):(x(),T(),C())):b&&c&&(c=!1,r.emit("nav:overflowEmpty",[l]),b.addClass("hidden"),N(),k())},this.checkIfSelectedIsOverflowed=function(){H()};var B=P();this.checkOverflowStatus()}var n=e.$,r=e.pubsub,i=e.window.document;return s}),define("module/navigation/wideView",["module/bootstrap","module/navigation/overflow"],function(e,t){function h(){n("body").on("click",".navigation-wide-list a",function(t){e.pubsub.emit("stats:nav:wide:outsidePanel:click",[n(t.currentTarget).text(),t.currentTarget.href,"wide",!1])}),n("body").on("click",".navigation-panel--wide a",function(t){e.pubsub.emit("stats:nav:wide:insidePanel:click",[n(t.currentTarget).text(),t.currentTarget.href,"wide",!0])});var t=".js-navigation-panel-primary li a, .js-navigation-panel-secondary li a",r="#page, .secondary-navigation--wide a";n("body").on("focus",t,function(){s=!1,i=!0}),n("body").on("blur",t,function(){s=!0,i=!1}),n("body").on("focus",r,function(){p()&&(e.pubsub.emit("nav:wide:panel:lostFocus"),s=i=!1)}),n("body").on("click",".navigation__more-button",function(t){t.preventDefault(),e.pubsub.emit("nav:more:clicked",t)})}function p(){return!i&&s}function d(){a&&(a.checkOverflowStatus(),a.checkIfSelectedIsOverflowed()),u&&f&&(f.checkOverflowStatus(),f.checkIfSelectedIsOverflowed())}function v(){a.removeMoreButtonHighlight(),f&&f.removeMoreButtonHighlight()}function m(){u.length?(a=new t(o,"primary",{statsName:"wide-navigation-primary-overflow"}),f=new t(u,"secondary",{overflowEvents:!0,statsName:"wide-navigation-secondary-overflow"})):a=new t(o,"primary",{statsName:"wide-navigation-primary-overflow"})}function g(){o=n(".navigation.navigation--wide"),u=n(".navigation-wide-list--secondary"),m(),h()}function y(){l||(g(),l=!0),d(),c=!0}function b(){l&&(v(),c=!1)}function w(e){var t=n(e.currentTarget).attr("data-panel-id");if(!t)return;t.match(/primary/)?(a.toggleMoreButtonHighlight(),f&&f.removeMoreButtonHighlight()):(f.toggleMoreButtonHighlight(),a.removeMoreButtonHighlight())}var n=e.$,r,i,s,o,u,a,f,l=!1,c=!1;return{enable:y,disable:b,toggleMoreButtonHighlights:w}}),define("module/navigation/narrowView",["module/bootstrap","translator"],function(e,t){function g(){n("body").on("click",".navigation__section",function(e){e.preventDefault(),r.emit("nav:sections:clicked",e)}),n("body").on("click",".navigation--narrow .navigation-arrow, .navigation--footer .navigation-arrow",function(e){e.preventDefault(),r.emit("nav:arrow:clicked",e)}),n("body").on("click",".navigation__footerButton",function(e){e.preventDefault(),r.emit("nav:footerButton:clicked",e)})}function y(){o=n("#navigation--bottom"),o.find(".navigation-panel").removeAttr("id"),o.find(".navigation-core-title").remove(),o.removeClass("core--with-secondary"),s=o.clone(),s.attr("id","navigation--top")}function b(){var r=e.config.service.replace(/(\w)/,function(e,t){return t.toUpperCase()});u=n(".navigation__footerButton"),a=n(".navigation--footer");var i=n('<button class="navigation__cta-footer navigation__footerButton" role="navigation" aria-label="'+r+'">'+t.get("navFooterSectionsButton")+"</button>");o.before(i)}function w(){var e=f.find(".secondary-navigation__title span"),t=f.find(".selected .navigation-narrow-item span").text()||e.text();e.text(t)}function E(){l.addClass("navigation__section--enhanced"),l.removeClass("navigation__section--core"),s.addClass("navigation--narrow"),s.removeClass("navigation--bottom"),S(),n(".site-brand").after(s),p&&(x(),w(),n(".site-brand").after(f)),T()}function S(){s.children().first().removeClass("navigation--bottom__toplevel").addClass("navigation--narrow__toplevel")}function x(){if(p===!1)return;var t=n("#secondary-navigation--bottom");f=n('<div class="secondary-navigation secondary-navigation--narrow secondary-navigation--narrow-closed"></div>');if(t){var r=t.clone();r.addClass("secondary-navigation-narrow-list"),r.removeAttr("id"),r.find(".navigation-core-title").remove(),r.find(".navigation-core-index").remove(),r.removeClass("secondary-navigation--bottom"),r.find(".navigation-arrow").on("click",function(t){t.stopPropagation(),t.preventDefault(),e.pubsub.emit("nav:narrow:secondary:arrow:clicked",t)}),t.addClass("hidden"),f.append(r)}}function T(){return n(".navigation--narrow__toplevel, .navigation--bottom__toplevel").each(function(){var e=n(this).find(".selected .navigation-panel-secondary");if(e.length>0){var t=e.find(".selected");t.length===0&&e.find("li").first().addClass("selected")}}),this}function N(){return C()||k()}function C(){return f&&f.find("ul .selected").length>0}function k(){return f!==undefined&&f.children().length===0}function L(){N()?r.emit("nav:selectedIsHidden"):r.emit("nav:selectedIsVisible")}function A(){n("body").removeClass(m),e.pubsub.emit(v,["hidden"]),d=!1}function O(){n("body").addClass(m),e.pubsub.emit(v,["visible"]),d=!0}function M(e){d?A():O()}function _(){var e=n(".secondary-navigation--narrow"),t;e.hasClass("secondary-navigation--narrow-closed")?(e.removeClass("secondary-navigation--narrow-closed"),t="visible"):(e.addClass("secondary-navigation--narrow-closed"),t="hidden"),D(t)}function D(t){e.pubsub.emit("stats:nav:narrow:secondary:visibility",t)}function P(){f.addClass("secondary-navigation--narrow-closed"),D("hidden")}function H(t){var r=t.currentTarget;if(!r||!r.href)return;var i=r.href.replace(/.+bbc\.co\.uk/i,""),s="navigation-arrow--open",o=".navigation--bottom__toplevel",u=".navigation--narrow__toplevel",a=o+" ."+s+", "+u+" ."+s,f=n('.navigation-arrow[href="'+i+'"]'),l=f.find("span").eq(0).text(),c="navigation-list-item--open",h;n(a).not(f).removeClass(s),n("."+c).removeClass(c),f.hasClass(s)?(f.removeClass(s),h="hidden"):(f.addClass(s),n(r).parent().addClass(c),h="visible"),e.pubsub.emit("stats:nav:narrow:top:primary:accordion:visibility",[h,l])}function B(){var e="navigation__footer--open",t;a.hasClass(e)?(a.removeClass(e),t="hidden"):(a.addClass(e),t="visible"),r.emit("stats:nav:narrow:footer:visibility",[t])}function j(){L()}function F(){n(".navigation-arrow--open").removeClass("navigation-arrow--open"),p&&f&&f.addClass("secondary-navigation--narrow-closed"),l.removeClass("navigation__section--open"),n("body").removeClass("narrow-primary-navigation-open")}function I(){l=n(".navigation__section"),c=n("#page"),g(),y(),b(),E(),L(),h=!0,r.emit("nav:narrow:loaded")}function q(){h?j():I()}function R(){h&&F()}var n=e.$,r=e.pubsub,i=e.window,s,o,u,a,f,l,c,h=!1,p=!0,d=!1,v="stats:nav:narrow:primary:visibility",m="narrow-primary-navigation-open";return{enable:q,disable:R,togglePrimaryNav:M,toggleSecondaryNav:_,hidePrimaryNav:A,hideSecondaryNav:P,accordionNavItem:H,publishSelectedVisibilityState:L,toggleFooterNav:B}}),define("module/navigation/panels",["module/bootstrap"],function(e){function s(e){return r[e]||(r[e]=t("."+e)),r[e]}function o(e){var s=e?[t("."+e)]:r;for(var o in s)s[o].hasClass(i)||s[o].addClass(i);n.emit("nav:overflow:toggle","hidden")}function u(){t(".navigation--narrow__toplevel .navigation-arrow").each(function(e,n){var i=t(n).attr("data-panel-id");i&&(r[i]=t("."+i))})}function a(){var e="navigation-panel--wide";r[e]=t("."+e)}function f(e){var r=e.currentTarget,u=t(r).attr("data-panel-id"),a=s(u),f;return a.hasClass(i)?(o(),a.removeClass(i),f=!0,n.emit("nav:overflow:toggle","visible")):(a.addClass(i),f=!1,n.emit("nav:overflow:toggle","hidden")),f}var t=e.$,n=e.pubsub,r={},i="navigation-panel--closed";return{cacheNarrow:u,cacheWide:a,close:o,togglePanel:f}}),define("vendor/locator/main",["module/bootstrap","locator/locatorView","locator/stats"],function(bootstrap,LocatorView,Stats){function doRequest(url,success,actionType,complete){typeof complete=="function"&&(complete=function(){}),bootstrap.ajax({url:url,dataType:"json",method:"get",complete:complete,success:success,error:function(e){var responseText,response;responseText=e&&e.responseText?e.responseText:"{}";try{response=window.JSON?window.JSON.parse(responseText):eval("("+responseText+")")}catch(err){response=null}bootstrap.pubsub.emit("locator:error",[response,actionType])}})}function normaliseCoordinate(e){var t=1e3;return String(Math.round(e*t)/t)}var Locator,newsMap={3:"england/berkshire",4:"england/birmingham_and_black_country",7:"england/bristol",8:"england/cambridgeshire",11:"england/cornwall",12:"england/coventry_and_warwickshire",13:"england/cumbria",16:"england/derbyshire",17:"england/devon",18:"england/dorset",19:"scotland/edinburgh_east_and_fife",20:"england/essex",22:"scotland/glasgow_and_west",23:"england/gloucestershire",26:"world/europe/guernsey",27:"england/hampshire",28:"england/hereford_and_worcester",30:"scotland/highlands_and_islands",31:"england/humberside",32:"world/europe/isle_of_man",33:"world/europe/jersey",34:"england/kent",35:"england/lancashire",36:"england/leeds_and_west_yorkshire",37:"england/leicester",38:"england/lincolnshire",39:"england/merseyside",40:"england/london",41:"england/manchester",42:"wales/mid_wales",43:"england/norfolk",44:"england/northamptonshire",45:"scotland/north_east_orkney_and_shetland",46:"wales/north_east_wales",21:"northern_ireland",47:"wales/north_west_wales",49:"england/nottingham",50:"england/oxford",57:"england/south_yorkshire",51:"england/shropshire",52:"england/somerset",53:"wales/south_east_wales",55:"scotland/south_scotland",56:"wales/south_west_wales",58:"england/stoke_and_staffordshire",59:"england/suffolk",66:"england/surrey",60:"england/sussex",61:"scotland/tayside_and_central",62:"england/tees",1:"england/beds_bucks_and_herts",63:"england/tyne_and_wear",65:"england/wiltshire",48:"england/york_and_north_yorkshire"},newsRegionsMap={56:"South West Wales",28:"Hereford &amp; Worcester",36:"Leeds and Bradford",60:"Sussex",61:"Tayside &amp; Central Scotland",62:"Tees",63:"Tyne and Wear",35:"Lancashire",66:"Surrey",34:"Kent",26:"Guernsey",27:"Hampshire",20:"Essex",21:"Northern Ireland",48:"York &amp; North Yorkshire",49:"Nottinghamshire",46:"North East Wales",47:"North West Wales",44:"Northampton",45:"North East Scotland Orkney &amp; Shetland",42:"Mid Wales",43:"Norfolk",40:"London",41:"Manchester",1:"Beds Herts &amp; Bucks",3:"Berkshire",4:"Birmingham and Black Country",7:"Bristol",8:"Cambridgeshire",13:"Cumbria",12:"Coventry &amp; Warwickshire",30:"Highlands &amp; Islands",58:"Stoke &amp; Staffordshire",11:"Cornwall",39:"Liverpool",38:"Lincolnshire",59:"Suffolk",22:"Glasgow &amp; West of Scotland",17:"Devon",16:"Derby",19:"Edinburgh Fife &amp; East of Scotland",18:"Dorset",31:"Humberside",23:"Gloucestershire",51:"Shropshire",50:"Oxford",53:"South East Wales",52:"Somerset",33:"Jersey",55:"South Scotland",37:"Leicestershire",32:"Isle of Man",57:"Sheffield &amp; South Yorkshire",65:"Wiltshire"},newsTldMap={56:"southwestwales",42:"midwales",50:"oxford",60:"sussex",61:"taysideandcentralscotland",62:"tees",63:"tyne",49:"nottingham",66:"surrey",52:"somerset",53:"southeastwales",26:"guernsey",27:"hampshire",20:"essex",21:"northernireland",22:"glasgowandwestscotland",23:"gloucestershire",46:"northeastwales",47:"northwestwales",44:"northampton",45:"northeastscotlandnorthernisles",28:"herefordandworcester",43:"norfolk",40:"london",41:"manchester",1:"threecounties",3:"berkshire",4:"birmingham",7:"bristol",8:"cambridgeshire",39:"liverpool",38:"lincolnshire",58:"stoke",11:"cornwall",51:"shropshire",13:"cumbria",12:"coventry",59:"suffolk",48:"york",17:"devon",16:"derby",19:"edinburghandeastscotland",18:"dorset",31:"humberside",30:"highlandsandislands",37:"leicester",36:"leeds",35:"lancashire",34:"kent",33:"jersey",55:"southscotland",32:"isleofman",57:"sheffield",65:"wiltshire"},nationsMap={e:"england",n:"northernireland",s:"scotland",w:"wales"};return Locator=function(e){var t,n,r,i,s;t=this,r=!1,e=e||{},this.host=e.host||"",this.getLocation(),this.action="",e.pubsub&&(bootstrap.pubsub=e.pubsub),this._persistLocation=e.persistLocation||!1,s=!!e.confirmLocationSelection,this.confirmLocationSelection=s,i=new Stats(bootstrap.pubsub),i.applyEvents(),bootstrap.pubsub.on("locator:open",function(i){if(!r){r=!0,n=new LocatorView(i,{enableReverseGeocode:e.enableReverseGeocode!==!1,enableAutoComplete:e.enableAutoComplete!==!1}),t.location&&t._persistLocation===!0?bootstrap.pubsub.emit("locator:renderChangePrompt"):bootstrap.pubsub.emit("locator:renderForm");var o=t.getNewsRegionChoices();o.length>1&&(bootstrap.pubsub.emit("locator:renderForm"),bootstrap.pubsub.emit("locator:newsLocalRegions",[{location:{id:t.location.id},regions:o}])),bootstrap.pubsub.on("locator:locationSelected",function(e){s?t.action==="geolocate"?n.renderGeolocationResult(e):n.results.children.length===0&&n.renderSearchResults({results:[e]}):n.resetForm()}),bootstrap.pubsub.on("locator:newsLocalRegions",function(){s&&n.setMoreResultsDisplay("none")})}}),bootstrap.pubsub.on("locator:close",function(e){r&&(r=!1,n.close(),n=null)}),bootstrap.pubsub.on("locator:geoLocation",function(e){t.geoLocate(e.coords.latitude,e.coords.longitude)}),bootstrap.pubsub.on("locator:submitSearch",function(e,n){t.search(e,n)}),bootstrap.pubsub.on("locator:submitLocation",function(e,n){t.checkLocation(e,n)}),bootstrap.pubsub.on("locator:submitAutoCompleteSearch",function(e){t.autoComplete(e)}),bootstrap.pubsub.on("locator:submitAutoCompleteLocation",function(e,n){t.checkLocation(e,null)})},Locator.prototype.open=function(e){bootstrap.pubsub.emit("locator:open",[e])},Locator.prototype.close=function(){bootstrap.pubsub.emit("locator:close")},Locator.prototype.handleLocation=function(e){this.locationSelection=e,this._persistLocation===!0?(this.persistLocation(e),bootstrap.pubsub.emit("locator:renderChangePrompt"),bootstrap.pubsub.emit("locator:locationChanged",[this.getLocation()])):bootstrap.pubsub.emit("locator:locationSelected",[e])},Locator.prototype.checkLocation=function(e,t){var n=this,r=this.host+"/locator/news/responsive/location.json?id="+e;this.confirmLocationSelection||bootstrap.pubsub.emit("locator:renderWait"),t&&(r+="&newsRegion="+t),doRequest(r,function(e){n.handleResponse(e)},"location")},Locator.prototype.handleResponse=function(e){"search_results"===e.type?bootstrap.pubsub.emit("locator:searchResults",[e]):"autocomplete_search_results"===e.type?bootstrap.pubsub.emit("locator:autoCompleteSearchResults",[e]):"news_regions"===e.type?bootstrap.pubsub.emit("locator:newsLocalRegions",[e]):"geolocation"===e.type?e.isWithinContext||bootstrap.pubsub.emit("locator:locationOutOfContext",[e]):"location"===e.type&&this.handleLocation(e)},Locator.prototype.setLocServCookie=function(e){var t,n;e=e||{},e.type==="location"&&e.cookie&&e.expires&&(n=this.getCookieDomain(window.location.hostname),!1!==n&&(t="locserv="+e.cookie+"; expires="+(new Date(e.expires*1e3)).toUTCString()+"; path=/; domain="+n,this.setCookieString(t),this.hasParsedCoookie=!1))},Locator.prototype.getCookieDomain=function(e){var t;return typeof e!="string"?!1:(t=e.match(/bbc\.co(\.uk|m)$/),t&&t.length===2?"."+t[0]:!1)},Locator.prototype.persistLocation=function(e,t){var n,r,i;if(this._persistLocation===!1)return;i=this;if(!e&&!t&&typeof this.locationSelection=="object"||typeof e=="object"&&e===this.locationSelection){this.setLocServCookie(this.locationSelection);return}if(e&&t){e=e.toString();if(this.locationSelection&&this.locationSelection.id===e&&this.locationSelection.news.id===t){this.setLocServCookie(this.locationSelection);return}r=this.host+"/locator/news/responsive/location.json?id="+e,r+="&newsRegion="+t,doRequest(r,function(e){i.setLocServCookie(e)},"location");return}typeof e=="object"&&this.setLocServCookie(e)},Locator.prototype.search=function(e,t){var n=this.host+"/locator/news/responsive/search.json?search="+encodeURIComponent(e),r=this;this.action="search",t&&(n+="&offset="+t),bootstrap.pubsub.emit("locator:renderWait"),doRequest(n,function(e){r.handleResponse(e)},"search")},Locator.prototype.autoComplete=function(e){var t=this.host+"/locator/news/responsive/autocomplete.json?search="+e,n=this;doRequest(t,function(e){n.handleResponse(e)},"autocomplete")},Locator.prototype.geoLocate=function(e,t){var n=this.host+"/locator/news/responsive/geolocate.json?"+"latitude="+normaliseCoordinate(e)+"&longitude="+normaliseCoordinate(t),r=this;this.action="geolocate",bootstrap.pubsub.emit("locator:renderWait"),doRequest(n,function(e){r.handleResponse(e)},"geolocate")},Locator.prototype.getCookieString=function(){return document.cookie},Locator.prototype.setCookieString=function(e){document.cookie=e},Locator.prototype.getNewsRegionChoices=function(){var e,t,n,r;n=[],t=this.getCookieString().match(/locserv=[\w\W]*?(r=([\d+\.?]+))[;|\s|$]?/);if(t){e=t[2].split(".");for(r=0;r<e.length;r++)n.push({id:newsTldMap[e[r]],name:newsRegionsMap[e[r]]})}return n},Locator.prototype.getLocation=function(){var e,t,n,r,i;if(this.hasParsedCoookie)return this.location;r=function(e){var t,n,r,i,s={};n=e.substr(0,1),e=e.substr(3),r=e.split(":");for(t=0;t<r.length;t++)i=r[t].split("="),i[1]=i[1].replace(/\+/g,"%20"),s[i[0]]=decodeURIComponent(i[1]);return{name:n,data:s}},e=this.getCookieString().match("locserv=(.*?)(;|$)");if(!e||e.length<2)return null;this.location={id:null,name:null,nation:null,news:null,weather:null},t=e[1].substr(2).split("@");for(i=0;i<t.length;i++)n=r(t[i]),"l"===n.name?(this.location.id=n.data.i,this.location.name=n.data.n,n.data.h&&(this.location.nation=nationsMap[n.data.h])):"w"===n.name?this.location.weather={id:n.data.i,name:n.data.p}:"n"===n.name&&(this.location.news={id:n.data.r,path:newsMap[n.data.r]});return this.hasParsedCoookie=!0,this.location},Locator.prototype.setPersistance=function(e){var t=this._persistLocation;return this._persistLocation=e,t},Locator}),define("module/locatorInstance",["config","module/bootstrap","vendor/locator/main"],function(e,t,n){return new n({pubsub:t.pubsub,enableReverseGeocode:e.local&&e.local.allowLocationLookup?e.local.allowLocationLookup:!1,enableAutoComplete:e.local&&e.local.allowAutoComplete?e.local.allowAutoComplete:!1,host:e.locatorHost,confirmLocationSelection:!0,persistLocation:!0})}),define("module/locatorFacade",["config","module/locatorInstance"],function(e,t){var n=function(){return t.getNewsRegionChoices()},r=function(){return t.getLocation()},i=function(){return e.pathPrefix+"/"+t.getLocation().news.path},s=function(e){t.open(e)},o=function(e){t.handleLocation(e)},u=function(e,n){t.close(),t.setPersistance(n),t.open(e)},a=function(e){return t.setPersistance(e)},f=function(e){return t.persistLocation(e)};return{getNewsRegionChoices:n,getLocation:r,getLocationIndexUrl:i,open:s,handleLocation:o,insert:u,setPersistance:a,persistLocation:f}}),define("module/findLocalNews",["module/bootstrap","module/locatorFacade","translator"],function(e,t,n){var r,i=!1,s=".locator",o=!1,u=!1,a,f="content-interstitial-overlay-open",l=function(){return e.$(".find-local-wide").length!==0},c=function(){var e=t.getNewsRegionChoices(),n="";return e instanceof Array&&e.length>=1&&e[0].name&&(n=e[0].name),n},h=function(){var n=c(),r="",i,s,o;""!==n&&(e.$(".find-local-wide__link").addClass("find-local-wide__link--icon-only"),o='<a href="'+t.getLocationIndexUrl()+'" class="find-local-wide__location">'+n+"</a>",s=e.$(".find-local-wide__location"),s.length>0?s.replaceWith(o):e.$("#find-local-wide").prepend(o),e.pubsub.emit("component:loaded",["find-local-location-wide"]))},p=function(){var t=c(),r="",i=n.get("locationSettings");return""!==t&&(r=n.get("locationYourLocationIs").replace("@","<strong>"+t+"</strong>")),e.$(".site-brand").after('<div class="find-local-overlay">                <div class="find-local-overlay__inner">                    <h2 class="find-local-overlay__title">'+i+'</h2>                    <p class="find-local-overlay__current-location">'+r+'</p>                    <div class="find-local-overlay__locator">                    </div>                </div>                <div class="find-local-overlay__controls">                    <button type="button" class="find-local-overlay__cancel">Cancel</button>                    <button type="button" class="find-local-overlay__done" disabled="">Done</button>                </div>            </div>'),e.$(".find-local-overlay")},d=function(){e.$(".find-local-overlay__cancel").on("click",v),e.$(".find-local-overlay__done").on("click",g)},v=function(){i&&t.insert(s,!0),e.$("body").removeClass(f).css({height:"",backgroundColor:""}),e.$("#orb-footer").css("display","block"),e.$(".find-local-wide").removeClass("hidden"),u&&m("hidden"),u=!1},m=function(t){e.pubsub.emit("find-local:overlay:toggle",t)},g=function(){r!==null&&(t.setPersistance(!0),t.persistLocation(r),e.pubsub.emit("find-local:overlay:done"),window.location.href=t.getLocationIndexUrl())},y=function(){o?e.$(".find-local-overlay__done").prop("disabled",!0):(o=!0,p(),d()),t.insert(".find-local-overlay__locator",!1),r=null,e.$("body").addClass(f).css({height:"100%",backgroundColor:"#000"}),e.$("#orb-footer").css("display","none"),e.$(".find-local-wide").addClass("hidden");var n=e.$("#locator-search-input");n.length>0&&n[0].focus(),u=!0,m("visible"),e.pubsub.emit("findLocal:overlayVisible")},b=function(){e.$(".find-local-narrow").addClass("navigation-arrow--open"),a?a.addClass("find-local-narrow-panel--open"):(e.$(".find-local-narrow").after('<div class="find-local-narrow-panel find-local-narrow-panel--open"><a class="find-local-narrow-panel__index-link" href='+t.getLocationIndexUrl()+">"+c()+'</a>                    <button id="change-location-narrow" class="change-location-narrow">Change location</button>                </div>'),a=e.$(".find-local-narrow-panel"))},w=function(){e.$(".find-local-narrow").removeClass("navigation-arrow--open"),a&&a.removeClass("find-local-narrow-panel--open")},E=function(){e.$(".find-local-narrow").hasClass("navigation-arrow--open")?w():b()},S=function(){e.$("#site-container").on("click",".find-local-wide__link, #change-location-narrow",y),e.pubsub.on("locator:submitSearch",function(){r=null,e.$(".find-local-overlay__done").prop("disabled",!0)}),e.pubsub.on("locator:locationSelected",function(t){r=t,e.$(".find-local-overlay__done").prop("disabled",!1)}),e.pubsub.on("locator:locationChanged",h),e.$("#site-container").on("click",".find-local-narrow",function(){t.getLocation()?E():y()})},x=function(){if(l()){var t='                <li><button class="find-local-narrow navigation-narrow-item navigation-arrow"><span>Your local news</span></button></li>            ';e.$("#navigation--top li").eq(0).after(t)}},T=function(){l()&&(S(),h(),i=e.$(s).length===1)};return{init:T,closeNarrowPanel:w,showOverlay:y,hideOverlay:v,insertIntoNarrowNav:x}}),define("module/indexTitle",["module/bootstrap"],function(e){var t=e.$("#comp-index-title"),n=t.data("index-title-meta")||null,r=!1,i=!1,s="index-title--redundant";n&&n.opts&&(r=n.opts.alwaysVisible||!1,i=n.opts.onFrontPage||!1);var o=function(){i||t.removeClass(s)},u=function(){r||t.addClass(s)},a=function(){t.hasClass(s)?o():u()},f=function(){i||o()};return{show:o,hide:u,toggle:a,init:f}}),define("module/navigation/mediaPlaceholder",["module/bootstrap"],function(e){var t=e.$(".media-placeholder"),n="media-placeholder--hidden",r="active",i=!1;return{activate:function(){i=!0},show:function(){i&&t.addClass(n)},hide:function(){i&&t.removeClass(n)}}}),define("module/navigation/mediator",["module/navigation/wideView","module/navigation/narrowView","module/navigation/panels","module/findLocalNews","module/indexTitle","module/navigation/mediaPlaceholder"],function(e,t,n,r,i,s){function o(){s.hide(),e.disable(),n.close(),t.enable(),n.cacheNarrow()}function u(){t.disable(),n.close(),e.enable(),n.cacheWide(),r.closeNarrowPanel()}function a(){e.enable(),n.cacheWide()}function f(){r.hideOverlay(),t.togglePrimaryNav(),i.toggle()}function l(){t.hidePrimaryNav(),t.hideSecondaryNav()}function c(e){t.accordionNavItem(e),n.togglePanel(e)}function h(){t.toggleSecondaryNav()}function p(t){e.toggleMoreButtonHighlights(t),n.togglePanel(t)}function d(e){t.toggleFooterNav(e)}function v(){t.publishSelectedVisibilityState()}function m(){r.insertIntoNarrowNav()}function g(){n.close(),s.hide()}function y(e){n.close(e)}function b(){i.hide()}function w(){i.show()}function E(){s.show()}function S(){s.hide()}return{enableWideStrategy:u,refreshWideStrategy:a,enableNarrowStrategy:o,toggleNarrowNav:f,toggleNarrowFooterNav:d,toggleNarrowSecondaryNav:h,toggleNarrowNavItem:c,toggleWideOverflow:p,hideNarrowNav:l,publishSelectedVisibilityState:v,insertFindLocalIntoNarrowNav:m,closePanels:g,closePanel:y,hideIndexTitle:b,showIndexTitle:w,showMediaPlaceholder:E,hideMediaPlaceholder:S}}),define("module/navigation/handler",["module/bootstrap","module/featureDetector","module/navigation/mediator"],function(e,t,n){function i(){r.on("global:resize",a),r.on("global:group:changed",u),r.on("nav:strategy:changed",f),r.on("nav:strategy:unchanged",l),r.on("nav:narrow:loaded",c),r.on("nav:footerButton:clicked",h),r.on("nav:arrow:clicked",p),r.on("nav:more:clicked",d),r.on("nav:sections:clicked",v),r.on("nav:narrow:secondary:arrow:clicked",m),r.on("findLocal:overlayVisible",g),r.on("nav:wide:panel:lostFocus",y),r.on("nav:overflowEmpty",b),r.on("nav:selectedIsVisible",w),r.on("nav:selectedIsHidden",E),r.on("nav:overflow:toggle",x)}function s(e){return e>2}function o(e){return s(e)===!1}function u(e){o(e)?n.enableNarrowStrategy():n.enableWideStrategy()}function a(e){s(e)&&n.refreshWideStrategy()}function f(e){e==="narrow"?n.enableNarrowStrategy():e==="wide"&&n.enableWideStrategy()}function l(e){e==="wide"&&n.refreshWideStrategy()}function c(){n.insertFindLocalIntoNarrowNav()}function h(e){n.toggleNarrowFooterNav(e)}function p(e){n.toggleNarrowNavItem(e)}function d(e){n.toggleWideOverflow(e)}function v(e){n.toggleNarrowNav()}function m(e){n.toggleNarrowSecondaryNav()}function g(){n.hideNarrowNav()}function y(){n.closePanels()}function b(e){n.closePanel(e)}function w(){n.hideIndexTitle()}function E(){n.showIndexTitle()}function S(e){i()}function x(e){e==="visible"?n.showMediaPlaceholder():n.hideMediaPlaceholder()}var r=e.pubsub;return{init:S}}),define("module/navigation/initialiser",["module/bootstrap","module/featureDetector","module/navigation/handler","module/findLocalNews","module/indexTitle"],function(e,t,n,r,i){function s(){t.is("TouchDevice")||e.$("body").addClass("no-touch")}function o(){e.config.service||(e.config={service:"news"})}function u(){s(),o(),i.init(),n.init(),r.init()}return{init:u}}),define("module/urlShrinker",["module/bootstrap"],function(e){var t=e.$;return{find:function(e){return this.links=t(e),this},bindEvents:function(){this.links.on("click",this.shorten),e.pubsub.emit("urlShrinker:eventsBinded")},shorten:function(){var e=this.getAttribute("data-target-url"),n=this.getAttribute("data-social-url"),r="http://www.bbc.co.uk/modules/sharetools/v1/shrink.json?url=";t.ajax({async:!1,url:r+encodeURIComponent(e),success:t.proxy(function(e,t,r){this.href=n+e.url},this)})}}}),define("module/deviceInspector",["module/bootstrap","module/featureDetector"],function(e,t){function d(){o.$(i).on("resize",m)}function v(){var e=s.documentElement.clientWidth,t=s.documentElement.clientHeight;return e>t?e:t}function m(e){var t=b(),i=w();t!==n&&E(t),i!==r&&S(i)}function g(){return s.documentElement.clientWidth}function y(){return t.is("TouchDevice")}function b(){var e=g(),t="group1";return e>=a&&e<f?t="group2":e>=f&&e<l?t="group3":e>=l&&(t="group4"),t}function w(){var e=v(),t=g(),n;if(t<c||t>=c&&e<p)n="smart";return t>=c&&e>=p&&(n="tablet"),g()>=h&&!y()&&(n="wide"),n}function E(e){n=e,o.pubsub.emit("deviceGroup",[n])}function S(e){r=e,o.pubsub.emit("deviceType",[r])}function x(){return n}function T(){return r}function N(t,u){return i=t||window,o=u||e,n="group1",r="smart",s=i.document,E(b()),S(w()),d(),{getType:T,getGroup:x}}var n,r,i,s,o,u=0,a=400,f=600,l=1008,c=600,h=1008,p=720;return{init:N}}),define("deviceInspector",["module/deviceInspector"],function(e){return e.init()}),define("module/localisation/scriptToggle",["module/bootstrap","deviceInspector"],function(e,t){var n=e.$,r={zhongwen:["simp","trad"],ukchina:["simp","trad"]},i=365,s={zhongwen:"ckps_chinese",ukchina:"ckps_chinese"},o={init:function(e){var t=r.hasOwnProperty(e),n=document.querySelector(".script-toggle");if(!t||!n)return!1;this.bindEvents(e)},bindEvents:function(e){var t=this;n(".script-toggle").on("click",function(r){var i=t.getVariant(e,n(this));t.setCookie(e,i)})},getVariant:function(e,t){var i=t.attr("data-variant"),s=r[e];return!i||n.inArray(i,s)===-1?null:i},setCookie:function(t,n){if(!s.hasOwnProperty(t)||!n)return!1;var r=window.location.hostname.match(/com/)?".bbc.com":".bbc.co.uk";document.cookie=s[t]+"="+n+"; expires="+(new Date((new Date).getTime()+864e5*i)).toGMTString()+"; path=/; domain="+r,e.pubsub.emit("scriptToggle:cookieSaved",[{name:s[t],value:n}])}};return o}),define("module/components/handler",["module/bootstrap"],function(e){return{handleSuccess:function(t,n){var r=e.$(t.selector);if(r){var i=document.createElement("div");i.innerHTML=n,r.replaceWith(i.childNodes)}},enable:function(t){var n=e.$(t.selector);n&&n.removeClass("hidden")},disable:function(t){var n=e.$(t.selector);n&&n.addClass("hidden")}}}),define("module/components/loader",["module/bootstrap","module/components/handler","deviceInspector","config"],function(e,t,n,r){var i={components:{},batchStore:[],device:"",register:function(e){this.components[e.id]=e},registerComponentsFromDom:function(){var t=e.$("[data-comp-meta]");for(var n=t.length-1;n>=0;n--){var r=e.$(t[n]).data("comp-meta");r&&(r.selector="#"+t[n].id,this.register(r))}},init:function(t){t=t||{},this.registerComponentsFromDom(),n=t.deviceInspector||n,this.device=n.getGroup(),this.processComponents(),e.pubsub.on("deviceGroup",function(e){i.device=e,i.processComponents()})},processComponents:function(){for(var t in this.components){var n=this.components[t],r=this.shouldShow(n.deviceGroups);!n.loaded&&r?i.load(n):n.loaded&&!r?this.callHandler(n,"disable"):n.loaded&&r&&this.callHandler(n,"enable")}this.requestComponents(this.batchStore),e.pubsub.emit("loader:process:done")},load:function(e){switch(e.opts.loading_strategy){case"post_load":this.requestComponents([e]);break;case"batch_load":this.batchStore.push(e);break;default:this.callHandler(e,"handleSuccess")}e.loaded=!0},shouldShow:function(e){return e?e.indexOf(i.device)!==-1:!0},requestComponents:function(t){var n=t.length,i={batch:{}};if(!n)return;while(n--){var s=t[n],o=s.type||s.name;s.opts.loading_strategy="include_content",i.batch[o]={opts:s.opts,id:s.id},s.template&&(i.batch[o].template=s.template)}var u=e.$.param(i),a=r.pathPrefix+(r.languageVariant?"/"+r.languageVariant:"")+"/components?"+u,f=this;e.$.ajax({url:a,dataType:"json",success:e.$.proxy(this.processResponse,this)})},processResponse:function(e){var t;for(var n in e){t=i.components[n];var r=e[n];i.callHandler(t,"handleSuccess",r)}i.batchStore=[]},callHandler:function(e,n,r){var s=e.handler;s==="default"?(t[n].call(t,e,r),i.emitEvent(e,n)):require(["module/components/"+s],function(s){s[n]?s[n].call(s,e,r):t[n].call(t,e,r),i.emitEvent(e,n)})},emitEvent:function(t,n){var r=n==="handleSuccess"?"loaded":n;e.pubsub.emit("component:"+r,[t.name,t])}};return i}),define("module/commentCounts",["module/bootstrap","config"],function(e,t){var n=e.$;return{init:function(){var e=[];n(".js-comment-count").each(function(){e.push(n(this).attr("data-comments-id"))}),e.length>0&&n.getScript(t.commentsHost+"/modules/comments/getcount/?items="+e.toString())}}}),define("vendor/rum-event-client/source/lib/json",["require"],function(e){var t={};return function(){function e(e){return e<10?"0"+e:e}function o(e){return n.lastIndex=0,n.test(e)?'"'+e.replace(n,function(e){var t=s[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function u(e,t){var n,s,a,f,l=r,c,h=t[e];h&&typeof h=="object"&&typeof h.toJSON=="function"&&(h=h.toJSON(e));switch(typeof h){case"string":return o(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";r+=i,c=[];if(Object.prototype.toString.apply(h)==="[object Array]"){f=h.length;for(n=0;n<f;n+=1)c[n]=u(n,h)||"null";return a=c.length===0?"[]":r?"[\n"+r+c.join(",\n"+r)+"\n"+l+"]":"["+c.join(",")+"]",r=l,a}for(s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a=u(s,h),a&&c.push(o(s)+(r?": ":":")+a));return a=c.length===0?"{}":r?"{\n"+r+c.join(",\n"+r)+"\n"+l+"}":"{"+c.join(",")+"}",r=l,a}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r,i,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};typeof t.stringify!="function"&&(t.stringify=function(e){return u("",{"":e})})}(),t}),define("vendor/rum-event-client/source/analytics_client",["require","./lib/json"],function(e){function t(n){this.events=[],this.labels={},this.dataLabels={},this._getCookie=n.custom_cookie_getter||this._getCookie,this._setCookie=n.custom_cookie_setter||this._setCookie,this.p=n.product||"_",this.e=n.edition||null,this.id2=this._getCookie(t.USER_COOKIE_NAME),this.posting=this._setDelivery(n.delivery_method,n.server,n.url_params,n.custom_delivery),this.limit_url=!this.posting,this.JSON=window.JSON||e("./lib/json")}return t.USER_COOKIE_NAME="s1",t.MAX_URL_LENGTH=2e3,t.SESSION_COOKIE_NAME="ckpf_rum_session",t.SESSION_COOKIE_TIMEOUT=18e5,t.RT_THRESHOLD=6e4,t.AJAX_POST=1,t.AJAX_GET=2,t.DOM_GET=3,t.CUSTOM_POST=4,t.CUSTOM_GET=5,t.LABELS={COUNT_CONTENT_ID:"ccid",COUNT_LIST_ID:"clid"},t.VERSION="0.4.4",t.prototype._setDelivery=function(e,n,r,i){var s,o,u;switch(e){case t.AJAX_POST:s=!0,o=!0,u=!1;break;case t.AJAX_GET:s=!1,o=!0,u=!1;break;case t.DOM_GET:s=!1,o=!1,u=!1;break;case t.CUSTOM_POST:s=!0,o=!1,u=!0;break;case t.CUSTOM_GET:s=!1,o=!1,u=!0;break;default:s=!0,o=!0,u=!1}return s&&typeof navigator=="object"&&navigator.platform&&(navigator.platform.indexOf("iPhone")!=-1||navigator.platform.indexOf("iPod")!=-1||navigator.platform.indexOf("iPad")!=-1)&&(s=!1),u?this._makeRequest=t._useCustomRequest(i,t._makeURL(s,n,r),s):o&&typeof XMLHttpRequest!="undefined"&&typeof (new XMLHttpRequest).withCredentials!="undefined"?this._makeRequest=t._useXMLHttpRequest(t._makeURL(s,n,r),s):(s=!1,this._makeRequest=t._useImageRequest(t._makeURL(!1,n,r))),s},t._makeURL=function(e,n,r){var i=e?"":"/legacy",s=n+i;return r?t._addParams(s,r):s},t._addParams=function(e,t){e.indexOf("?")===-1?e+="?":e.indexOf("?")!==e.length-1&&(e+="&");for(var n in t)e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n])+"&";return e.replace(/(\?|&)$/,"")},t.prototype._addEvent=function(e,n,r){var i,s,o={},u={};for(i in this.dataLabels)o[i]=this.dataLabels[i];for(i in n)o[i]=n[i];for(i in this.labels)u[i]=this.labels[i];for(i in r)i===t.LABELS.COUNT_CONTENT_ID||i===t.LABELS.COUNT_LIST_ID?o[i]=r[i]:u[i]=r[i];s={cv:t.VERSION,p:this.p,id:e,id2:this.id2,sid:this._updateSessionID(),ts:(new Date).getTime(),l:u,data:o},this.e!==null&&(s.e=this.e),this.events.push(s)},t.prototype._getCookie=function(e){if(typeof document=="undefined"||typeof document.cookie!="string")return null;var t,n=document.cookie;if(n.indexOf(e+"=")===0)t=e.length+1;else{t=n.indexOf(" "+e+"=");if(t==-1)return null;t+=e.length+2}var r=n.indexOf(";",t);return r==-1&&(r=n.length),n.substring(t,r)},t.prototype._setCookie=function(e,t,n,r){if(!document||typeof document.cookie!="string")return;var i=new Date;i.setTime(i.getTime()+r);var s=i.toUTCString(),o=e+"="+t+";"+" expires="+s+";"+" path="+n+";";document.cookie=o},t.prototype._addEventAndSend=function(e,t,n,r){this._addEvent(e,t,n),this._sendEvents(r)},t._createPLData=function(){return{url:window.location.pathname,referrer:document.referrer}},t._createPTData=function(){if(typeof window.performance!="object")return null;var e={url:window.location.pathname};for(var t in window.performance.timing)typeof window.performance.timing[t]!="function"&&(e[t]=window.performance.timing[t]);e.navigationStart=e.navigationStart||e.redirectStart||e.fetchStart;var n=e.loadEventEnd,r=e.navigationStart,i=e.requestStart,s=e.responseEnd;return n&&r&&i&&s&&(e.plt=n-r,e.pre=i-r,e.req=s-i,e.pro=n-s),e},t._createRTData=function(e,n){if(window.performance&&window.performance.getEntriesByType){var r=t._cleanRTData(window.performance.getEntriesByType("resource"));return{url:window.location.pathname,plt:e,"long":n,res:r}}return null},t._cleanRTData=function(e){var t=[];for(var n=0,r=e.length;n<r;n++){t[n]={};for(var i in e[n])e[n][i]!==0&&(i==="name"?t[n][i]=e[n][i].replace(/\?.*$/,""):t[n][i]=e[n][i])}return t},t.prototype._sendEvents=function(e,n){var r=n,i,s;r||(r=this.events,this.events=[]),i=this.JSON.stringify({events:r});if(this.limit_url&&r.length>1&&i.length>t.MAX_URL_LENGTH)for(s=0;s<r.length;s++)this._sendEvents(e,[r[s]]);else this._makeRequest(e,i,{"Content-type":"application/json"})},t._useXMLHttpRequest=function(e,n){return function(r,i,s){var o,u=e;n||(u=t._addParams(u,{data:i})),o=new XMLHttpRequest,o.open(n?"POST":"GET",u,!0);for(var a in s)o.setRequestHeader(a,s[a]);o.onreadystatechange=function(){o.readyState==4&&r&&r(o.status)};try{o.send(i)}catch(f){}}},t._useImageRequest=function(e){function i(e,t){n.push(function(){var n=new Image;n.onload=function(){s(),typeof e=="function"&&e()},n.onerror=function(){s()},n.onabort=function(){s()},n.src=t}),o()}function s(){r=!1,o()}function o(){if(r||n.length<1)return;r=!0;var e=n.shift();e()}var n=[],r=!1;return function(n,r){var s=t._addParams(e,{data:r});i(n,s)}},t._useCustomRequest=function(e,n,r){return r?function(t,r,i){e(t,null,"POST",n,i,r)}:function(r,i,s){e(r,null,"GET",t._addParams(n,{data:i}),s)}},t.prototype.load=function(e,n){var r=this;r._addEvent("PL",t._createPLData(),e),setTimeout(function(){var i=t._createPTData(),s,o,u;if(i){r._addEvent("PT",i,e);if(n!==!1){o=i.plt,u=i.plt>t.RT_THRESHOLD;if(n||u)s=t._createRTData(i.plt,u),s&&(r.rtSent=!0,r._addEvent("RT",s,e))}}r._sendEvents()},0)},t.prototype.sendError=function(e,t,n,r){this._addEventAndSend("ERR",{m:e,file:t,line:n},r)},t.prototype.sendExit=function(e,t,n){this._addEventAndSend("EXIT",{s:e,d:t},n)},t.prototype.addLabels=function(e,t){for(var n in e)this.addLabel(n,e[n],t)},t.prototype.addLabel=function(e,t,n){this[n?"dataLabels":"labels"][e]=t},t.prototype.removeLabels=function(e){for(var t=0;t<e.length;t++)delete this.labels[e[t]]},t.prototype._generateSessionID=function(){return""+(new Date).getTime()+"-"+this.id2},t.prototype._updateSessionID=function(){var e=this._getCookie(t.SESSION_COOKIE_NAME)||this._generateSessionID();return this._setCookie(t.SESSION_COOKIE_NAME,e,"/",t.SESSION_COOKIE_TIMEOUT),e},{AC:t}}),define("module/rum",["vendor/rum-event-client/source/analytics_client","config","module/bootstrap"],function(e,t,n){return{init:function(){t.features2.rum&&(this.ac=new e.AC({server:t.rumAnalytics.server,edition:t.rumAnalytics.edition,product:t.rumAnalytics.key+"_"+t.environment,url_params:t.rumAnalytics.url_params}),this.bindOnError(),this.deferTimings())},bindOnError:function(){var e=this,t=window.onerror;window.onerror=function(r,i,s){t&&t.apply(window,arguments),e.ac.sendError(r,i,s,n.$.eventHistory)}},deferTimings:function(){var r={},i=t.asset?t.asset.asset_id:null,s=this;r[e.AC.LABELS.COUNT_CONTENT_ID]=i;try{window.loaded?this.ac.load(r):n.$(window).on("load",function(){s.ac.load(r)})}catch(o){}}}}),define("module/tableScroll",["module/bootstrap"],function(e){function n(){var e=document.getElementsByClassName("responsive-table-container"),t=e.length,n=0;while(n<t)e[n].addEventListener("touchstart",r,!1),e[n].addEventListener("touchmove",i,!1),n++}function r(e){t=e.currentTarget.scrollLeft+e.touches[0].pageX}function i(e){var n=e.currentTarget;(s(n,e)||o(n,e))&&e.preventDefault(),n.scrollLeft=t-e.touches[0].pageX}function s(e,n){return e.scrollLeft<e.scrollWidth-e.offsetWidth&&e.scrollLeft+n.touches[0].pageX<t-5}function o(e,n){return e.scrollLeft!==0&&e.scrollLeft+n.touches[0].pageX>t+5}function u(){return navigator.userAgent.match(/Android 2/i)?!0:!1}var t=0;return{init:function(){u()&&n()}}}),define("module/hotspot/reflow",["module/bootstrap"],function(e){function r(){var e,r,i;if(e=n[0].firstElementChild)i=n[0],r=n[1];else if(e=n[1].firstElementChild)i=n[1],r=n[0];t(e).detach().appendTo(r),t(i).addClass("hotspot--empty"),t(r).removeClass("hotspot--empty")}function i(){n.removeClass("hotspot--hidden")}function s(e){n=e}var t=e.$,n;return{init:s,execute:r,unmask:i}}),define("module/hotspot/handler",["module/bootstrap","module/hotspot/reflow"],function(e,t){function s(){n.on("global:group:changed",o)}function o(e){if(r===e)return;r===null&&e===4?t.execute():i[e][r]!==undefined&&t.execute(),r==null&&t.unmask(),r=e}function u(e){t.init(e),s()}var n=e.pubsub,r=null,i={1:{4:1},2:{4:1},3:{4:1},4:{1:1,2:1,3:1}};return{init:u}}),define("module/hotspot/initialiser",["module/bootstrap","module/hotspot/handler"],function(e,t){function r(){var e=n(".hotspot");if(e.length!==2)return;t.init(e)}var n=e.$;return{init:r}}),function(){function h(){}function p(e){return typeof e=="function"&&l.test(e)}function d(e){return typeof e=="function"}function v(e){return!!e&&!!n[typeof e]}function m(t,n,r){var i,s,o,u,a,f,l,h=0,p=!1,m=!0;if(!d(t))throw new TypeError;n=c(0,n)||0;if(r===!0){var y=!0;m=!1}else v(r)&&(y=r.leading,p="maxWait"in r&&(c(n,r.maxWait)||0),m="trailing"in r?r.trailing:m);var b=function(){var r=n-(g()-u);if(r<=0){s&&clearTimeout(s);var c=l;s=f=l=e,c&&(h=g(),o=t.apply(a,i),!f&&!s&&(i=a=null))}else f=setTimeout(b,r)},w=function(){f&&clearTimeout(f),s=f=l=e;if(m||p!==n)h=g(),o=t.apply(a,i),!f&&!s&&(i=a=null)};return function(){i=arguments,u=g(),a=this,l=m&&(f||!y);if(p===!1)var e=y&&!f;else{!s&&!y&&(h=u);var r=p-(u-h),c=r<=0;c?(s&&(s=clearTimeout(s)),h=u,o=t.apply(a,i)):s||(s=setTimeout(w,r))}return c&&f?f=clearTimeout(f):!f&&n!==p&&(f=setTimeout(b,n)),e&&(c=!0,o=t.apply(a,i)),c&&!f&&!s&&(i=a=null),o}}var e,t="[object Function]",n={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},r=n[typeof window]&&window||this,i=n[typeof exports]&&exports&&!exports.nodeType&&exports,s=n[typeof module]&&module&&!module.nodeType&&module,o=s&&s.exports===i&&i,u=n[typeof global]&&global;u&&(u.global===u||u.window===u)&&(r=u);var a=Object.prototype,f=a.toString,l=RegExp("^"+String(f).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),c=Math.max;d(/x/)&&(d=function(e){return typeof e=="function"&&f.call(e)==t});var g=p(g=Date.now)&&g||function(){return(new Date).getTime()};h.debounce=m,h.isFunction=d,h.isObject=v,h.now=g,h.VERSION="2.4.1",typeof define=="function"&&typeof define.amd=="object"&&define.amd?(r._=h,define("vendor/lo-dash/lo-dash",[],function(){return h})):i&&s?o?(s.exports=h)._=h:i._=h:r._=h}.call(this),define("module/strategiser",["module/bootstrap","vendor/lo-dash/lo-dash"],function(e,t){function i(){return e.window.innerWidth}function s(){var e;for(var t=1;t<=4;t++)i()>=r[t]&&(e=t);return n=e,e}function o(){n===s()?e.pubsub.emit("global:resize",n):e.pubsub.emit("global:group:changed",n)}function a(){e.$(e.window).on("resize",u)}function f(){o(),a()}var n,r={1:0,2:400,3:600,4:1008},u=t.debounce(function(){o()},100);return{init:f,determineStrategy:s}}),define("module/base",["module/bootstrap","vendor/analytics/siteCatalyst","module/stats/statsSubscriber","module/stats/statsConfig","module/nav/navManager","module/navigation/initialiser","module/urlShrinker","module/localisation/scriptToggle","deviceInspector","module/components/loader","module/commentCounts","config","module/rum","module/tableScroll","module/hotspot/initialiser","module/strategiser"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){e.$.ajaxSetup({cache:!0});var m=function(){function n(t){var n=/device--(?:feature|smart|tablet|wide)/,r=document.body.className.split(" "),i=r.length,s=-1;/^group\d$/.test(t)&&(n=/device--group/);while(++s<i)n.test(r[s])&&e.$("body").removeClass(r[s])}function r(r){t!==r&&(t=r,n(r),e.$("body").addClass("device--"+r))}var t;return e.pubsub.on("deviceGroup",function(e){r(e)}),e.pubsub.on("deviceType",function(e){r(e)}),{setBodyClass:r}}();return{init:function(g){h.init(),f.init(),p.init(),l.init(),c.features2&&c.features2.nav?s.init():i.init(),o.find(".shortenUrl").bindEvents(),c.isWorldService&&(u.init(c.service),new t),new n(r),m.setBodyClass(a.getGroup()),m.setBodyClass(a.getType()),d.init(),!/beta-no-touch/.exec(window.location.search)||e.$("body").addClass("beta-no-touch"),v.init()}}}),define("module/blog/blogButton",["module/bootstrap"],function(e){var t=function(t){return this.element=e.$('<button class="blog__show-more"><span class="cta">'+t+'</span><span class="spin"></span></button>'),this.bindEvents(),this.listen(),this.element};return t.prototype={bindEvents:function(){this.element.on("click",function(t){t.preventDefault(),e.pubsub.emit("stories:more:request")})},listen:function(){e.pubsub.on("stories:more:loading",e.$.proxy(this.handleLoading,this)),e.pubsub.on("stories:more:success",e.$.proxy(this.handleSuccess,this)),e.pubsub.on("stories:more:error",e.$.proxy(this.handleError,this)),e.pubsub.on("stories:fullyloaded",e.$.proxy(this.handleFullyLoaded,this))},handleLoading:function(e){this.element.attr("disabled","disabled")},handleSuccess:function(e){this.element.removeAttr("disabled")},handleError:function(e){this.element.remove()},handleFullyLoaded:function(e){this.element.remove()}},{create:function(e){return new t(e)}}}),define("module/components/adverts",["module/bootstrap","vendor/lo-dash/lo-dash"],function(e,t){var n=t.debounce(function(){bbcdotcom.adverts.layout.reset()},150);return{handleSuccess:function(t){typeof bbcdotcom!="undefined"&&typeof bbcdotcom.objects!="undefined"&&bbcdotcom.objects("bbcdotcom.adverts.slot")&&e.$(window).on("resize",n)}}}),define("module/imageenhancer",["module/bootstrap"],function(e){var t=function(t){typeof t=="string"&&e.$(t).each(function(t,n){e.$(n).addClass("js-image-replace")}),this.widths=[96,130,165,200,235,270,304,340,375,410,445,485,520,555,590,625,660,695,736],this.isResizing=!1,this.imageReplaceNodelist=null,this.upscale=e.config.hasOwnProperty("imageUpscale")?e.config.imageUpscale:!0;var n=this;this.changeDivsToImgs(),e.pubsub.on("imageEnhancer:resize",function(){n.resizeImages(n.imageReplaceNodelist)}),e.pubsub.on("component:loaded",function(){n.changeDivsToImgs(),n.initResizeImages()}),setTimeout(function(){n.initResizeImages()},250)};return t.prototype={changeDivsToImgs:function(){e.$("div.js-delayed-image-load").each(function(t,n){n=typeof n!="number"?n:t;var r=n.getAttribute("data-width"),i=n.getAttribute("data-height"),s="";r>0&&i>0&&(s=' width="'+n.getAttribute("data-width")+'" height="'+n.getAttribute("data-height")+'"'),e.$(n).replaceWith('<img src="data:image/gif;base64,R0lGODlhEAAJAIAAAP///wAAACH5BAEAAAAALAAAAAAQAAkAAAIKhI+py+0Po5yUFQA7" datasrc="'+n.getAttribute("data-src")+'" class="js-image-replace" alt=""'+s+" />")})},initResizeImages:function(){this.imageReplaceNodelist=e.$(".js-image-replace"),this.resizeImages(this.imageReplaceNodelist),window.addEventListener?window.addEventListener("resize",function(){e.pubsub.emit("imageEnhancer:resize")},!1):window.attachEvent("resize",function(){e.pubsub.emit("imageEnhancer:resize")})},resizeImages:function(e){if(!this.isResizing){this.isResizing=!0;if(e!==null)for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r.getAttribute("class").match("no-replace"))continue;this.upscale===!1&&!r.style.maxWidth&&r.hasAttribute("width")&&(r.style.maxWidth=r.getAttribute("width")+"px");var i=this.calcImgSrc(r.getAttribute("datasrc")||r.src,r.clientWidth);!!i&&i!==r.src&&r.setAttribute("src",i)}this.isResizing=!1}},calcImgSrc:function(e,t){if(e==null)return!1;var n=e.match(/\/news\/(?:highquality\/)?(?:ws\/)?(\d*)/)||e;if(n===null||typeof n=="string")return!1;var r=e.indexOf(n[1]),i=n[1].length;return e.substr(0,r)+this.matchBestWidth(t)+e.substr(r+i)},matchBestWidth:function(e){var t=this.widths[0];for(var n=0,r=this.widths.length;n<r;n++){if(e<this.widths[n])return t;t=this.widths[n]}return t}},t}),define("module/media/empFacade",["module/bootstrap","module/featureDetector","module/navigation/mediaPlaceholder","config"],function(e,t,n,r){var i=e.$,s=function(s){var o=function(e,t){this.config=i.extend(!0,r,t),this.options=e||{},this.embed()};return o.prototype={analytics:null,getAsset:function(){var e=this.config||{},t=this.config.asset||{};return t},getPageType:function(){var e=this.getAsset(),t=e.type||null,n={MAP:"eav1",STY:"eav2",IDX:"eav3"};return n[t]?n[t]:"eav3"},getEdition:function(){var e=this.getAsset();return e.edition||"Domestic"},getAssetId:function(){var e=this.getAsset(),t=e.asset_id||null;return t?parseInt(t,10):0},getCounterName:function(){var e=this.getAsset();return e.iStats_counter_name},navigationMediaPlaceholderRequired:function(e){return e.name()==="smp-flash"&&!t.is("Holepunched")},handleRequest:function(e,r,i,s,o,u){e.decide()!=="aaamp"&&(this.analytics=o,this.navigationMediaPlaceholderRequired(e)&&n.activate(),this.addEventListeners(e),s!==undefined&&s.addSmpPlugin(this.options.id,e),u!==undefined&&u.addSmpPlugin(e,t.is("Holepunched")),i&&o!==undefined&&o.addEventListeners(e),e.width(this.options.width),e.height(this.options.height),this.options.poster&&e.poster(this.options.poster),e.load(this.options.playlist))},addEventListeners:function(t){function n(e){return{opts:{mediaType:e.kind()},name:e.name()}}t.bind("initialised",function(r){e.pubsub.emit("video:load",[n(t)])}),t.bind("fullscreenchange",function(t){e.pubsub.emit("nav:all:close")}),t.bind("playing",function(r){e.pubsub.emit("video:play",[n(t)])}),t.bind("pause",function(r){e.pubsub.emit("video:pause",[n(t)])}),t.bind("ended",function(r){e.pubsub.emit("video:end",[n(t)])})},getUI:function(){return{colour:this.config.smpBrand}},getSettings:function(){return{product:"news",playerProfile:"smp",responsive:!0,superResponsive:!0,siteID:"News",pageType:this.getPageType(),edition:this.getEdition(),uniqueID:this.getAssetId(),counterName:this.getCounterName(),appName:"news",appType:"web",disable3GWarning:!0}},configureContinuousPlay:function(e){e.autoplay=!1,require(["bump-3","bbcdotcom/av/continuous_play/continuousPlay","bbcdotcom/av/emp/adverts","bbcdotcom/av/emp/analytics"],i.proxy(function(n,r,i,s){var o=n("#"+this.options.id).player(e);this.handleRequest(o,t.is("ShowingDesktopAds"),!0,i,s,r)},this))},configurePlayerWithGnlAnalytics:function(e){require(["bump-3","bbcdotcom/av/emp/adverts","bbcdotcom/av/emp/analytics"],i.proxy(function(n,r,i){var s=n("#"+this.options.id).player(e);this.handleRequest(s,t.is("ShowingDesktopAds"),!0,r,i)},this))},configurePlayer:function(e){require(["bump-3"],i.proxy(function(t){var n=t("#"+this.options.id).player(e);this.handleRequest(n,!1,!1)},this))},embed:function(){if(s)this.handleRequest(s,!1,!1);else{var e=this.getSettings();this.config.smpBrand&&(e.ui=this.getUI()),this.getPageType()==="eav1"&&t.is("CollectingGNLAnalytics")&&t.is("ShowingDesktopAds")&&(e.autoplay=!0),t.is("CollectingGNLAnalytics")?(e.waitOnPluginLoad=!0,t.is("ContinuousPlayEnabled")&&t.is("Holepunched")?this.configureContinuousPlay(e):this.configurePlayerWithGnlAnalytics(e)):this.configurePlayer(e)}}},o};return{init:s}}),define("module/media/piratePlayerView",["module/bootstrap","translator","config"],function(e,t,n){var r=/Android/i.test(navigator.userAgent),i=!/2\.\d/i.test(navigator.userAgent),s=function(t){this.opts=t||{},this.player=this.createPlayer(),this.playButton=this.createPlayButton(),this.interval=null,this.container=e.$("#"+t.id),this.downloadLinks=e.$(".map-download-urls")};return s.prototype={createPlayer:function(){var t=this.opts.href?' src="'+this.opts.href+'"':"",n=e.$("<video"+t+' preload="none" controls="controls"></video>');return n},createPlayButton:function(){var n=e.$('<button class="video-cta">'+t.get("play")+"</button>");return n},createPoster:function(t){var n=e.$('<img class="poster" src="'+t+'" />');return n},showDownloadLinks:function(e,t){t=t||!1,this.downloadLinks.addClass("showUrls"),e==="video"&&!t?this.showMessage("downloadVideo"):e==="audio"&&!t&&this.showMessage("downloadAudio")},createMessage:function(e){var t=document.createElement("p");return t.className="media-message",t.innerHTML=e,t},renderMessage:function(e){this.poster=this.createPoster(this.opts.poster),this.message=this.createMessage(e),this.clearMessages(),this.container.append(this.poster),this.container.append(this.message)},clearMessages:function(){e.$(".media-message",this.container).remove()},showMessage:function(e){switch(e){case"audio":this.renderMessage(t.get("errorAudio"));break;case"live":this.renderMessage(t.get("errorLive"));break;case"content":this.renderMessage(t.get("errorContent"));break;case"downloadVideo":this.renderMessage(t.get("downloadMessageVideo"));break;case"downloadAudio":this.renderMessage(t.get("downloadMessageAudio"));break;default:this.renderMessage(t.get("errorDefault"))}},embed:function(){this.poster=this.createPoster(this.opts.poster),this.container.append(this.player),this.container.append(this.poster),this.container.append(this.playButton),e.pubsub.emit("video:load",[this]),this.bindEvents()},play:function(){this.player[0].play()},bindEvents:function(){this.poster.on("click",e.$.proxy(function(){this.play()},this)),this.playButton.on("click",e.$.proxy(function(){this.play()},this)),this.player.on("play",e.$.proxy(function(){e.pubsub.emit("video:play",[this]),this.videoToForeground()},this)),this.player.on("ended",e.$.proxy(function(){e.pubsub.emit("video:end",[this])},this)),this.player.on("pause",e.$.proxy(function(){e.pubsub.emit("video:pause",[this])},this))},videoToForeground:function(){this.container.addClass("video-foreground")}},s}),define("module/media/piratePlayer",["module/bootstrap","module/media/piratePlayerView","module/featureDetector","config"],function(e,t,n,r){var i=function(t){this.options=t||{},this.mediaType=this.options.mediaType;var n;this.isPlayable()&&(this.hrefAlreadyExists()?(n=this.createMediaView(),n.embed()):this.getMediaSelector(e.$.proxy(function(e){n=this.createMediaView(e),n.embed()},this),e.$.proxy(function(e){n=this.createMediaView(e),n.showMessage("content")},this)))};return i.prototype={hrefAlreadyExists:function(){return!!this.options.href},errorOnRender:function(){return this.options.errorOnRender},isAudio:function(){return this.mediaType==="audio"},isLiveWithoutSupport:function(){return this.options.live?n.can("PlayHls")||n.can("PlayAppleHls")||n.can("PlayAppleHlsWs")?!1:!0:!1},isPlayable:function(){var e,t=!1;return this.isAudio()?(e=this.createMediaView(),e.showMessage("audio"),t=!0):this.isLiveWithoutSupport()?(e=this.createMediaView(),this.hasDownloadLinks()||e.showMessage("live"),t=!0):this.errorOnRender()&&(e=this.createMediaView(),e.showMessage(),t=!0),t?(this.hasDownloadLinks()&&e.showDownloadLinks(this.mediaType,this.options.live),!1):!0},hasDownloadLinks:function(){return!!document.querySelector(".map-download-urls")},createMediaView:function(e){return e=e||{},e.href&&(this.options.href=e.href),new t(this.options)},getMediaSelector:function(t,n){var r=this.getMediaSelectorUrl(),i=this,s=this.options.externalId;e.$.ajax({url:r+s,dataType:"jsonp",type:"get",cache:!0,jsonp:!1,jsonpCallback:s,success:function(e){var r=i.proccessMediaSelector(e);r?t(r):n(r)},error:function(e){n()}})},getMediaSelectorUrl:function(){return["http://open.live.bbc.co.uk","/mediaselector/5/select/version/2.0","/format/json","/vpid/",this.options.externalId,"/mediaset/journalism-http-mobile","/jsfunc/"].join("")},getConnectionHref:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.href)return n.href}},proccessMediaSelector:function(e){if(!e)return;if(!e.media)return;var t={};for(var n=e.media.length-1;n>=0;n--){var r=e.media[n].bitrate;t[r]={},t[r].href=this.getConnectionHref(e.media[n].connection)}return t[512]?t[512]:t[496]||t[176]}},i}),define("module/media/template",["module/featureDetector","translator"],function(e,t){var n=function(){var n=t.get("offScreenMediaCaption"),r="figure",i,s="figcaption",o;e.is("Holepunched")&&(r="div",i="HTML5figure",s="div",o="HTML5figcaption");var u=["<"+r+' class="media-item {{classes}} '+i+'">','<div class="media-container media-wrapper" id="media-{{id}}"></div>',"<"+s+' class="media-caption '+o+'"><span class="off-screen">'+n+'</span> <span class="media-caption__text">{{caption}}</span></'+s+">","</"+r+">"].join("");return function(){return u}}();return function(e){var t=n();for(var r in e)t=t.replace(new RegExp("{{"+r+"}}","g"),e[r]);return t}}),define("module/page",["vendor/istats/istats"],function(e){return{getCountername:function(){return e.getCountername()},setCountername:function(t){e.setCountername(t)}}}),define("module/media/mediaLoader",["module/bootstrap","module/media/empFacade","module/media/piratePlayer","module/media/template","module/featureDetector","module/page"],function(e,t,n,r,i,s){var o=function(){return i.is("Holepunched")||i.can("PlayBump")||i.can("PlayAppleHls")?t.init():n}(),u=function(t,n,r){this.placeholder=e.$(t),this.meta=n||{},this.options=r||{},this.id=this.getMediaId(),this.hasCaption=!!this.meta.caption&&!!this.meta.caption.length,this.caption=this.hasCaption?this.meta.caption:"",this.posterSrc=this.meta.image&&this.meta.image.href?this.meta.image.href:"",this.render()};return u.prototype={getMediaId:function(){return this.options.mediaId?this.options.mediaId:this.placeholder.attr("id")},getAssetId:function(){return this.options.assetId?this.options.assetId:this.placeholder.attr("data-asset-id")?this.placeholder.attr("data-asset-id"):this.parseAssetIdFromHref()},parseAssetIdFromHref:function(){return this.meta.href&&this.meta.href.replace(/\D+/g,"")},render:function(){this.renderContainer(),this.embedPlayer()},renderContainer:function(){this.placeholder.append(r({classes:this.getClasses(),id:this.id,caption:this.caption})),this.show()},getClasses:function(){var e=o===n?"responsive-player":"default-player",t=this.hasCaption?"has-caption":"no-caption";return[e,t].join(" ")},embedPlayer:function(){new o({id:"media-"+this.id,playlist:this.meta.href,externalId:this.meta.externalId,live:this.meta.live,poster:this.posterSrc,href:this.options.href,width:this.options.width,height:this.options.height,mediaType:this.options.mediaType||"video",errorOnRender:!1},{asset:{iStats_counter_name:s.getCountername(),asset_id:this.getAssetId()}})},show:function(){this.placeholder.addClass("enabled")}},u}),define("module/media/mediaFilter",["module/bootstrap"],function(e){var t=e.$,n=function(e,n,r){return this.options=r||{},typeof e=="object"&&(e=t.map(e,function(e){return e})),this.getAssetWithEncoding(e,n)};return n.prototype={getAssetWithEncoding:function(e,n){var r=n==="video"?"mp4":"mp3",i=t.grep(e,function(e){return e.encoding===r});i.sort(function(e,t){return e.bitrate===t.bitrate?0:e.bitrate<t.bitrate?1:-1});switch(this.options.quality){case"high":return i[0];case"medium":return i[1]||i[0];case"low":return i[2]||i[1]||i[0];default:return i[1]||i[0]}}},n}),define("module/media/mediaHandler",["module/bootstrap","module/media/mediaLoader","module/media/mediaFilter"],function(e,t,n){var r=e.$,i=function(e,n){this.options=e||{},t=n||t};return i.prototype={createMedia:function(){r.each(this.findMediaPlaceholders(),r.proxy(function(r,i){var s=e.$(i).data("media-meta"),o=e.$(i).data("media-type"),u=s.sourceFiles,a={mediaType:o};if(u){var f=new n(u,o);a.href=f.url}if(this.options.audio===!1&&o==="audio")return;s&&new t(i,s,a)},this))},findMediaPlaceholders:function(){return e.$(".media-placeholder").not(".enabled")}},i}),define("module/timestamp",["module/bootstrap","translator"],function(e,t){var n=function(e){this.time=e,this.insertTime()};return n.prototype.insertTime=function(){var t=e.$(".date");for(var n=0,r=t.length;n<r;n++){var i=t.get(n);if(i.getAttribute("data-timestamp-inserted")!==undefined&&e.$(".live",i.parentElement).length===0){var s=i.getAttribute("data-seconds");if(typeof s!==undefined){var o=Math.abs(Math.ceil(this.time/1e3-parseInt(i.getAttribute("data-seconds"),10))),u=this.timeAgoInWords(o);if(u!==null)i.innerHTML=u,i.className+=" relative-time";else if(i.innerHTML===""){var a=document.createElement("p");a.innerHTML=i.getAttribute("data-datetime"),a.className=i.className,i.parentNode.insertBefore(a,i)}i.setAttribute("data-timestamp-inserted",!0)}}}},n.prototype.russianRelativeTime=function(e,t,n,r){var i=e%10;return i===1&&(e===1||e>20)?t:i>1&&i<5&&(e>20||e<10)?n:r},n.prototype.minutesAgo=function(e){switch(t.getLocale()){case"ru":case"ru-UK":return this.russianRelativeTime(e,t.get("singularMinutesAgo"),t.get("genSingularMinutesAgo"),t.get("genPluralMinutesAgo")).replace("{x}",e);default:return e===1?t.get("oneMinuteAgo"):t.get("xMinutesAgo").replace("{x}",e)}},n.prototype.hoursAgo=function(e){switch(t.getLocale()){case"ru":case"ru-UK":return this.russianRelativeTime(e,t.get("singularHoursAgo"),t.get("genSingularHoursAgo"),t.get("genPluralHoursAgo")).replace("{x}",e);default:return e===1?t.get("oneHourAgo"):t.get("xHoursAgo").replace("{x}",e)}},n.prototype.timeAgoInWords=function(e){var n=Math.floor(e/60),r=Math.floor(e/3600);return n<1?t.get("lessThanAMinuteAgo"):r<1?this.minutesAgo(n):r<10?this.hoursAgo(r):null},n}),define("module/components/shareTools",["module/bootstrap"],function(e){var t=e.$;return{handleSuccess:function(e){var n=t(e.selector),r=n.find(".share__button"),i=n.find(".share");r.on("click",t.proxy(this.toggleShareToolsVisibility,this,i))},toggleShareToolsVisibility:function(e,t){e.toggleClass("show"),t.preventDefault()}}}),define("module/components/blog",["module/bootstrap","module/blog/blogButton","module/imageenhancer","module/media/mediaHandler","module/timestamp","module/components/shareTools","translator"],function(e,t,n,r,i,s,o){var u=e.$,a={init:function(n){(function(){var t=["Webkit","Moz"],n=[];for(var r in t)n.push(document.body.style[t[r]+"AnimationName"]);e.$("html").addClass(u.inArray("",n)>-1?"css-anim":"animated-gif")})(),this.mediaHandler=new r,this.enhanceContent(),this.firstName=n.opts&&n.opts.firstName?n.opts.firstName:null,this.container=u(n.selector),this.nextStoriesLink=this.hasNextStories(this.container),this.requesting=!1,this.requestCount=0,this.nextStoriesLink&&(this.bindEvents(),this.container.after(t.create(o.get("moreStories")))),this.bindShareButtons(this.container)},enhanceContent:function(){new n(".blog__story .unit__body img"),new i((new Date((new Date).toUTCString())).getTime()),this.mediaHandler.createMedia()},bindEvents:function(){e.pubsub.on("stories:more:success",u.proxy(function(e){this.handleSuccess(e)},this)),e.pubsub.on("stories:more:error",u.proxy(function(){this.handleError()},this)),e.pubsub.on("stories:more:request",u.proxy(function(){this.handleRequest()},this)),e.pubsub.on("stories:more:loading",u.proxy(function(){this.handleLoading()},this))},hasNextStories:function(e){return e.attr("data-next")},setRequesting:function(e){this.requesting=e},setNextStoriesLink:function(t){this.nextStoriesLink=this.hasNextStories(t),this.nextStoriesLink||e.pubsub.emit("stories:fullyloaded")},handleRequest:function(){this.requesting||this.getMoreStories(this.nextStoriesLink)},handleLoading:function(){this.setRequesting(!0)},handleSuccess:function(e){e=u(e),this.setRequesting(!1),this.setNextStoriesLink(e),this.insertStoriesIntoDom(e.children()),this.enhanceContent()},handleError:function(){this.setRequesting(!1)},insertStoriesIntoDom:function(e){this.container.append(e),this.bindShareButtons(e)},getRequestCount:function(){return this.requestCount},getMoreStories:function(t){if(t){var n=this.firstName?{firstName:this.firstName}:null;this.requestCount++,e.pubsub.emit("stories:more:loading"),u.ajax({url:t,data:n,success:u.proxy(function(t){e.pubsub.emit("stories:more:success",[t,{requestCount:this.getRequestCount()}])},this),error:u.proxy(function(){e.pubsub.emit("stories:more:error")},this)})}},bindShareButtons:function(e){e.find(".js-share-tools").each(function(e,t){s.handleSuccess({selector:"#"+t.id})})}};return{handleSuccess:function(e,t){a.init.apply(a,arguments)},init:function(e,t){var n={selector:e,opts:{firstName:t}};a.init.apply(a,[n])}}}),define("module/components/business_data/index-selector",["module/bootstrap"],function(e){var t=e.$,n="index-selector__toggle--open",r="index-selector__index--selected",i,s;return{init:function(){this.getElements(),i.addClass("hidden"),i.find("li").first().addClass("hidden"),s.on("click",this.toggleDropdown)},getElements:function(){i=t(".index-selector__indices"),s=t(".index-selector__main button")},toggleDropdown:function(e){e.preventDefault(),s.toggleClass(n),i.toggleClass("hidden")}}}),define("module/responsiveIframe/iframe",["module/bootstrap"],function(e){var t=e.$,n=e.pubsub;return{updateFrequency:100,createIframe:function(e){location.host.indexOf("bbc.co.uk")!==-1&&(document.domain="bbc.co.uk");var r=t("#"+e+" a"),i=r.attr("data-iframe-src"),s=r.attr("id");this.iframe=t("<iframe>",{src:i,id:s,"class":"responsive-iframe",scrolling:"no",width:"100%",height:0}).on("load",t.proxy(function(){n.emit("responsiveiframe:loaded",[s]),this.iframeBody=this.iframe.contents().find("body"),this.startWatching(),this.modifyExternalLinks()},this)),r.replaceWith(this.iframe)},startWatching:function(){window.setInterval(t.proxy(function(){this.iframe.css("height",this.iframeBody.height()+"px")},this),this.updateFrequency)},modifyExternalLinks:function(){var e=this,n=this.iframeBody.find("a");n.each(function(){var n=t(this);if(n.attr("href")){var r=decodeURIComponent(n.attr("href"));e.isExternal(r,location)&&n.attr("target","_parent")}})},isExternal:function(e,t){var n=e.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/),r=!1;if(typeof n[1]=="string"&&n[1].length>0&&n[1].toLowerCase()!==t.protocol||typeof n[2]=="string"&&n[2].length>0&&n[2].replace(new RegExp("Î:("+{"http:":80,"https:":443}[t.protocol]+")?$"),"")!==t.host)r=!0;return r}}}),define("module/components/commentsButton",["module/bootstrap","module/responsiveIframe/iframe","module/commentCounts"],function(e,t,n){var r=e.$,i=e.pubsub;return{disableAction:function(e){e.preventDefault()},triggerComments:function(){this.commentsAction.off("click",r.proxy(this.triggerComments,this)),i.on("responsiveiframe:loaded",r.proxy(this.iframeLoaded,this)),this.spinner.appendTo(this.component.selector),this.openComments()},openComments:function(){t.createIframe(this.component.id),i.emit("stats:comments:open")},iframeLoaded:function(e){this.spinner.remove(),this.modifyIframeLinks(e)},modifyIframeLinks:function(e){var t=r("#"+e).contents(),n=".comments-permalink",i=".id4-cta-signin, .id4-cta-register, .id4-cta-signout",s=".comments-previous-comments a, .comments-permalink";t.find(s).attr("target","_parent"),t.find(n).each(function(){var e=r(this).attr("href");r(this).attr("href",e.replace("/iframe",""))}),t.find(i).each(function(){var e=r(this);if(e.attr("href")){var t=decodeURIComponent(e.attr("href")),n=t.split("/comments/iframe");if(n){var i=n[0]+"?comments";n[1]&&(i=i+"&"+n[1].substring(1)),e.attr("href",i)}}})},handleSuccess:function(e){n.init(),e.opts.jsEnabled&&(this.component=e,this.commentsAction=r(e.selector+" a"),this.commentsAction.on("click",r.proxy(this.disableAction)),this.commentsAction.on("click",r.proxy(this.triggerComments,this)),this.spinner=r('<div class="comments-button__loader js-comments-button__loader"><span class="comments-button__spinner"></span></div>'),window.location.href.indexOf("?comments")!==-1&&this.triggerComments())}}}),define("module/tabbed/panel",["module/bootstrap"],function(e){function r(e){t(e).attr("role","tabpanel")}var t=e.$,n=function(e){this.hide=function(){e.removeClass("open"),e.addClass("closed"),e.attr("aria-hidden",!0)},this.show=function(){e.removeClass("closed"),e.addClass("open"),e.attr("aria-hidden",!1)},r(e)};return n}),define("module/tabbed/tab",["module/bootstrap","module/tabbed/panel"],function(e,t){function r(e){return typeof e=="object"&&isFinite(e.length)}function i(e){return r(e)?n(e[0]):n(e)}function o(e,t){e.eq(0).attr("role","presentation"),e.parent().eq(0).attr("role","tablist"),t&&t.attr("role","tab")}function u(e){var t=e.which,r=n(e.target).parent(),i=r.next().find("a"),s=r.prev().find("a"),o=r.parent().find("a").first(),u=r.parent().find("a").last(),a;t===39?a=i.length?i:o:t===37&&(a=s.length?s:u),a&&(a.trigger("click"),a[0].focus())}var n=e.$,s=function(e,n,r,s){this.tabsName=s,this.tabId=typeof r!="undefined"?r:"",this.tab=i(e),this.panel=new t(i(n)),this.tabAnchor=this.tab.find("a")||!1,this.selected=!1,this.dataEvent=this.tab.attr("data-event")||!1,this.addListerners(),o(this.tab,this.tabAnchor)};return s.prototype.addListerners=function(){n(this.tab[0]).on("click",n.proxy(function(t){t.preventDefault(),e.pubsub.emit("tabs:click"),this.selected||e.pubsub.emit("tabs:activate",[this.tabsName,this.tabId])},this)),n(this.tab[0]).on("keydown",n.proxy(function(e){u(e)},this)),e.pubsub.on("tabs:deactivate",n.proxy(function(e){e===this.tabsName&&this.deactivate()},this)),e.pubsub.on("tabs:activate",n.proxy(function(e,t){t===this.tabId&&e===this.tabsName&&this.activate()},this))},s.prototype.activate=function(t){this.selected=!0,e.pubsub.emit("tabs:deactivate",[this.tabsName]),this.tab.addClass("open"),this.panel.show(),this.tabAnchor&&this.tabAnchor.attr("tabindex","0").append('<span class="off-screen"> selected</span>'),!t&&this.dataEvent&&e.pubsub.emit("tabs:activate:"+this.dataEvent)},s.prototype.deactivate=function(){this.selected=!1,this.tab.removeClass("open"),this.tab.find("span.off-screen").remove(),this.panel.hide(),this.tabAnchor&&this.tabAnchor.attr("tabindex","-1")},s}),define("module/tabbed/tabbed",["module/bootstrap","module/tabbed/tab"],function(e,t){function i(e,t,r){for(var i=0,s=e.length;i<s;i++){var o=i+1,u=e[i],a=t+"__tab-"+o;e[i]==="#"+n(e[i]).attr("id")&&(e[i]="#"+a),n(u).attr("id",a),n(r[i]).addClass("panel-"+o).attr("aria-labelledby",t+"__tab-"+o)}return e}var n=e.$,r=function(e,n,r,s){r=r===undefined?!0:r,this.tabsName=s||"default",this.tabs=[],e=i(e,this.tabsName,n);for(var o=0,u=e.length;o<u;o++)this.tabs.push(new t(e[o],n[o],o,this.tabsName));typeof this.tabs[0]!="undefined"&&this.tabs[0].activate(r)};return r.prototype.addTab=function(e,n){this.tabs.push(new t(e,n,this.tabs.length,this.tabsName))},r}),define("module/components/elections/indexTabs",["module/bootstrap","module/tabbed/tabbed"],function(e,t){var n=e.$;return{init:function(e,r,i){this.container=n("#"+e),this.container.addClass("election_data-council_list"),this.container.prepend(this.createTabsHtml(r,i)),this.tabs=new t(n(".council-list__tabs li"),n(".council-list__panel"),!0,"council-list")},createTabsHtml:function(e,t){return'<ul class="council-list__tabs" role="tablist"><li role="presentation"><a href="#" role="tab" tabindex="0" class="council-list__title">Map <span class="council-list__title-sub">'+e+"</span></a></li>"+'<li role="presentation"><a href="#" role="tab" tabindex="-1" class="council-list__title">'+this.container.find("h2").addClass("off-screen").html()+"</a></li>"+"</ul>"+'<div id="'+t+'" class ="council-list__panel"><div id="'+t+'-map" ></div></div>'}}}),define("module/components/elections/map/mapLoader",["module/bootstrap","module/featureDetector","deviceInspector"],function(e,t,n){return{init:function(e,n){t.can("SVG")&&this.setup(e,n)},setup:function(e,t){var n="#"+e.id,r=t.data,i=this.getSize();t.data&&(r=window.vote2014?JSON.parse(window.vote2014.councilResults||"{}"):{}),t.data=r,t.size=i,this.load(n,t,i)},getSize:function(){var e={group2:"s",group3:"m",group4:"l"};return e[n.getGroup()]||"s"},load:function(e,t,n){require(["data/maps/"+n+"/"+t.type,"module/components/elections/map/mapView"],function(n,r){var i;t.shape=n,i=new r(e,t),i.init()})}}}),define("module/components/election_data/england_council_list",["module/featureDetector","module/tabbed/tabbed","module/components/elections/indexTabs","module/components/elections/map/mapLoader"],function(e,t,n,r){return{init:function(t){var r="England",i="election-results-map--"+r.toLowerCase();e.can("SVG")&&(n.init(t.id,r,i),this.loadEnglandMap({id:i+"-map"}))},loadEnglandMap:function(e){var t={type:"england-elections",data:!0,options:{initZoom:!1,scale:3100,translate:[76,86],zoomBehavior:!0}};r.init(e,t)}}}),define("module/components/election_data/england_council_map",["module/bootstrap","module/components/elections/map/mapLoader"],function(e,t){return{init:function(e){var n={type:"england-elections",data:!0,options:{scale:2e3}};t.init(e,n)}}}),define("module/components/elections/hemicycle",["module/bootstrap","module/featureDetector"],function(e,t){var n=e.$,r=function(e){this.id="#"+e,this.data=[],this.width=400,this.height=265,this.innerRadius=78,this.outerRadius=200,this.startAngle=-1.9,this.duration=1500,this.chartGroupClassPrefix="hemicycle-chart-group--",this.valueSelector=this.id+" .hemicycle-group__meps",this.chartSelector=this.id+" .hemicycle-chart",this.chartDisplayClass="hemicycle-chart--svg",this.featureDetector=t};return r.prototype.init=function(){if(!this.featureDetector.can("SVG"))return!1;this.loadD3(),this.showKey()},r.prototype.showKey=function(){n(this.id+" .hemicycle-groups").addClass("hemicycle-groups--svg")},r.prototype.loadD3=function(){require(["vendor/d3/d3"],n.proxy(this.setup,this))},r.prototype.setup=function(e){this.d3=e,this.extractData(),this.addFillerToData(),this.setupSvg(),this.setupArc(),this.setupPie(),this.setupBackground(),this.setupSegments(),this.displayChart()},r.prototype.extractData=function(){n(this.valueSelector).each(n.proxy(function(e,t){var r=n(t).data("percentage");r>0&&this.data.push({group:this.chartGroupClassPrefix+n(t).data("group"),percentage:r})},this))},r.prototype.addFillerToData=function(){var e=n(this.chartSelector),t=e.data("percentage-not-declared");this.data.push({group:this.chartGroupClassPrefix+"notdeclared",percentage:t})},r.prototype.setupSvg=function(){this.svg=this.d3.select(this.chartSelector).append("svg").data([this.data]).attr("preserveAspectRatio","xMidYMid meet").attr("viewBox","0 0 "+this.width+" "+this.height).append("svg:g").attr("transform","translate("+this.outerRadius+","+this.outerRadius+")")},r.prototype.setupArc=function(){this.arc=this.d3.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius)},r.prototype.setupPie=function(){this.pie=this.d3.layout.pie().value(function(e){return e.percentage}).startAngle(this.startAngle).endAngle(Math.abs(this.startAngle)).sort(null)},r.prototype.setupBackground=function(){this.background=this.svg.append("path").datum({startAngle:this.startAngle,endAngle:Math.abs(this.startAngle)}).attr("class",this.chartGroupClassPrefix+"notdeclared").attr("d",this.arc)},r.prototype.setupSegments=function(){this.svg.selectAll("g").data(this.pie).enter().append("svg:path").attr("class",function(e,t){return e.data.group}).attr("d",this.arc).transition().duration(this.duration).call(this.tweenPie,this).each("end",n.proxy(function(){this.background.remove()},this))},r.prototype.tweenPie=function(e,t){e.attrTween("d",function(e){var n=t.d3.interpolate({startAngle:t.startAngle,endAngle:t.startAngle},e);return function(e){return t.arc(n(e))}})},r.prototype.displayChart=function(){n(this.chartSelector).addClass(this.chartDisplayClass)},r}),define("module/components/elections/toggle",["module/bootstrap"],function(e){var t=e.$,n=function(e){e=e||{},this.linkToAttribute="data-linkto",this.linkToSelector="*["+this.linkToAttribute+"]",this.previousEventTimestamp=0,this.selectedClass="selected",e.hasOwnProperty("statsName")&&(this.statsName=e.statsName)};return n.prototype.init=function(e){var n=t(e);this.hideToggleInfo(n),this.bindToggle(n)},n.prototype.hideToggleInfo=function(e){var n=[];e.find(this.linkToSelector).each(t.proxy(function(e,t){n.push(t.getAttribute(this.linkToAttribute))},this)),e.find(n.join(", ")).hide()},n.prototype.bindToggle=function(e){e.on("click keydown",this.linkToSelector,t.proxy(this.handleClick,this))},n.prototype.handleClick=function(e){var n;if(!this.shouldHandleEvent(e))return;e.preventDefault(),n=t(e.currentTarget),this.toggleDescriptiveText(n),this.toggleSelectedState(n),this.toggleContent(n),this.sendStats(n)},n.prototype.shouldHandleEvent=function(e){return this.isValidTimeStamp(e)&&this.isValidKeyPressEvent(e)?!0:!1},n.prototype.isValidTimeStamp=function(e){var t=!0;if(e.timeStamp<this.previousEventTimestamp+100||e.timeStamp===0)t=!1;return this.previousEventTimestamp=e.timeStamp,t},n.prototype.isValidKeyPressEvent=function(e){var t=13,n=32;return e.type==="keydown"&&e.keyCode!==t&&e.keyCode!==n?!1:!0},n.prototype.toggleDescriptiveText=function(e){var t=".linkto-description",n=e.find(t),r=n.text()==="more"?"less":"more";n.text(r)},n.prototype.toggleContent=function(e){t(e.attr(this.linkToAttribute)).toggle()},n.prototype.getStatsEventName=function(e){if(!this.statsName)return;var t="close";return e.hasClass(this.selectedClass)&&(t="open"),t},n.prototype.sendStats=function(t){var n=this.getStatsEventName(t);n&&e.pubsub.emit(this.statsName+":toggle",[n])},n.prototype.toggleSelectedState=function(e){e.toggleClass(this.selectedClass)},n}),define("module/components/election_data/eu_country_results",["module/bootstrap","module/components/elections/hemicycle","module/components/elections/toggle"],function(e,t,n){var r=e.$,i=[];return{init:function(e){var t=new n({statsName:"eucountry"});t.init(e.selector),this.bindEvents(e)},bindEvents:function(e){r(e.selector).on("click keydown","a",r.proxy(this.activateLink,this)),r(e.selector).on("click keydown","tr",r.proxy(this.showHemicycle,this))},activateLink:function(e){e.stopImmediatePropagation()},showHemicycle:function(e){var n,s;if(!this.isValidKeyPressEvent(e))return;n=r(e.currentTarget).find(".overall-hemicycle").attr("id");if(i.indexOf(n)!==-1)return;s=new t(n),i.push(n),s.init()},isValidKeyPressEvent:function(e){var t=13,n=32;return e.type==="keydown"&&e.keyCode!==t&&e.keyCode!==n?!1:!0}}}),define("module/components/election_data/eu_hemicycle",["module/bootstrap","module/components/elections/hemicycle"],function(e,t){return{init:function(e){var n=new t("overall-hemicycle");n.init()}}}),define("module/components/election_data/eu_region_map",["module/bootstrap","module/components/elections/map/mapLoader"],function(e,t){return{init:function(e){var n={type:"european-elections",data:!1,options:{scale:2e3}};t.init(e,n)}}}),define("module/components/elections/euTabs",["module/bootstrap","module/tabbed/tabbed","deviceInspector"],function(e,t,n){var r=e.$,i=!1,s="eu-tabs",o="eu-tabs-tab",u="eu-tabs-tab__link",a="eu-tabs__panel";return{init:function(t){t=t||{},this.containers=t.containers,n=t.deviceInspector||n,this.createTabs(n.getGroup()),e.pubsub.on("deviceGroup",r.proxy(this.handleResize,this))},handleResize:function(e){this.createTabs(e)},createTabs:function(e){this.tabsShouldBeCreated(e)&&(this.insertTabs(this.createTabsHtml()),this.loadTabs(),i=!0)},insertTabs:function(e){r(this.containers[0]).before(e)},correctDevice:function(e){return/group3|4/i.test(e)?!0:!1},doAllContainersExist:function(){return this.containers.length===r(this.containers.join(",")).length},tabsShouldBeCreated:function(e){return i===!0||!this.correctDevice(e)?!1:this.doAllContainersExist()},createTabsHtml:function(){var e='<ul class="'+s+'">';return r.each(this.containers,r.proxy(function(t,n){e+='<li class="'+o+'">',e+='<a href="#" class="'+u+'">',e+=this.getContainerHeadline(n),e+="</a></li>"},this)),e+="</ul>",e},getContainerHeadline:function(e){return r(e).find("h2").html()},loadTabs:function(){new t(r("."+o),r("."+a),!0,"eu")},setTabsCreated:function(e){i=e}}}),define("module/components/election_data/eu_region_meps_list",["module/bootstrap","module/components/elections/euTabs"],function(e,t){return{init:function(){t.init({containers:["#eu-meps-list","#eu-results"]})}}}),define("module/components/election_data/eu_region_meps_list_cy",["module/components/election_data/eu_region_meps_list"],function(e){return e}),define("module/components/elections/more",["module/bootstrap"],function(e){var t=e.$,n,r,i,s,o;return{init:function(e){if(e.length===0)return;n=t("#"+e.buttonId),r=e.hideClass,i=e.showClass,s=n.find(".less-more").html(),o=n.data("less"),this.addEventHandler()},addEventHandler:function(){if(!n.length)return;n.on("click",t.proxy(this.handleClick,this))},handleClick:function(e){e.preventDefault(),this.hasShowClass()?(this.hideItems(),n.find(".less-more").html(s),n.removeClass("show")):(this.showItems(),n.find(".less-more").html(o),n.addClass("show"))},hasShowClass:function(){return t("."+r).hasClass(i)},hideItems:function(){t("."+r).removeClass(i)},showItems:function(){t("."+r).addClass(i)}}}),define("module/components/election_data/eu_region_results",["module/bootstrap","module/components/elections/more"],function(e,t){var n={buttonId:"eu-table-more",hideClass:"table-body__row--hide",showClass:"table-body__row--show"};return{init:function(){t.init(n)}}}),define("module/components/election_data/eu_region_results_cy",["module/components/election_data/eu_region_results"],function(e){return e}),define("module/components/election_data/ni_council_map",["module/bootstrap","module/components/elections/map/mapLoader"],function(e,t){return{init:function(e){var n={type:"northern-ireland-elections",data:!0,options:{scale:2e3}};t.init(e,n)}}}),define("module/components/election_data/scot_ref_summary_table",["module/bootstrap","module/featureDetector","deviceInspector","vendor/d3/d3"],function(e,t,n,r){var i,s,o,u,a,f="name",l="#scot-ref-sorter",c=".scot-ref-sort-by-list-item__link",h="#scot-ref-sort-by__button",p="scot-ref-sort-by-list-item--selected",d=".body-row__cell--undeclared",v="#scot-ref-sort-by-list",m,g="scot-ref-sort-by-list--open",y="scot-ref-summary-table__body--animate",b="data_components/scot_ref_summary_data",w=!1;return{init:function(t){this.animating=!1,this.councilResults={},i=t.selector,s=r.select("#scot-ref-summary-table"),o=s.select(".scot-ref-summary-table__body"),u=s.selectAll(".scot-ref-summary-table__body-row"),this.handleResize(n.getGroup()),e.pubsub.on("deviceGroup",function(e){w=e}),require.specified(b)&&this.loadData()},loadData:function(){var e=this;require([b],function(t){e.dataLoaded(t)})},dataLoaded:function(e){var t="council_summary";if(!e||!e.hasOwnProperty(t)||Object.keys(e).length===0)return;this.councilResults=r.values(e[t]).filter(function(e){return Object.keys(e).length>0});if(!this.councilResults)return;this.normaliseData(),u.data(this.councilResults),this.addSorter(i,"#scot-ref-summary-table-wrapper"),this.bindEvents(l,c)},normaliseData:function(){var e=this.councilResults;try{u.each(function(t,n){r.select(this).select(d).size()>0&&e[n]&&e[n].shareNo&&e[n].shareYes&&(e[n].shareNo>0||e[n].shareYes>0)&&(e[n].shareNo=0,e[n].shareYes=0)})}catch(t){}this.councilResults=e},bindEvents:function(){this.bindButton(h),this.bindSortFilters(l,c)},bindButton:function(e){var t=this;m=r.select(v),r.select(e).on("click",function(){t.buttonClick()})},bindSortFilters:function(e,t){var n=this;a=r.select(e).selectAll(t),a.on("click",function(){n.closeDropdown();if(n.animating)return;var e=this.getAttribute("data-sort");if(e===f)return;n.update(e),n.logStats(e)})},buttonClick:function(){m.classed(g)?this.closeDropdown():this.openDropdown()},closeDropdown:function(){m.classed(g,!1),this.wideDevice||a.attr("tabindex",-1)},openDropdown:function(){m.classed(g,!0),this.wideDevice||(m.select(c+":first-child")[0][0].focus(),a.attr("tabindex",0))},handleResize:function(e){this.wideDevice=/group(3|4)/i.test(e),this.canTransition=t.can("CssTransition")&&t.can("CssTransform")&&this.wideDevice,this.canTransition&&(this.supportedTransitionEnd=t.which("TransitionEnd")),this.rowHeight=u[0][0].offsetHeight+parseInt(u.style("margin-bottom"),10)},update:function(e){var t=this,n=t.councilResults.map(function(e){return e.name}),i=t.sort(t.councilResults,e),s=i.map(function(e){return e.name});w&&(t.handleResize(w),w=!1),a.classed(p,!1),r.select(l).select('*[data-sort="'+e+'"]').classed(p,!0),f=e,t.animating=!0,o.classed(y,!0);if(this.canTransition){var c=0;u.each(function(r,i){var o=t.yPosition(n.indexOf(r.name),s.indexOf(r.name));o!==0&&(t.setStyles(this,t.getTransformStyles(o)),c++,this.addEventListener(t.supportedTransitionEnd,function(){c--,c===0&&t.transitionEnd(e)}))}),c===0&&t.transitionEnd(e)}else this.transitionEnd(e)},transitionEnd:function(e){o.classed(y,!1),this.sort(u,e),u.style(this.getTransformStyles(0)),this.animating=!1},getTransformStyles:function(e){return{transform:"translateY("+e+"px)","-webkit-transform":"translateY("+e+"px)","-moz-transform":"translateY("+e+"px)","-o-transform":"translateY("+e+"px)"}},setStyles:function(e,t){for(var n in t)e.style[n]=t[n]},sort:function(e,t){var n={electorate:function(e,n){return n[t]-e[t]},name:function(e,n){return r.ascending(e[t],n[t])},shareNo:function(e,n){return n[t]-e[t]||r.ascending(e.name,n.name)},shareYes:function(e,n){return n[t]-e[t]||r.ascending(e.name,n.name)}};return e.sort(n[t])},yPosition:function(e,t){return t*this.rowHeight-e*this.rowHeight},addSorter:function(e,t){r.select(e).insert("div",t).attr("id","scot-ref-sorter").attr("class","scot-ref-sort-by").html(this.filterHtml())},filterHtml:function(){return'<h3 class="scot-ref-sort-by__header">Sort By</h3><div class="scot-ref-sort-by__outer"><button class="scot-ref-sort-by__button" id="scot-ref-sort-by__button" data-close="Close list"><span>Open list</span></button><ul id="scot-ref-sort-by-list" class="scot-ref-sort-by-list"><li class="scot-ref-sort-by-list-item"><button data-sort="name" class="scot-ref-sort-by-list-item__link scot-ref-sort-by-list-item--selected">A - Z</button></li><li class="scot-ref-sort-by-list-item"><button data-sort="electorate" class="scot-ref-sort-by-list-item__link">Electorate</button></li><li class="scot-ref-sort-by-list-item"><button data-sort="shareYes" class="scot-ref-sort-by-list-item__link">YES %</button></li><li class="scot-ref-sort-by-list-item"><button data-sort="shareNo" class="scot-ref-sort-by-list-item__link">NO %</button></li></ul></div>'},logStats:function(t){e.pubsub.emit("scotref:summary:filter",[t])}}}),define("module/components/elections/banner",["module/bootstrap","module/featureDetector"],function(e,t){var n=e.$,r=1,i,s,o="transitionend webkitTransitionEnd oTransitionEnd",u="#election-banner-template",a="#election-banner",f="#election-banner__pause",l="election-banner-list__item",c="election-banner__pause--play",h=l+"--transparent",p="Play Ticker",d="Pause Ticker",v=!1;return{handleSuccess:function(e,t){n(a).html(n(u).html()),this.play(),this.bindEvents()},pausePlay:function(){s===!1?(this.pause(),this.trackStat("pause")):(this.play(),this.trackStat("play"))},trackStat:function(t){e.pubsub.emit("banner:ticker:toggle",[t])},play:function(){i=setInterval(n.proxy(this.changeBanner,this),4990),s=!1,this.setPauseText(d),n(f).toggleClass(c)},pause:function(){clearInterval(i),s=!0,this.setPauseText(p),n(f).toggleClass(c)},setPauseText:function(e){n(f).attr("title",e),n(f).find("span").html(e)},numberOfItems:function(){return n("."+l).length},getItem:function(e){return n("."+l+":nth-child("+e+")")},nextItem:function(){r++,r>this.numberOfItems()&&(r=1)},changeBanner:function(){var e=this.getItem(r);t.can("CssTransition")?e.on(o,n.proxy(function(){e.off(o),this.showNextItem()},this)):this.showNextItem(),e.addClass(h)},showNextItem:function(){this.nextItem(),this.getItem(r).removeClass(h)},bindEvents:function(){n(f).on("click",n.proxy(this.pausePlay,this)),n(window).on("blur",n.proxy(this.pageInactive,this)),n(window).on("focus",n.proxy(this.pageActive,this))},pageInactive:function(){s?v=!1:(this.pause(),v=!0)},pageActive:function(){v&&this.play()}}}),define("module/components/elections/banner/bannerLoader",["module/bootstrap"],function(e){var t=e.$,n="/news/components?batch[remote-portlet][opts][id]=election_data/",r={config:{pre:n+"england_council_banner_pre",manual:n+"manual_banner",gb:n+"england_council_banner",eu:n+"eu_uk_banner?variant=K03000001"},staticData:[{heading:"Vote 2014",text:"Elections in 161 English councils"},{heading:"England",text:"First result expected at 23:45"},{heading:"Northern Ireland",text:"Elections in 11 Northern Ireland councils"},{heading:"Europe",text:"European election results due on Sunday"}],cachedData:"",getData:function(e){var n=this.getUrl(e);n&&t.ajax({url:n,dataType:"json",success:t.proxy(this.handleSuccess,this),error:t.proxy(this.handleError,this)})},getUrl:function(e){return this.config[e]||!1},handleSuccess:function(n){var r="",i=!1;this.isValidData(n)?(r=t(n["remote-portlet"])[0].innerHTML,this.isCachedData(r)||(this.cachedData=r,i=this.convertToJson(r))):i=this.staticData,e.pubsub.emit("election:banner:data",[i])},handleError:function(t){e.pubsub.emit("election:banner:error")},isValidData:function(e){return e&&e["remote-portlet"]!==undefined},isCachedData:function(e){return e===this.cachedData},convertToJson:function(e){var t=this.staticData;try{t=JSON.parse(e)}catch(n){}return t}};return r}),define("module/components/elections/banner/liveBanner",["module/bootstrap","module/featureDetector","module/components/elections/banner/bannerLoader"],function(e,t,n){var r=e.$,i=["-webkit-","-o-","-moz-",""],s="animationend webkitAnimationEnd oAnimationEnd",o="animationstart webkitAnimationStart oAnimationStart",u="transitionend webkitTransitionEnd oTransitionEnd",a=-1,f=5e3,l="#election-live-banner",c="election-live-banner--play",h="election-live-banner-slot__item",p=h+"--next",d=h+"--current",v=h+"--hide",m="election-live-banner-slot",g="#election-live-banner-content-1",y="#election-live-banner-content-2",b="#election-live-banner-refresh",w=".election-live-banner-refresh__progress",E="election-live-banner-refresh__progress--spin",S="#election-live-banner-pause",x="election-live-banner-pause",T=x+"--play",N="Pause Ticker",C="Play Ticker",k=!1,L=!1,A=!1,O=!1,M=!1,_,D;return{handleSuccess:function(i,s){if(!t.can("CssTransition"))return;this.setBannerType(),this.setDoesSupportRotation(),this.bindButtonEvents(),this.addBannerTypeClass(),n.getData(D),e.pubsub.on("election:banner:data",r.proxy(this.init,this)),e.pubsub.on("election:banner:error",function(){})},init:function(t){if(!t)return;e.pubsub.off("election:banner:data"),this.setBannerData(t),this.showBanner(),this.bindContainerEvents(),this.displayNextBannerItem(),this.play()},setBannerType:function(){D=r(l).data("banner-type")},getBannerType:function(){return D},setBannerData:function(e){_=e},addBannerTypeClass:function(){r(l).addClass("election-live-banner--"+D)},showBanner:function(){r(l).show()},setDoesSupportRotation:function(){O=t.can("CssPreserve3d")},getDoesSupportRotation:function(){return O},setYOffSetOnItems:function(e){if(!O)return;var t=this.getItems(e,"."+d+", ."+v);this.setTransform(t,this.getHalfWidthOfCurrentItem())},getItems:function(e,t){return e?r(e).find(t):r(t)},getHalfWidthOfCurrentItem:function(){return r("."+d).outerWidth()/2},setTransform:function(e,t){for(var n=0;n<i.length;n++)e.css(i[n]+"transform","translate3d(0, "+t+"px, 0) rotateX(270deg) rotateY(0deg) rotateZ(0deg)")},displayNextBannerItem:function(){this.clearBannerTimeout();var e=_;a++,a===e.length&&(a=0);var t=e[a]||{};A=!1,t.hasOwnProperty("text")?(L=!0,this.renderTextItem(t),M||this.setBannerTimeout()):t.hasOwnProperty("slots")&&(L=!1,this.renderSlotItem(t),this.setYOffSetOnItems(),this.bindSlotEvents())},setIsTextBanner:function(e){L=e},setCurrentItemIndex:function(e){a=e},setIsLastItem:function(e){A=e},getCurrentItemIndex:function(){return a},renderTextItem:function(e){var t=e.text.replace(/&gt;/g,">").replace(/&lt;/g,"<"),n='<div class="election-live-banner__title">'+e.heading+"</div>";n+='<div class="election-live-banner__text">'+t+"</div>",this.renderContent(n)},renderSlotItem:function(e){var t='<div class="election-live-banner__title">'+e.heading+"</div>";r.each(e.slots,r.proxy(function(e,n){t+='<div class="election-live-banner__scene election-live-banner__scene--'+n.code+'">',t+='<ol class="election-live-banner-slot',O&&(t+=" election-live-banner-slot--rotate"),t+=" election-live-banner-slot--"+(e+1)+'">',t+='<li class="election-live-banner-slot__item election-live-banner-slot__item--current">'+n.data[0]+"</li>",t+='<li class="election-live-banner-slot__item election-live-banner-slot__item--next">'+n.data[1]+"</li>",t+='<li class="election-live-banner-slot__item election-live-banner-slot__item--hide">'+n.data[2]+"</li>",t+="</ol></div>"},this)),this.renderContent(t)},renderContent:function(e){var t=r(g),n=r(y);n.hasClass("fadeout")?(t.addClass("fadeout"),n.html(e),n.removeClass("fadeout")):(n.addClass("fadeout"),t.html(e),t.removeClass("fadeout"))},setBannerTimeout:function(){if(k)return;k=setTimeout(r.proxy(this.displayNextBannerItem,this),f)},clearBannerTimeout:function(){clearTimeout(k),k=null},play:function(){M=!1,r(l).addClass(c),r(S).attr("title",N),r(S).find("span").html(N),(L===!0||A===!0)&&this.setBannerTimeout()},pause:function(){M=!0,r(l).removeClass(c),r(S).attr("title",C),r(S).find("span").html(C),this.clearBannerTimeout()},pauseButtonPressed:function(e){if(!e)return;var t=r(e.target);t.hasClass(T)?(t.removeClass(T),this.play(),this.trackStat("play")):(t.addClass(T),this.pause(),this.trackStat("pause"))},refreshButtonPressed:function(t){t&&t.preventDefault(),this.trackStat("refresh"),this.clearBannerTimeout(),r(w).addClass(E),n.getData(D),e.pubsub.on("election:banner:data",r.proxy(this.restartBanner,this))},trackStat:function(t){e.pubsub.emit("banner:ticker:toggle",[t])},restartBanner:function(t){t&&(_=t),r(w).removeClass(E),e.pubsub.off("election:banner:data"),a=-1,this.displayNextBannerItem()},bindContainerEvents:function(){r(g).on(u,r.proxy(this.transitionEnd,this)),r(y).on(u,r.proxy(this.transitionEnd,this))},bindSlotEvents:function(){r("."+m).on(o,r.proxy(this.animStart,this)),r("."+m).on(s,r.proxy(this.animEnd,this))},bindButtonEvents:function(){r(S).on("click",r.proxy(this.pauseButtonPressed,this)),r(b).on("click",r.proxy(this.refreshButtonPressed,this))},animStart:function(e){if(!e)return;var t=r(e.target);if(!t.hasClass(m))return;this.setYOffSetOnItems(t)},animEnd:function(e){if(!e)return;A=!1;var t=r(e.target),n;t.hasClass(m)&&t.parent().is(":last-child")&&(n=r(t).find("."+p),n.is(":last-child")&&(A=!0,this.setBannerTimeout()),r(l).find("."+m).each(r.proxy(this.setUpNewItems,this)))},setUpNewItems:function(e,t){var n=r(t),i=n.find("."+d),s=n.find("."+p),o=n.find("."+v);i.removeClass(d).addClass(v),s.removeClass(p).addClass(d),o.removeClass(v).addClass(p).attr("style",""),this.clone(t)},clone:function(e){e=r(e);var t=e.clone(!0);e.before(t),e.remove()},transitionEnd:function(e){if(!e)return;var t=r(e.target);t.hasClass("fadeout")&&t.html("")}}}),define("module/components/elections/councilMore",["module/bootstrap","module/components/elections/more"],function(e,t){var n=e.$,r={buttonId:"council-more-button",hideClass:"council-more-button-panel--hide",showClass:"council-more-button-panel--show"};return{handleSuccess:function(e,t){n(e.selector).append(t),this.showComponent(e.selector),this.init()},showComponent:function(e){n(e).removeClass("hidden")},init:function(){t.init(r)}}}),define("module/components/elections/euParliamentExplainer",["module/bootstrap","module/components/elections/toggle"],function(e,t){var n=e.$;return{handleSuccess:function(e,r){var i=new t({statsName:"euexplainer"});n(e.selector).append(r),i.init(e.selector)}}}),define("module/components/elections/findAResult",["module/bootstrap"],function(e){var t=e.$,n,r={"English Councils":"/news/politics/councils/","NI Councils":"/news/politics/councils/","EU - UK Regions":"/news/politics/eu-regions/"},i={"England council results":"/news/events/vote2014/england-council-election-results","Northern Ireland council results":"/news/events/vote2014/ni-council-election-results","UK European election results":"/news/events/vote2014/eu-uk-results","European Parliament results":"/news/events/vote2014/eu-election-results"};return{handleSuccess:function(e,t){this.process(e.selector)},process:function(e){var n=t(e),r=this.getEuRegionsAndCouncils(),i=this.getEuRegionsAndCouncilsKeys(r);this.initSelect(),i.length&&this.turnEuRegionsAndCouncilsIntoDropdown(r),this.addSelectToPage(n),n.addClass("election-find-a-result--loaded")},getEuRegionsAndCouncils:function(){return window.vote2014&&window.vote2014.findAResultData?window.vote2014.findAResultData:{}},getEuRegionsAndCouncilsKeys:function(e){return Object.keys(e)},turnEuRegionsAndCouncilsIntoDropdown:function(e){var t,i,s,o;for(i in e)if(e.hasOwnProperty(i)){t=this.createGroup(i),n.append(t);for(s in e[i])e[i].hasOwnProperty(s)&&(o=this.createItem(e[i][s],r[i]),t.append(o))}},initSelect:function(){n=this.createSelect(),n.append(this.createTopLevelItems())},addSelectToPage:function(e){this.replaceLinkWithDropdown(e,n),this.addChangeHandler(n)},createSelect:function(){return t("<select><option selected>Find a result</option></select>")},createGroup:function(e){return t('<optgroup label="'+e+'"></optgroup>')},createItem:function(e,t){return this.createOption(t+e.gssId,e.name)},createOption:function(e,n){return t('<option value="'+e+'">'+n+"</option>")},createTopLevelItems:function(){var e=this.createGroup("Results"),t;for(t in i)i.hasOwnProperty(t)&&e.append(this.createOption(i[t],t));return e},replaceLinkWithDropdown:function(e,t){e.html(t)},addChangeHandler:function(e){e.on("change",t.proxy(this.onOptionChange,this))},onOptionChange:function(t){e.pubsub.emit("election:findaresult:change",[t.target.value]),this.setWindowLocation(t.target.value)},setWindowLocation:function(e){window.location=e}}}),define("module/components/elections/map/mapView",["vendor/d3/d3","vendor/topojson/topojson","module/bootstrap"],function(e,t,n){var r=n.$,i=function(e,t){var n={scale:1500,translate:[0,0],zoom:!1,keys:!0,scaleExtent:[1,64]};this.id=e,this.type=t.type,this.shape=t.shape,this.data=t.data,this.size=t.size,this.dragging=!1,this.settings=r.extend({},n,t.options),this.baseUrls={"european-elections":"/news/politics/eu-regions/","northern-ireland-elections":"/news/politics/councils/","england-elections":"/news/politics/councils/"},this.elements={zoomControlClass:"election-map__control-btn",zoomInControlClass:"election-map__control--zoomIn",zoomOutControlClass:"election-map__control--zoomOut",zoomResetControlClass:"election-map__control--reset",disableControlClass:"election-map__control--disabled",hideLabelsClass:"election-map--hideLabels"}};return i.prototype.init=function(){this.setup(this.id),this.loadShape(this.shape),this.settings.initZoom!==!1?this.locateGssId():this.hideLabels(),this.addLabels(this.boundaries),this.settings.zoomBehavior&&(this.setZoomBehavior(),e.select(this.id).call(this.zoomBehavior).on("dblclick.zoom",null),this.setupControls())},i.prototype.setup=function(e){var t=r(e);this.setType(t),this.setSize(t),this.setMain(e),this.setEvents(),this.getElements(),this.setPath(),this.setCentroid()},i.prototype.setType=function(e){e.addClass("election-map-container election-map-container--"+this.type)},i.prototype.setSize=function(e){this.width=e.width(),this.height=e.height()},i.prototype.setMain=function(t){var n=this.width,r=this.height;this.main=e.select(t).append("div").attr("id","election-map-view").append("svg").attr("id","election-map-svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+n+" "+r).attr("width",n).attr("height",r).append("g").append("g"),this.clipView()},i.prototype.clipView=function(){e.select("svg g").attr("clip-path","url(#clipView)"),e.select("svg").insert("defs","g").append("clipPath").attr("id","clipView").append("rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height)},i.prototype.setEvents=function(){this.mousedown=!1,this.main.on("mousedown",r.proxy(this.mousedownEvent,this)).on("click",r.proxy(this.areaSelected,this))},i.prototype.getElements=function(){this.view=document.getElementById("election-map-view"),this.svg=document.getElementById("election-map-svg")},i.prototype.setPath=function(){this.path=e.geo.path().projection(e.geo.albers().center([0,55.4]).rotate([4.4,0]).parallels([50,60]).scale(this.settings.scale).translate(this.settings.translate))},i.prototype.setCentroid=function(e,t,n){var r=e||[];this.centroid={x:r[0]||this.width/2,y:r[1]||this.height/2,k:t||1},this.centered=n||null},i.prototype.loadShape=function(e){this.boundaries=t.feature(e,e.objects[this.type]),this.main.append("g").attr("id",this.type).selectAll("path").data(this.boundaries.features).enter().append("path").attr("class",r.proxy(this.addResultClass,this)).attr("d",this.path).attr("data-gssid",r.proxy(this.getDataGssId,this))},i.prototype.locateGssId=function(){var t=this.getGssId(),n=e.select("path[data-gssid="+t+"]");this.setZoomLevel(n[0][0],t),n.text(r.proxy(this.zoomTo,this)),t==="S15000001"&&this.updateTransform({x:4,y:-68,k:1.2})},i.prototype.getGssId=function(){var e=r(".election-map-gssid").data("gssid")||document.URL.match(/([A-Z][0-9]{8})/)[1];return e},i.prototype.getDataGssId=function(e){return e.properties.ID},i.prototype.getDataLabel=function(e){return e.properties.NAME},i.prototype.getCentroidX=function(e){var t=this.getAdjustedPosition(e);return this.path.centroid(e)[0]+t.x},i.prototype.getCentroidY=function(e){var t=this.getAdjustedPosition(e);return this.path.centroid(e)[1]+t.y},i.prototype.isCentered=function(e){return e&&e===this.centered},i.prototype.isOutline=function(e){return e==="E92000001"||e==="W92000004"},i.prototype.addResultClass=function(e){var t="election-map__area election-map__area-",n=this.getDataGssId(e);return this.isOutline(n)?t="":t+=this.getPartyCode(e),t},i.prototype.getPartyCode=function(e){var t=this.getDataGssId(e),n=this.data[t]?this.data[t].partyCode:"";return n.toLowerCase()},i.prototype.addSelectedClass=function(){this.main.selectAll("path").classed("election-map__area--selected",r.proxy(this.isCentered,this))},i.prototype.updateTransform=function(e){this.main.attr("transform","translate("+this.width/2+","+this.height/2+") scale("+e.k+") translate("+ -e.x+","+ -e.y+")").style("stroke-width",1.5/e.k+"px")},i.prototype.zoomTo=function(e){var t=this.isCentered(e),n=this.path.centroid(e);t?this.setCentroid():this.setCentroid(n,this.centroid.k,e),this.addSelectedClass(),this.updateTransform(this.centroid)},i.prototype.mousedownEvent=function(){this.mousedown=!0},i.prototype.areaSelected=function(){var t=e.select(e.event.target).datum(),n=this.getDataGssId(t),r=this.baseUrls[this.type]+n;if(this.dragging===!0||this.isOutline(n)){this.dragging=!1,this.mousedown=!1;return}window.location.href=r},i.prototype.setZoomLevel=function(e,t){this.settings.zoom?this.centroid.k=this.settings.zoom:this.setDynamicZoomLevel(e,t)},i.prototype.setDynamicZoomLevel=function(e,t){if(!e){r(this.id).addClass("election-map-container--error");return}var n=e.getBoundingClientRect(),i=n.width,s=n.height;this.centroid.k=200/Math.max(i,s),t==="E07000195"&&(this.centroid.k=40)},i.prototype.setupControls=function(){this.addControls(),this.settings.keys&&this.addKeys(),r(".election-map__control a").on("click",r.proxy(this.addControlsEvents,this))},i.prototype.addControls=function(){var e='<div class="election-map__control"><a class="election-map__control-btn election-map__control--reset election-map__control--disabled" data-zoom="1" title="Reset the map">Reset</a><a class="election-map__control-btn election-map__control--zoomIn" data-zoom="4" title="Zoom the map in"></a><a class="election-map__control-btn election-map__control--zoomOut election-map__control--disabled" data-zoom="0.25" title="Zoom the map out"></a></div>';r(this.id).before(e)},i.prototype.addKeys=function(){var e='<div class="election-map__keys"><p><span class="election-map__keys-info1"></span>No overall control</p><p><span class="election-map__keys-info2"></span>Result not in</p></div>';r(this.id).after(e)},i.prototype.addControlsEvents=function(e){e.preventDefault();var t=this.zoomBehavior,n=[this.width/2,this.height/2],i=t.scaleExtent(),s=t.translate(),o={x:s[0],y:s[1],k:t.scale()},u=r(e.target).data("zoom"),a=t.scale()*u;u===1?(a=1,o.x=0,o.y=0,this.reset=!0):(a=a<i[0]?i[0]:a>i[1]?i[1]:a,o.x+=n[0]-((n[0]-o.x)/o.k*a+o.x),o.y+=n[1]-((n[1]-o.y)/o.k*a+o.y),this.reset=!1),this.interpolateZoom([o.x,o.y],a)},i.prototype.updateControlsClass=function(e,t,n){var i=this.zoomBehavior.scaleExtent();r("."+this.elements.zoomControlClass).removeClass(this.elements.disableControlClass),n===i[0]&&r("."+this.elements.zoomOutControlClass).addClass(this.elements.disableControlClass),n===i[1]&&r("."+this.elements.zoomInControlClass).addClass(this.elements.disableControlClass),e===0&&t===0&&n===1&&r("."+this.elements.zoomResetControlClass).addClass(this.elements.disableControlClass)},i.prototype.interpolateZoom=function(t,n){var r=this,i=this.zoomBehavior,s=0;this.size==="l"&&(s=350),e.transition().duration(s).tween("zoom",function(){var s=e.interpolate(i.translate(),t),o=e.interpolate(i.scale(),n);return function(e){i.scale(o(e)).translate(s(e)),r.target=r.svg,r.updateCssTransform(r.target,i.translate(),i.scale()),r.reset&&r.size!=="l"&&r.updateCssTransform(r.view,i.translate(),i.scale())}}).each("end",function(){r.zoomEnd("click")})},i.prototype.setZoomBehavior=function(){this.zoomBehavior=e.behavior.zoom().size([this.width,this.height]).scaleExtent(this.settings.scaleExtent).on("zoomstart",r.proxy(this.zoomStart,this)).on("zoom",r.proxy(this.zoomed,this)).on("zoomend",r.proxy(this.zoomEnd,this))},i.prototype.zoomStart=function(){this.visibleLabels()||this.size==="l"?this.target=this.svg:(this.switchCssTransform(this.svg,this.view),this.target=this.view)},i.prototype.zoomed=function(){this.dragging=!0,this.updateCssTransform(this.target,e.event.translate,e.event.scale)},i.prototype.zoomEnd=function(e){this.mousedown||(this.dragging=!1),this.getVisibleArea(),this.updateControlsClass(this.centroid.x,this.centroid.y,this.centroid.k),this.target===this.view&&this.switchCssTransform(this.view,this.svg),this.logStats(e?e:"pinch")},i.prototype.switchCssTransform=function(e,t){var n=e.style.transform;this.setCssTransform(t,n),this.setCssTransform(e,"translatez(0)")},i.prototype.updateCssTransform=function(e,t,n){var r=t[0],i=t[1],s=n,o;this.size!=="l"&&(r=r.toFixed(2),i=i.toFixed(2),s=s.toFixed(2)),o="translate("+r+"px, "+i+"px) scale("+s+")",this.setCssTransform(e,o),this.centroid.k>n&&this.hideLabels(),this.visibleLabels()&&this.centroid.k!==n&&this.resizeLabels(),this.centroid.x=r,this.centroid.y=i,this.centroid.k=s},i.prototype.setCssTransform=function(e,t){var n=["transform","webkitTransform","mozTransform"];for(var r=n.length-1;r>=0;r-=1)e.style[n[r]]=t},i.prototype.addLabels=function(e){this.main.select("#"+this.type).selectAll("text").data(e.features).enter().append("text").text(r.proxy(this.getDataLabel,this)).attr("x",r.proxy(this.getCentroidX,this)).attr("y",r.proxy(this.getCentroidY,this)).attr("text-anchor","middle").attr("class",r.proxy(this.addLabelClass,this)).attr("font-size",(12/this.centroid.k).toFixed(2)+"px")},i.prototype.addLabelClass=function(e){var t="election-map-label",n=this.getDataGssId(e);return this.getPartyCode(e)!==""&&(t+="-declared"),this.isOutline(n)&&(t+="-outline"),t},i.prototype.updateLabels=function(e){e>5||this.centroid.k<2?this.hideLabels():(this.showLabels(),this.resizeLabels())},i.prototype.resizeLabels=function(){this.main.selectAll("text").attr("font-size",(12/this.centroid.k).toFixed(2)+"px")},i.prototype.hideLabels=function(){this.main.attr("class",this.elements.hideLabelsClass)},i.prototype.showLabels=function(){this.main.attr("class","")},i.prototype.visibleLabels=function(){return!this.main.classed("election-map--hideLabels")},i.prototype.getVisibleArea=function(){var e=0,t=r(this.id)[0].getBoundingClientRect();r("path.election-map__area").each(function(){var n=this.getBoundingClientRect();n.left-t.left>0&&t.right-n.right>0&&t.bottom-n.bottom>0&&n.top-t.top>0&&(e+=1)}),this.updateLabels(e)},i.prototype.getAdjustedPosition=function(e){var t=this.getDataGssId(e),n={E08000014:{x:-1.2,y:0},E09000013:{x:0,y:0},E15000002:{x:-4,y:-12},E15000008:{x:0,y:4},N09000005:{x:2,y:1.5},N09000002:{x:.4,y:1.5},N09000010:{x:-3,y:2},N09000006:{x:-4,y:0},E07000195:{x:.5,y:0}};return n[t]||{x:0,y:0}},i.prototype.logStats=function(e){n.pubsub.emit("election:map:zoom",[e])},i}),define("module/components/elections/ni_council_list",["module/featureDetector","module/tabbed/tabbed","module/components/elections/indexTabs","module/components/elections/map/mapLoader"],function(e,t,n,r){return{handleSuccess:function(t,r){var i="N. Ireland",s="election-results-map--"+i.replace(". ","-").toLowerCase();e.can("SVG")&&(n.init(t.id,i,s),this.loadEnglandMap({id:s+"-map"}))},loadEnglandMap:function(e){var t={type:"northern-ireland-elections",data:!1,options:{initZoom:!1,scale:1e4,translate:[392,35],zoomBehavior:!0,keys:!1,scaleExtent:[1,4]}};r.init(e,t)}}}),define("module/components/hardNewsUnit",["module/bootstrap"],function(e){return{init:function(t){var n=e.$(t+" .faux-block-link");n.on("mouseover",".faux-block-link__overlay-link",function(e){e.delegateTarget.className+=" faux-block-link--hover"}),n.on("mouseout",".faux-block-link__overlay-link",function(e){e.delegateTarget.className=e.delegateTarget.className.replace(/ faux-block-link--hover/,"")})}}}),define("module/hyperpuff/minihyper",["module/bootstrap"],function(e){var t=4,n=['<aside class="pullout mini-hyper">','<div class="pullout-inner">','<h2 class="heading">{{title}}</h2>','<ul class="related-items">{{content}}</ul>',"</div>","</aside>"].join(""),r=function(e,t){return n.replace("{{title}}",e).replace("{{content}}",t)};return{init:function(){var n=e.$(".hyperpuff"),i=e.$(".hyper-title",n).text(),s=e.$(".group .unit",n),o=e.$(".story-body .introduction"),u=document.createElement("div"),a=s.length<4?s.length:t;if(n.length){for(var f=0;f<a;f++)u.appendChild(s[f].cloneNode(!0));o.length&&o.before(r(i,u.innerHTML))}}}}),define("module/components/hyper",["module/bootstrap","module/hyperpuff/minihyper"],function(e,t){return{handleSuccess:function(n,r){var i=e.$(n.selector);i.find(".placeholder-hyperpuff").html(r),i.removeClass("not-fetched").addClass("fetched"),t.init(),e.pubsub.emit("hyperpuff:complete")}}}),define("module/components/in_view_detector",["module/bootstrap"],function(e){var t=e.$;return{eventName:"module:in:view",modules:[],eventsSet:!1,window:t(window),register:function(n){var r=t("#"+n);if(!n||r.length===0)return;this.modules.push(r),this.addRegisteredClass(r),this.eventsSet||(e.pubsub.on(this.eventName,t.proxy(this.moduleInView,this)),this.window.on("scroll",t.proxy(this.checkModulesInView,this)),this.eventsSet=!0),this.window.on("load",t.proxy(function(){this.checkModuleInView(r)},this))},addRegisteredClass:function(e){e.addClass(e.attr("id")+"--in-view-registered")},moduleInView:function(e){this.removeModule(e),e=t(e),e.addClass(e.attr("id")+"--in-view")},removeModule:function(n){var r=[],i=this.modules.length;for(var s=0;s<i;s++)this.modules[s][0]!==n&&r.push(this.modules[s]);this.modules=r,this.modules.length===0&&(e.pubsub.off(this.eventName),this.window.off("scroll",t.proxy(this.checkModulesInView,this)),this.eventsSet=!1)},checkModulesInView:function(){var e=this,t=this.modules.length;for(var n=0;n<t;n++)e.checkModuleInView(this.modules[n])},checkModuleInView:function(t){this.isModuleInView(t)&&e.pubsub.emit(this.eventName,t)},isModuleInView:function(e){e=e[0];if(!e)return!1;var t=this.window.height(),n=e.getBoundingClientRect(),r=n.top>=0&&n.top<t,i=n.bottom>0&&n.bottom<=t,s=r||i;return s}}}),define("module/liveEvent/timeline",["config","module/bootstrap"],function(e,t){var n=function(t,n,r,i){i=i||{},this.poller=r,this.view=n,this.channel=t,this.sort=i.sort||"descending",this.active=typeof i.active=="undefined"?!0:!!i.active,this.host=i.pulsarPollingHost||"",this.path=i.pulsarPollingPath||"/"+e.service+"/walkietalkie/pulsar/"+t,this.requestInProgress=!1};return n.prototype={init:function(){var e=this;t.pubsub.on("timeline:more:click",function(){e.requestMoreEntries()}),this.setupPolling()},setupPolling:function(){this.sort==="descending"&&this.active&&(this.poller.startCacheBusting(),this.poller.setUrl(this.buildPulsarUrl(!0)),this.poller.startPolling({success:t.$.proxy(function(e){return t.pubsub.emit("timeline:new:dataReceived",[e]),this.buildPulsarUrl(!0)},this),error:function(e){t.pubsub.emit("timeline:new:dataError","dataError")}}))},requestMoreEntries:function(){var e=this;this.requestInProgress||(this.requestInProgress=!0,t.$.ajax({url:this.buildPulsarUrl(!1),dataType:"jsonp",jsonpCallback:"callback",success:function(n){e.requestInProgress=!1,t.pubsub.emit("timeline:more:dataReceived",[n])},error:function(n,r,i){e.requestInProgress=!1,t.pubsub.emit("timeline:more:dataError",[n,r,i])}}))},buildPulsarUrl:function(e){var t={sort:this.sort};return e?(t.entryId=this.view.getTopId(),t.top=!0):t.entryId=this.view.getBottomId(),this.host+this.buildUrl(this.path,t)},buildUrl:function(e,t){var n="";for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];if(!i)continue;n+=r+"="+i+"&"}return n.length>0&&(n=n.substring(0,n.length-1),e=e+"?"+n),e}},n}),define("module/liveEvent/timelineView",["module/bootstrap","translator"],function(e,t){function r(e){return"#"+e.replace(/(:|\.)/g,"\\$1")}var n=function(t){this.container=e.$(t),this.articleWrapper=this.$(".article-wrapper"),this.moreButton=this.$(".timeline-more a"),this.moreButtonText=this.$(".timeline-more a .cta"),this.windowTopAboveContainerFlag=this.isWindowTopAboveContainer(),this.init(),this.moreButton.append('<span class="spin"></span>')};return n.prototype={init:function(){var t=this;if(this.moreButton.length>0){this.buttonShowMore(),this.moreButton[0].setAttribute("href","#more-button"),this.moreButton[0].addEventListener("click",function(n){return n.preventDefault(),t.moreButton.removeClass("highlighted"),t.buttonLoading(),e.pubsub.emit("timeline:more:click"),!1},!1);var n=function(e,n){t.moreButton[0].addEventListener(e,function(){t.moreButton[n+"Class"]("highlighted")},!1)};n("touchstart","add"),n("touchmove","remove"),n("touchend","remove")}window.addEventListener("scroll",function(){t.hasScrolledAboveContainer()&&e.pubsub.emit("timeline:scroll:top")},!1),window.addEventListener("unload",function(){t.buttonShowMore()},!0),e.pubsub.on("timeline:more:dataReceived",function(e){t.buttonShowMore(),t.appendEntries(e),e.hasMore===!1&&t.buttonHide()}),e.pubsub.on("timeline:new:dataReceived",function(e){t.prependEntries(e),t.handleStickies(e)}),e.pubsub.on("timeline:scroll:top",function(){t.showHiddenEntries()}),e.pubsub.on("timeline:more:dataError",function(){t.buttonError()}),e.pubsub.on("timeline:temp:load",function(){t.buttonLoading()})},handleStickies:function(e){e&&e.stickies&&(this.addStickies(e.stickies),this.removeStickies(e.stickies))},addStickies:function(t){var n=this.$(".sticky-wrapper");for(var i in t)if(t.hasOwnProperty(i)){var s=t[i],o=r(i),u=o+"_stuck";this.$(u).length===0&&(s=s.replace(i,i+"_stuck"),n.prepend(s),this.$(u+" > div").addClass("deleted"));var a=this.$(o);a.length>0&&a.hide()}setTimeout(function(){e.$(".sticky-wrapper .deleted").removeClass("deleted")},500)},removeStickies:function(t){var n=this.$(".sticky-wrapper article");n.each(function(n,i){var s=i.id.replace("_stuck",""),o=s in t;o||(e.$(i).remove(),e.$(r(s)).show())})},updateButton:function(e,t){this.moreButton.removeClass("loading").removeClass("error"),this.moreButton.addClass(e),this.moreButtonText.html(t)},buttonShowMore:function(){this.updateButton("",t.get("showMore"))},buttonHide:function(){this.moreButton.hide()},buttonLoading:function(){this.updateButton("loading","Loading")},buttonError:function(){this.buttonShowMore()},getIds:function(){var e=this.$(".article-wrapper article");return e.length>0?e:[]},getTopId:function(){var e=this.getIds();if(e.length>0)return e[0].getAttribute("id")},getBottomId:function(){var e=this.getIds();return e?e[e.length-1].getAttribute("id"):null},appendEntries:function(e){e.text&&this.articleWrapper.append(e.text)},prependEntries:function(e){if(e&&e.text){this.articleWrapper.prepend('<div class="hidden">'+e.text+"</div>");if(this.windowTopAboveContainerFlag){var t=this;setTimeout(function(){t.showHiddenEntries()},500)}}},hasScrolledAboveContainer:function(){var e=this.isWindowTopAboveContainer();return this.windowTopAboveContainerFlag!==e?(this.windowTopAboveContainerFlag=e,e):!1},isWindowTopAboveContainer:function(){var e=this.container[0];if("getBoundingClientRect"in e)return e.getBoundingClientRect().top>0;var t=0;if(e.offsetParent)while(e.offsetParent!==null)e=e.offsetParent,t+=e.offsetTop;else t=e.offsetTop;return t>window.pageYOffset},showHiddenEntries:function(){this.$(".hidden").removeClass("hidden")},$:function(t){return e.$(t,this.container)}},n}),define("module/poller",["module/bootstrap"],function(e){function n(e){var t="cachebuster="+Math.floor((new Date).getTime()/1e3);return e.indexOf("?")>0?e+"&"+t:e+"?"+t}function r(e){var t=!1;return"clientdirective"in e&&"pollPeriod"in e.clientdirective&&(t=e.clientdirective.pollPeriod),"pollPeriod"in e&&(t=e.pollPeriod),t}var t=function(e,t){if(Object.prototype.toString.call(e)!=="[object Number]")throw new Error("Update frequency must be a number");this.updateFrequency=e,this.polling=!1,this.timeout=t||1e4,this.cacheBusting=!1};return t.prototype={setUrl:function(e){this.url=e},buildUrl:function(){return this.cacheBusting?n(this.url):this.url},setPollingTime:function(e){this.updateFrequency=e},startPolling:function(e){this.polling=!0,this.options=e||{},this.poll()},stopPolling:function(){this.polling=!1},poll:function(){if(this.polling){var t=this;e.$.ajax({url:t.buildUrl(),dataType:"jsonp",timeout:this.timeout,jsonpCallback:"callback",method:"get",success:function(e){var n=r(e);n?(t.updateFrequency=n,t.rePoll()):t.stopPolling();if(t.options.success){var i=t.options.success(e);t.url=i||t.url}},error:function(e){t.options.error&&t.options.error(e),t.rePoll()}})}},rePoll:function(){var e=this;window.setTimeout(function(){e.poll()},e.updateFrequency)},stopCacheBusting:function(){this.cacheBusting=!1},startCacheBusting:function(){this.cacheBusting=!0}},t}),define("module/transclude",["module/bootstrap"],function(e){var t=function(){};return t.prototype.get=function(t,n){function i(e,t,r){n[e]&&n[e](t,r)}function s(){r.shift(),r.length===0&&i("complete")}function o(e){var t=e.getAttribute("data-fetch-url");return t||e.href}function u(e){e+="?";for(var t in n.urlParameters)e+=t+"="+n.urlParameters[t]+"&";return e.slice(0,-1)}n=n||{};var r=[];(function(a){e.$(t).each(function(t,a){a=typeof a!="number"?a:t;if(!a.href){i("error","Error: No href attribute on  elm "+t,t);return}r.push(t);var f=o(a),l=e.$(n.target||a),c=n.maintainLink||!1;n.requestUrl&&(f=n.requestUrl),n.urlParameters&&(f=u(f)),e.$.ajax({url:f,dataType:"html",success:function(e){c||a.setAttribute("href","#"+(a.id||"transcluded"+(new Date).getTime()));if(n.insert)l.html(e);else if(l[0]){var r=l[0].id?'id="'+l[0].id+'"':"";l.replaceWith("<div "+r+">"+e+"</div>")}s(),i("success",e,t)},error:function(e){s(),i("error","Error: 404",t)}})})})(this)},t}),define("module/history/native",["module/bootstrap"],function(e){var t=function(t,n){this.EmittedFromHistory=!1;var r=this,i=function(t){e.pubsub.on(t,function(){r.EmittedFromHistory?r.EmittedFromHistory=!1:window.history.pushState({isNewsMobile:!0,eventName:t,eventData:Array.prototype.slice.call(arguments)},"")})};for(var s=0,o=t.length;s<o;s++)i(t[s]);window.addEventListener("popstate",function(t){t.state&&"isNewsMobile"in t.state&&(r.EmittedFromHistory=!0,e.pubsub.emit(t.state.eventName,t.state.eventData))},!1),typeof n!="undefined"&&window.history.replaceState({isNewsMobile:!0,eventName:n.eventName,eventData:n.data},"")};return t}),define("module/history/hashed",["module/bootstrap"],function(e){var t=function(t,n,r){var i=this;this.sessionStorage=r||window.sessionStorage,this.EmittedFromHistory=null,this.queue=[],this.historyPos=0,e.pubsub.on("history:hashchange",function(e){i.manageHashChange(e)}),window.addEventListener("hashchange",function(t){typeof t.newURL=="undefined"&&(t.newURL=window.location.href),e.pubsub.emit("history:hashchange",[t.newURL.split("#")[1]])},!0),window.addEventListener("unload",function(){i.sessionStorage.setItem("news:history:save:"+window.location.pathname,JSON.stringify(i.queue))},!0),this.initState(n),this.addPubSubListeners(t)};return t.prototype.addPubSubListeners=function(t){var n=this,r=function(t){e.pubsub.on(t,function(){n.EmittedFromHistory===t?n.EmittedFromHistory=null:(window.location.href=window.location.pathname+"#"+n.incrementHistoryPos(),n.queue[n.historyPos]={isNewsMobile:!0,eventName:t,eventData:Array.prototype.slice.call(arguments)})})};for(var i=0,s=t.length;i<s;i++)r(t[i])},t.prototype.incrementHistoryPos=function(){return this.historyPos++,this.historyPos},t.prototype.initState=function(t){var n=this.sessionStorage.getItem("news:history:save:"+window.location.pathname);n&&typeof window.location.hash!="undefined"?(this.queue=JSON.parse(n),this.historyPos=window.location.hash.split("#")[1],e.pubsub.emit("history:hashchange",[this.historyPos])):typeof t!="undefined"&&(window.location.href=window.location.pathname+"#"+this.historyPos,this.queue[this.historyPos]={isNewsMobile:!0,eventName:t.eventName,eventData:t.data})},t.prototype.manageHashChange=function(t){var n=this.queue[t];typeof n!="undefined"&&(this.EmittedFromHistory=n.eventName,e.pubsub.emit(n.eventName,n.eventData))},t}),define("module/history/history",["require","module/history/native","module/history/hashed"],function(e){return typeof window.history=="object"&&typeof window.history.pushState!="undefined"?e("./native"):e("./hashed")}),define("module/liveEvent/liveMediaPlayerView",["module/bootstrap","module/featureDetector"],function(e,t){var n=e.$,r={live:"Live",watch:"Watch"},i={item:150,itemSpacing:2},s={carousel:"media-nav--carousel",item:"media-nav__item",highlight:"media-nav__item--highlight",live:"media-nav__item--live",ondemand:"media-nav__item--ondemand"},o={container:'<div class="media-nav"></div>',items:'<ol class="media-nav__items"></ol>',item:'<li class="media-nav__item {{itemClass}}"><b>{{label}}:</b> {{headline}}</li>'},u={init:function(e,t){return this.container=n(e),this.mediaItems=t,this.mediaNav=this.createNav(),this.mediaNavContainer=this.mediaNav.find(".media-nav__items"),this.mediaNavItems=this.mediaNavContainer.find(".media-nav__item"),this.supportsCarousel()&&(this.mediaNav.addClass(s.carousel),this.setMediaNavWidth()),this.container.after(this.mediaNav),this.bindEvents(),this},createNav:function(){var e=n(o.items);return n.each(this.mediaItems,n.proxy(function(t,n){e.append(this.createNavItem(t,n))},this)),n(o.container).append(e)},createNavItem:function(e,t){var i=t.video.live,u=i?r.live:r.watch,a=i?s.live:s.ondemand,f=o.item.replace("{{itemClass}}",a).replace("{{label}}",u).replace("{{headline}}",t.headline);return n(f)},supportsCarousel:function(){return t.is("AndroidMobile2")?!1:!0},setMediaNavWidth:function(){var e=this.mediaItems.length*i.item,t=(this.mediaItems.length-1)*i.itemSpacing,n=e+t;this.mediaNavContainer.css("width",n)},bindEvents:function(){this.mediaNavContainer.on("click","li",n.proxy(function(t){var r=n(t.currentTarget),i=this.mediaNavItems.index(r);r.hasClass(s.highlight)||(e.pubsub.emit("medianav:select",[this.mediaItems[i],i]),this.highlightItem(i))},this))},highlightItem:function(e){this.mediaNavItems.removeClass(s.highlight).eq(e).addClass(s.highlight)}};return u}),define("module/liveEvent/liveMediaPlayer",["module/bootstrap","module/media/mediaLoader","module/featureDetector","module/liveEvent/liveMediaPlayerView"],function(e,t,n,r){function o(e){var t=["journalism_uk_news_stream_04"];for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}function u(e){return i.grep(e,function(e){if(e.video){if(o(e.video.externalId))return!1;if(n.can("PlayHls")||n.can("PlayBump"))return!0;if(n.can("PlayH264"))return e.video.live===!1}})}function a(e,n){if(n){i(e).empty();var r=new t(e,n.video,{width:"100%",height:"0%",forceErrorMessages:!1,mediaId:n.video.externalId})}}var i=e.$,s={ITEMS_NOT_ARRAY:"init expects an array as it's first parameter"};return{init:function(e,t){if(!e||!t)return;if(!document.querySelector(e))return;if(!i.isArray(t))throw TypeError(s.ITEMS_NOT_ARRAY);this.selector=e,this.mediaItems=u(t),this.createView(),this.bindEvents(),this.loadMediaItem(0)},createView:function(){this.view=r.init(this.selector,this.mediaItems)},bindEvents:function(){e.pubsub.on("medianav:select",i.proxy(function(e,t){a(this.selector,e)},this))},loadMediaItem:function(e){a(this.selector,this.mediaItems[e]),this.view.highlightItem(e)}}}),define("module/live-event",["config","module/bootstrap","module/liveEvent/timeline","module/liveEvent/timelineView","module/poller","module/tabbed/tabbed","module/transclude","module/ajaxForm/ajaxForm","module/ajaxForm/ajaxFormView","module/history/history","module/liveEvent/liveMediaPlayer"],function(e,t,n,r,i,s,o,u,a,f,l){return{init:function(e,c){(function(){var e=["Webkit","Moz"],n=[];for(var r in e)n.push(document.body.style[e[r]+"AnimationName"]);t.$("html").addClass(n.indexOf("")>-1?"css-anim":"animated-gif")})(),l.init("#media-wrapper",c);var h=t.$,p=h("#live-tabs li"),d=h("#live-panels .panel"),v=h(".tab-2 a")[0],m=h(".tab-3 a")[0],g=v?d.splice(0,2,d[1],d[0]):null,y=p[0]?new s(p,d):null,b=new o,w=new n(e.channelId,new r("#live-timeline"),new i(e.pollPeriod),{sort:e.channelOrder,active:e.isLive,pulsarPollingHost:e.pollingHost}),E=new f(["tabs:activate"],{eventName:"tabs:activate",data:[0]});w.init(),m&&(m.href+="?transcluded=true",b.get(m,{target:"#contribute-placeholder",success:function(){var e=new u,t=new a("#join-discussion");window.location.hash==="#contribute"&&h(m).trigger("click")}}))}}}),define("module/components/liveEventPage",["module/bootstrap","module/live-event"],function(e,t){return{handleSuccess:function(n){t.init({channelId:n.opts.channelId,channelOrder:n.opts.channelOrder,pollingHost:n.opts.pollingHost,pollPeriod:n.opts.pollPeriod,isLive:n.opts.isLive},e.$(n.selector).data("media-player-items"))}}}),define("module/components/liveEventPromo",["config","module/bootstrap","module/poller","module/timestamp"],function(e,t,n,r){return{pollingUrl:function(e,t,n){return typeof t=="undefined"&&(t={service:"nfp"}),e+"/"+t.service+"/walkietalkie/latest_index_asset/"+n},handleSuccess:function(){e.features.liveeventcomponent&&this.init(e.pollingHost,null)},init:function(i,s){var o=t.$,u=this;o("[data-channel]").each(function(){var t=o(".live-event-index__container",this),a=o(".live-event-index__summary",t),f=o(".live-event-index__entries",t),l=o(this).attr("data-channel"),c=new n(3e4),h="",p=u.pollingUrl(i,e,l);c.startCacheBusting(),c.setUrl(p),c.startPolling({success:function(e){o.trim(f.html())||a.remove();if(e.entryId!==h){var t=null;if(e.createTime){var n=e.createTime.split(/[\-T:]/g),i=new Date(n[0],n[1]-1,n[2]);i.setHours(n[3],n[4],n[5]);var u=((new Date).getTime()-i.getTime())/1e3,l=new r(null),c=l.timeAgoInWords(u);c&&(t='<span class="date--v2">'+c+"</span>")}if(t){var d=e.html.indexOf(">")+1,v=e.html.substring(0,d),m=e.html.substring(d);e.html=v+t+m}return s?s(f,e.html):(f.css("opacity","0"),setTimeout(function(){f.html(e.html).css("opacity","1")},1200)),h=e.entryId,p}},error:function(){o.trim(f.html())||(f.css("display","none"),a.css("visibility","visible"),c.stopPolling())}})})}}}),define("module/request",["module/bootstrap"],function(e){var t=e.$,n=function(e){this.options=this.setOptions(e),this.url=this.options.url,this.options.getUpdatesOnInit&&this.getUpdates()};return n.prototype={setOptions:function(e){return t.extend({url:undefined,getUpdatesOnInit:!1,success:t.noop,error:t.noop,pending:t.noop,complete:t.noop},e)},getUpdates:function(){if(!this.url)throw new Error("url is not set");var e=t.ajax({url:this.url,dataType:"jsonp",jsonpCallback:"callback"});e.state()==="pending"&&this.options.pending(),e.done(t.proxy(function(e){this.options.success(e)},this)).fail(t.proxy(function(e){this.options.error(e)},this)).always(t.proxy(function(){this.options.complete()},this))},setUrl:function(e){this.url=e},getUrl:function(){return this.url}},n}),define("module/components/localLive",["module/bootstrap","module/request","module/featureDetector"],function(e,t,n){var r=e.$,i={COMPONENT:"#comp-local-live",BUTTON:".local-live__progress-button",STICKY_WRAPPER:".sticky-wrapper",ARTICLE_WRAPPER:".article-wrapper",TOGGLE:".toggle"};return{handleSuccess:function(e){var s,o;this.localLive=r(e),this.stickyWrapper=this.localLive.find(i.STICKY_WRAPPER),this.articleWrapper=this.localLive.find(i.ARTICLE_WRAPPER),this.toggledElems=this.localLive.find(i.TOGGLE),this.canTransition=n.can("CssTransition"),this.button=r(i.BUTTON),this.localLive.data("live-event-channel")&&this.localLive.data("live-event-channel")!==""?o=this.localLive.data("live-event-channel"):o=null,this.localLive.data("polling-host")&&this.localLive.data("polling-host")!==""&&(s=this.localLive.data("polling-host"));if(!s||!o)return;this.request=new t({getUpdatesOnInit:!0,url:this.constructPulsarUrl(s,o),success:r.proxy(this.handleRefreshSuccess,this),pending:r.proxy(this.handleRefreshPending,this),complete:r.proxy(this.handleRefreshComplete,this)}),this.bindEvents()},constructPulsarUrl:function(e,t){return e+"/news/walkietalkie/pulsar/"+t+"?sort=descending&limit=3&show=all"},handleRefreshSuccess:function(e){this.transition(r.proxy(function(){this.insertStickies(e.stickies),this.insertArticles(e.text)},this))},handleRefreshPending:function(){this.button.addClass("spinner")},handleRefreshComplete:function(){this.button.removeClass("spinner")},transition:function(e){this.canTransition?(this.toggledElems.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",r.proxy(function(){e(),this.showUpdates()},this)),this.hideUpdates()):e()},insertStickies:function(e){var t="",n;for(n in e)e.hasOwnProperty(n)&&(t+=e[n]);this.stickyWrapper.html(t)},insertArticles:function(e){this.articleWrapper.html(e)},hideUpdates:function(){this.toggledElems.addClass("refreshing")},showUpdates:function(){this.toggledElems.removeClass("refreshing")},bindEvents:function(){this.button.on("click",r.proxy(function(e){this.request.getUpdates()},this))}}}),define("module/components/moreFromThisIndex",["module/bootstrap","module/timestamp","module/imageenhancer"],function(e,t,n){return{handleSuccess:function(r,i){var s=e.$(r.selector),o;s.find(".small-promo-group__body").html(i),o=new t((new Date((new Date).toUTCString())).getTime()),o.insertTime(),new n}}}),define("module/components/mostPopular",["module/bootstrap","module/tabbed/tabbed"],function(e,t){return{handleSuccess:function(t,n){t=t||{},this.selector=t.selector,this.element=e.$(this.selector);if(!this.element.length)return;n&&this.element.replaceWith(n),e.$(this.selector).find(".most-popular__header__tabs").length&&this.loadTabs()},loadTabs:function(){var n=new t(e.$(".most-popular__header__tabs li"),e.$(".most-popular__list-container"),!0,"most-popular")}}}),define("module/stream/endpoint",["module/request"],function(e){return function(t,n,r){var i=function(e,t){n.trigger(r+e,t)},s=!1,o=new e({url:t,success:function(e){s=!1,e.updates&&i(":updates",e.updates),e.endpoints&&i(":endpoints",e.endpoints),e.endpoints&&e.endpoints[r]?o.setUrl(e.endpoints[r]):i(":noupdates")},error:function(e){s=!1,i(":error",e)},pending:function(){i(":requesting")}});return{request:function(){s||(o.getUpdates(),s=!0)},setUrl:function(e){o.setUrl(e)}}}}),define("module/stream/core",["module/bootstrap","module/stream/endpoint"],function(e,t){return function(n){var r=e.$({}),i=new t(n.latest,r,"latest"),s=new t(n.earlier,r,"earlier");return r.on("latest:request",function(){i.request()}),r.on("earlier:request",function(){s.request()}),r.on("latest:endpoints",function(e,t){s.setUrl(t.earlier)}),{emit:function(e){r.trigger(e)},on:function(e,t){r.on(e,function(){return t.apply(this,Array.prototype.slice.call(arguments,1))})}}}}),define("module/stream/view",["module/bootstrap","translator","module/featureDetector"],function(e,t,n){var r=e.$,i={refresh:'<p class="comp-stream__error comp-stream__error--refresh">{{message}}</p>',showMore:'<p class="comp-stream__error comp-stream__error--show-more">{{message}}</p>'},s=function(e,t){return r.contains(e[0],t[0])},o=n.which("TransitionEnd"),u=function(e,t){n.can("CssTransition")?(e.on(o,function(){e.off(o),t(),e.removeClass("refreshing")}),e.addClass("refreshing")):t()};return function(e,n){var o=r({}),a=r(i.refresh.replace("{{message}}",t.get("streamRefreshError"))),f=r(i.showMore.replace("{{message}}",t.get("streamShowMoreError")));return e.on("latest:updates",function(e){u(n,function(){n.html(e),o.trigger("updates:inserted")}),s(n,a)&&a.remove()}),e.on("earlier:updates",function(e){n.append(e),o.trigger("updates:inserted"),s(n,f)&&f.remove()}),e.on("latest:error",function(e){s(n,a)||n.prepend(a)}),e.on("earlier:error",function(e){s(n,f)||n.append(f)}),{on:function(e,t){o.on(e,function(){return t.apply(this,Array.prototype.slice.call(arguments,1))})}}}}),define("module/stream/refresh_button",["module/bootstrap","translator"],function(e,t){var n=e.$,r=['<button class="comp-stream__button--refresh">','<span class="off-screen">{{label}}</span>','<span class="comp-stream__button--refresh-icon"></span>',"</button>"].join(""),i={normal:t.get("streamRefreshButton")},s={loading:"spinner"};return function(){var e=n(r.replace("{{label}}",i.normal)),t=n({});return e.on("click",function(e){t.trigger("click")}),{appendTo:function(t){e.appendTo(t)},remove:function(){e.detach()},on:function(e,n){t.on(e,n)},setNormal:function(){e.removeClass(s.loading)},setLoading:function(){e.addClass(s.loading)}}}}),define("module/stream/show_more_button",["module/bootstrap","translator"],function(e,t){var n=e.$,r=['<button class="show-more">','<span class="show-more__inner">','<span class="show-more__label">{{label}}</span>','<span class="show-more__spinner"></span>',"</span>","</button>"].join(""),i={normal:t.get("streamShowMoreButton"),loading:t.get("loading")},s={loading:"show-more--loading"};return function(){var e=n(r.replace("{{label}}",i.normal)),t=e.find(".show-more__label"),o=n({});return e.on("click",function(e){o.trigger("click")}),{appendTo:function(t){e.appendTo(t)},remove:function(){e.detach()},on:function(e,t){o.on(e,t)},setNormal:function(){t.text(i.normal),e.removeClass(s.loading)},setLoading:function(){t.text(i.loading),e.addClass(s.loading)}}}}),define("module/components/nexus/connectedStream",["module/stream/core","module/stream/view","module/stream/refresh_button","module/stream/show_more_button","module/bootstrap","module/featureDetector","module/media/mediaHandler","module/imageenhancer"],function(e,t,n,r,i,s,o,u){function h(e){return{latest:e.opts.endpoints.latest,earlier:e.opts.endpoints.earlier}}var a=i.$,f={init:function(e){return e.on("updates:inserted",a.proxy(this.run,this)),this},run:function(){this.publishTrackEvents(),this.createStatsData()},publishTrackEvents:function(){i.pubsub.emit("component:loaded",["connected-stream-internal"]),i.pubsub.emit("component:loaded",["connected-stream-external"])},createStatsData:function(){var e=a("#comp-connected-stream .update"),t=[".update__image",".update__headline",".update__body"];e.each(function(n,r){a(r).find("a").each(function(r,s){var o=a.grep(t,function(e){return a(s).closest(e).length>0}),u={update_index:n+1,update_total:e.length,update_type:a(s).closest(".update").attr("class"),update_position:o[0]};s.linktrack=i.$.param(u)})})}},l={init:function(e){return e.on("updates:inserted",a.proxy(this.run,this)),this.mediaHandler=new o,this},run:function(){this.mediaHandler.createMedia()}},c={init:function(e){return e.on("updates:inserted",a.proxy(this.run,this)),this},run:function(){new u(".update__body img",".update__image img")}};return{handleSuccess:function(o){var u=a(o.selector),p=s.can("CssTransition"),d=new e(h(o)),v=new t(d,u.find(".updates")),m=new n,g=new r;m.on("click",function(){d.emit("latest:request"),i.pubsub.emit("stream:refresh")}),d.on("latest:requesting",function(){m.setLoading()}),d.on("latest:updates",function(){m.setNormal()}),d.on("latest:error",function(){m.setNormal()}),m.appendTo(u.find(".comp-stream__header")),h(o).earlier&&(g.on("click",function(){d.emit("earlier:request"),i.pubsub.emit("stream:showmore")}),d.on("earlier:requesting",function(){g.setLoading()}),d.on("earlier:updates",function(){g.setNormal()}),d.on("earlier:noupdates",function(){g.remove()}),d.on("earlier:error",function(){g.setNormal()}),g.appendTo(u)),d.on("latest:endpoints",function(e){e.earlier&&g.appendTo(u)}),a("body").addClass(p?"css-anim":"animated-gif"),c.init(v).run(),l.init(v).run(),f.init(v).run()}}}),define("module/components/nexus/templates",{refresh:{button:'<button class="comp-stream__button--refresh"><span class="off-screen">{{label}}</span><span class="comp-stream__button--refresh-icon"></span></button>',error:'<p class="comp-stream__error comp-stream__error--refresh">{{message}}</p>'},show_more:{button:'<button class="show-more"><span class="show-more__inner"><span class="show-more__label">{{label}}</span><span class="show-more__spinner"></span></span></button>',error:'<p class="comp-stream__error comp-stream__error--show-more">{{message}}</p>'}}),define("module/components/remotePortlet",["module/bootstrap","module/components/handler"],function(e,t){return{runDependent:function(e){e.opts.js==="on"&&require(["module/components/"+e.opts.id],function(t){t.init(e)})},handleSuccess:function(e,n){n!==undefined&&t.handleSuccess(e,n),this.runDependent(e)}}}),define("module/components/scotland_decides/banner/config",[],function(){return{isPaused:!1,banner:{selector:"#election-live-banner",itemTimeout:5e3,currentItemIndex:-1,content1Selector:"#election-live-banner-content-1",content2Selector:"#election-live-banner-content-2",slotClass:"election-live-banner-slot",itemClass:"election-live-banner-slot__item",nextClass:"election-live-banner-slot__item--next",hideClass:"election-live-banner-slot__item--hide",currentClass:"election-live-banner-slot__item--current"},playPause:{playClass:"election-live-banner--play",pauseSelector:"#election-live-banner-pause",pauseClass:"election-live-banner-pause",pausePlayClass:"election-live-banner-pause--play",pauseText:"Pause Ticker",playText:"Play Ticker"},refresh:{selector:"#election-live-banner-refresh",progressSelector:".election-live-banner-refresh__progress",progressSpinClass:"election-live-banner-refresh__progress--spin"}}}),define("module/components/scotland_decides/banner/banner",["module/bootstrap","module/components/scotland_decides/banner/config"],function(e,t){var n=!1,r=e.$;return{defaultData:{headlines:[{type:"text",header:"Scotland Decides",text:"The Scottish independence referendum takes place on 18 September"},{type:"text",header:"Scotland Decides",text:'Voters will be asked: "Should Scotland be an independent country?"'},{type:"text",header:"Scotland Decides",text:"The result of the vote should be known in the early hours on 19 September"}]},data:this.defaultData,currentRenderer:null,setDefaultData:function(){this.data=this.defaultData},start:function(){var e="data_components/scot_ref_national_banner";require.specified(e)?require([e],r.proxy(function(e){this.data=e,this.nextItem()},this)):this.nextItem()},bindEvents:function(){r(t.banner.content1Selector+","+t.banner.content2Selector).on("transitionend webkitTransitionEnd oTransitionEnd",r.proxy(this.transitionEnd,this))},show:function(){r(t.banner.selector).show()},setTimeout:function(){if(n)return;n=setTimeout(r.proxy(this.nextItem,this),t.banner.itemTimeout)},clearTimeout:function(){clearTimeout(n),n=null},setData:function(e){this.data=e},getData:function(){return this.data},restart:function(){t.banner.currentItemIndex=-1,this.nextItem()},nextItem:function(){this.clearTimeout(),(!this.data||!this.data.headlines||this.data.headlines.length===0)&&this.setDefaultData();var e=this.data.headlines,n;t.banner.currentItemIndex++,t.banner.currentItemIndex===e.length&&(t.banner.currentItemIndex=0),n=e[t.banner.currentItemIndex]||{},require(["module/components/scotland_decides/banner/"+n.type],r.proxy(function(e){var t=e.createHtml(n);this.render(t),this.currentRenderer=e,this.currentRenderer.start()},this))},render:function(e){var n=r(t.banner.content1Selector),i=r(t.banner.content2Selector);i.hasClass("fadeout")?(n.addClass("fadeout"),i.html(e),i.removeClass("fadeout")):(i.addClass("fadeout"),n.html(e),n.removeClass("fadeout"))},transitionEnd:function(e){if(!e)return;var t=r(e.target);t.hasClass("fadeout")&&t.html("")}}}),define("module/components/scotland_decides/banner/stat",["module/bootstrap"],function(e){return{track:function(t){e.pubsub.emit("banner:ticker:toggle",[t])}}}),define("module/components/scotland_decides/banner/pause_play_button",["module/bootstrap","module/components/scotland_decides/banner/config","module/components/scotland_decides/banner/stat","module/components/scotland_decides/banner/banner"],function(e,t,n,r){return $=e.$,{bindEvents:function(){$(t.playPause.pauseSelector).on("click",$.proxy(this.pressed,this))},pressed:function(e){if(!e)return;var r=$(e.target);r.hasClass(t.playPause.pausePlayClass)?(r.removeClass(t.playPause.pausePlayClass),this.play(),n.track("play")):(r.addClass(t.playPause.pausePlayClass),this.pause(),n.track("pause"))},play:function(){t.isPaused=!1,$(t.banner.selector).addClass(t.playPause.playClass),$(t.playPause.pauseSelector).attr("title",t.playPause.pauseText),$(t.playPause.pauseSelector).find("span").html(t.playPause.pauseText),r.currentRenderer&&r.currentRenderer.start()},pause:function(){t.isPaused=!0,$(t.banner.selector).removeClass(t.playPause.playClass),$(t.playPause.pauseSelector).attr("title",t.playPause.playText),$(t.playPause.pauseSelector).find("span").html(t.playPause.playText),r.currentRenderer&&r.currentRenderer.stop()}}}),define("module/components/scotland_decides/banner/refresh_button",["module/bootstrap","module/components/scotland_decides/banner/config","module/components/scotland_decides/banner/stat","module/components/scotland_decides/banner/banner"],function(e,t,n,r){return $=e.$,{bindEvents:function(){$(t.refresh.selector).on("click",$.proxy(this.pressed,this))},pressed:function(e){if(!e)return;n.track("refresh"),r.clearTimeout(),this.addSpinner(),this.loadData()},loadData:function(){$.ajax({url:"/news/components?batch[remote-portlet][opts][id]=election_data/scot_ref_national_banner",dataType:"json",success:$.proxy(this.dataLoaded,this),error:$.proxy(this.reset,this)})},dataLoaded:function(e){var t,n;try{t=e["remote-portlet"].match(/{.*}/)[0],n=JSON.parse(t),r.setData(n)}catch(i){}this.reset()},reset:function(){this.removeSpinner(),r.restart()},addSpinner:function(){$(t.refresh.progressSelector).addClass(t.refresh.progressSpinClass)},removeSpinner:function(){$(t.refresh.progressSelector).removeClass(t.refresh.progressSpinClass)},dataFailed:function(){this.removeSpinner(),r.restart()}}}),define("module/components/scotland_decides/banner/scot_ref_data",["module/bootstrap","module/components/scotland_decides/banner/config","module/components/scotland_decides/banner/banner","module/featureDetector"],function(e,t,n,r){$=e.$;var i="animationend webkitAnimationEnd oAnimationEnd";return{createHtml:function(e){var t='<div class="election-live-banner__title election-live-banner__title--scotref">'+e.header+"</div>";return $.each(e.slots,function(e,n){t+='<div class="election-live-banner__scene election-live-banner__scene--scotref election-live-banner__scene--'+n[0].name.toLowerCase()+'">',t+='<ol class="election-live-banner-slot',r.can("CssPreserve3d")&&(t+=" election-live-banner-slot--rotate election-live-banner-slot--rotate-scotref"),t+=" election-live-banner-slot--"+(e+1)+'">',t+="<li ",t+='class="election-live-banner-slot__item election-live-banner-slot__item--scotref ',t+="election-live-banner-slot__item--current election-live-banner-slot__item--current-scotref",t+='"><b>'+n[0].name+"</b> "+n[0].value+"</li>",n[1]&&(t+="<li ",t+='class="election-live-banner-slot__item election-live-banner-slot__item--scotref ',t+="election-live-banner-slot__item--next election-live-banner-slot__item--next-scotref",t+='"><b>'+n[1].name+"</b> "+n[1].value+"</li>",t+="</ol></div>")}),t},start:function(){this.bindSlotEvents()},stop:function(){this.unBindSlotEvents(),n.clearTimeout()},bindSlotEvents:function(){$("."+t.banner.slotClass).on(i,this.animEnd)},unBindSlotEvents:function(){$("."+t.banner.slotClass).off(i,this.animEnd)},animEnd:function(e){n.setTimeout()}}}),define("module/components/scotland_decides/banner/text",["module/bootstrap","module/components/scotland_decides/banner/config","module/components/scotland_decides/banner/banner"],function(e,t,n){return $=e.$,{createHtml:function(e){var t=e.text.replace(/&gt;/g,">").replace(/&lt;/g,"<"),n='<div class="election-live-banner__title election-live-banner__title--scotref">'+e.header+"</div>";return n+='<div class="election-live-banner__text election-live-banner__text--scotref">'+t+"</div>",n},start:function(){t.isPaused||n.setTimeout()},stop:function(){n.clearTimeout()}}}),define("module/components/scotland_decides/banner_init",["module/bootstrap","module/featureDetector","module/components/scotland_decides/banner/pause_play_button","module/components/scotland_decides/banner/refresh_button","module/components/scotland_decides/banner/banner"],function(e,t,n,r,i){var s=e.$;return{handleSuccess:function(e,n){if(!t.can("CssTransition"))return;this.init()},init:function(){i.show(),n.bindEvents(),r.bindEvents(),i.bindEvents(),i.start(),n.play()}}}),define("module/components/scotland_decides/dropdown",["module/bootstrap"],function(e){var t=e.$,n,r,i,s,o,u,a,f,l,c,h;return{handleSuccess:function(e){this.component=e,this.setModule(),this.displayDropdown(),this.setupVars(),this.removeHeaderLink(),this.resetDropdown()},setModule:function(){n=t("#"+this.component.id)},setupVars:function(){r="#"+n.data("list"),i="#"+n.data("header"),f=n.data("button"),l=t("#"+f).text(),c=t("#"+f).data("close"),s="."+n.data("item"),o=n.data("item-selected"),u="."+o,a=n.data("open"),h=t("#page")},removeHeaderLink:function(){var e=t(i);e.html(e.find("a").html())},bindButtonEvent:function(){t("#"+f).one("click",t.proxy(this.toggleList,this))},bindHtmlEvent:function(){t("html").one("click",t.proxy(this.resetDropdown,this))},resetDropdown:function(){this.bindButtonEvent(),this.removeListOpenClass(),this.removeMinPageHeight(),this.hideNonSelectedItems(),this.changeButtonText(l)},hideNonSelectedItems:function(){t(r+" "+s+":not("+u+")").hide()},showAllItems:function(){t(r+" "+s).show()},changeButtonText:function(e){t("#"+f).find("span").html(e)},removeListOpenClass:function(){t(r).removeClass(a)},addListOpenClass:function(){t(r).addClass(a)},toggleList:function(){this.showAllItems(),this.addListOpenClass(),this.addMinPageHeight(),this.changeButtonText(c),setTimeout(t.proxy(this.bindHtmlEvent,this),0)},addMinPageHeight:function(){h.css("min-height",2050)},removeMinPageHeight:function(){h.css("min-height",0)},displayDropdown:function(){var e=n.find("script");n.append(e.html()),e.remove()}}}),define("module/components/scotland_decides/index",["module/bootstrap","module/timestamp","module/imageenhancer","module/transclude","module/media/mediaHandler","config"],function(e,t,n,r,i,s){return{init:function(){new t((new Date((new Date).toUTCString())).getTime()),new n(".story-body img"),new n(".features-and-analysis img"),new r;if(s.features.video){var e=new i({audio:!1});e.createMedia()}}}}),define("module/components/scotland_decides/map/loader",["module/bootstrap","module/featureDetector","deviceInspector"],function(e,t,n){return{handleSuccess:function(n,r){t.can("SVG")?(this.init({id:"scot-ref-map__container"}),e.pubsub.on("scotref:map:fullscreen",e.$.proxy(this.init,this))):e.$("#scot-ref-map__container").addClass("scot-ref-map__container--no-svg")},init:function(e,t){var n={type:"scotland-elections",options:{initZoom:!1,keys:!1,scaleExtent:[1,16],fullscreen:t?t.fullscreen:!1}};this.setup(e,n)},setup:function(e,t){var n="#"+e.id,r=this.getSize(t);t.size=r,this.dataComponent="data_components/scot_ref_summary_data",require.specified(this.dataComponent)&&this.load(n,t,r)},getSize:function(e){var t={group1:"xs",group2:"s",group3:"m",group4:"l"},r=t[n.getGroup()]||"xs";return e.options.fullscreen&&(r="s"),r},load:function(e,t,n){require(["data/maps/"+n+"/"+t.type,"module/components/scotland_decides/map/map_view",this.dataComponent],function(n,r,i){var s;t.shape=n,t.data=i.council_summary||{},s=new r(e,t),s.init()})}}}),define("module/components/scotland_decides/map/map_helper",["vendor/d3/d3","vendor/topojson/topojson","module/bootstrap"],function(e,t,n){var r=n.$,i=function(e,t,n,r,i){this.main=e,this.width=t,this.height=n,this.type=r.type,this.shape=r.shape,this.data=r.data,this.elements=i};return i.prototype.setPath=function(){var n=this.width,r=this.height,i=t.feature(this.shape,this.shape.objects[this.type]),s=e.geo.centroid(i),o=1,u=[n/2,r/2],a,f,l,c=e.geo.mercator().scale(1).center(e.geo.centroid(i)).translate([n/2,r/2-20]),h=e.geo.path().projection(c);return a=h.bounds(i),f=o*n/(a[1][0]-a[0][0]),l=o*r/(a[1][1]-a[0][1]),o=f<l?f:l,u=[n-(a[0][0]+a[1][0])/2,r-(a[0][1]+a[1][1])/2],c=e.geo.mercator().center(s).scale(o).translate(u),this.path=h.projection(c),this.path},i.prototype.loadShape=function(){this.boundaries=t.feature(this.shape,this.shape.objects[this.type]),this.main.append("g").attr("id",this.type).selectAll("path").data(this.boundaries.features).enter().append("path").attr("class",r.proxy(this.addResultClass,this)).attr("d",r.proxy(this.addPath,this)).attr("data-gssid",r.proxy(this.getDataGssId,this))},i.prototype.getCentroid=function(e,t){var n=e||[];return{x:n[0]||this.width/2,y:n[1]||this.height/2,k:t||1}},i.prototype.addPath=function(e){var t=this.path(e).replace(/(\s*[A-Z]?\d+\.\d{1})(\d+)/g,"$1");return t},i.prototype.getDataGssId=function(e){return e.properties.ID},i.prototype.getDataLabel=function(e){return e.properties.NAME},i.prototype.getShortLabel=function(e){var t=this.getDataGssId(e),n=this.data[t]?this.data[t].shortName:e.properties.NAME;return n},i.prototype.getCentroidX=function(e){var t=this.getAdjustedPosition(e);return this.path.centroid(e)[0]+t.x},i.prototype.getCentroidY=function(e){var t=this.getAdjustedPosition(e);return this.path.centroid(e)[1]+t.y},i.prototype.getPartyCode=function(e){var t=this.getDataGssId(e),n=this.data[t]?this.data[t].partyCode:"";return n.toLowerCase()},i.prototype.addResultClass=function(e){var t=this.elements.pathClass+" "+this.elements.pathClass+"-";return t+=this.getPartyCode(e),t},i.prototype.addLabels=function(e){this.main.select("#"+this.type).selectAll("text").data(this.boundaries.features).enter().append("text").text(r.proxy(this.getShortLabel,this)).attr("x",r.proxy(this.getCentroidX,this)).attr("y",r.proxy(this.getCentroidY,this)).attr("text-anchor","middle").attr("class",r.proxy(this.addLabelClass,this)).attr("font-size",(12/e).toFixed(2)+"px")},i.prototype.addLabelClass=function(e){var t="election-map-label",n=this.getDataGssId(e);return this.getPartyCode(e)!==""&&(t+="-declared"),t},i.prototype.getAdjustedPosition=function(e){var t=this.getDataGssId(e),n={S12000008:{x:3,y:0},S12000021:{x:0,y:2},S12000023:{x:-6,y:0},S12000035:{x:3,y:0},S12000036:{x:.8,y:0},S12000038:{x:1,y:2},S12000042:{x:0,y:.5},S12000044:{x:1,y:3},S12000045:{x:0,y:1.7},S12000046:{x:1,y:.3}};return n[t]||{x:0,y:0}},i.prototype.updateLabels=function(e,t){e>12||t<2?this.hideLabels():(this.showLabels(),this.resizeLabels(t))},i.prototype.resizeLabels=function(e){this.main.selectAll("text").attr("font-size",(12/e).toFixed(2)+"px")},i.prototype.hideLabels=function(){this.main.attr("class",this.elements.hideLabelsClass)},i.prototype.showLabels=function(){this.main.attr("class","")},i.prototype.visibleLabels=function(){return!this.main.classed(this.elements.hideLabelsClass)},i.prototype.getVisibleArea=function(e,t){var n=0,i=r(e),s=i[0].getBoundingClientRect();i.find("path."+this.elements.pathClass).each(function(){var e=this.getBoundingClientRect();e.left-s.left>0&&s.right-e.right>0&&s.bottom-e.bottom>0&&e.top-s.top>0&&(n+=1)}),this.updateLabels(n,t)},i.prototype.logStats=function(e){n.pubsub.emit("scotref:map",[e])},i}),define("module/components/scotland_decides/map/map_view",["vendor/d3/d3","vendor/topojson/topojson","module/bootstrap","module/components/scotland_decides/map/map_helper"],function(e,t,n,r){var i=n.$,s=function(e,t){var n={scale:1500,translate:[0,0],zoom:!1,keys:!0,scaleExtent:[1,64]};this.id=e,this.size=t.size,this.config=t,this.dragging=0,this.settings=i.extend({},n,t.options),this.baseUrls={"scotland-elections":"/news/politics/councils/"},this.elements={zoomControlClass:"election-map__control-btn",zoomInControlClass:"election-map__control--zoomIn",zoomOutControlClass:"election-map__control--zoomOut",zoomResetControlClass:"election-map__control--reset",disableControlClass:"election-map__control--disabled",hideLabelsClass:"election-map--hideLabels",pathClass:"election-map__area",areaInfoClass:"election-map__area-info"},this.statsPrefix=this.settings.fullscreen?"fullscreen-":"",this.statsTarget=""};return s.prototype.init=function(){this.setup(this.id),this.setEvents(),typeof SVGFEColorMatrixElement!="undefined"&&this.setZoomControls();try{window.navigator.userAgent.match(/Windows.*Chrome\/(35|36)/i)&&i(this.id).addClass("scot-ref-font-fallback")}catch(e){}},s.prototype.setup=function(e){var t=i(e);this.setSize(),this.setMain(e),this.getElements(t),this.setupHelper(),this.drawIslandBorder(this.svg),t.addClass("scot-ref-map--loaded")},s.prototype.setupHelper=function(){this.helper=new r(this.main,this.width,this.height,this.config,this.elements),this.centroid=this.helper.getCentroid(),this.helper.setPath(),this.helper.loadShape(),this.helper.addLabels(this.centroid.k),this.helper.hideLabels()},s.prototype.drawIslandBorder=function(t){var n=i(t).find('path[data-gssid="S12000027"]'),r,s=4;n.length>0&&(r=n[0].getBBox(),e.select(t).select("#scotland-elections").append("rect").attr("class","election-map__border").attr("x",r.x-s).attr("y",r.y-s).attr("width",r.width+s*2).attr("height",r.height+s*2))},s.prototype.setSize=function(){var e=i(window),t=i(this.id),n=e.width(),r=e.height(),s=1.2,o=n<r?[n,n*s]:[r/s,r],u=n<r?[(r-n*s)/2,0]:[0,(n-r/s)/2],a=50;if(this.settings.fullscreen){i("html").height(r);if(u[0]&&u[0]<a){var f=r-a*2,l=f/s;u=[38,(n-l)/2],o=[l,f]}t.width(o[0]),t.height(o[1]),t.css("margin-top",u[0]),t.css("margin-left",u[1])}else{var c=n-16;c<t.width()&&(t.width(c),t.height(c*s))}this.width=t.width(),this.height=t.height()},s.prototype.setMain=function(t){var n=this.width,r=this.height;this.main=e.select(t).append("div").attr("class","scot-ref-map-view").append("svg").attr("class","election-map-svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+n+" "+r).attr("width",n).attr("height",r).append("g").append("g"),this.clipView()},s.prototype.clipView=function(){e.select("svg g").attr("clip-path","url(#clipView)"),e.select("svg").insert("defs","g").append("clipPath").attr("id","clipView").append("rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height)},s.prototype.setEvents=function(){this.mousedown=!1,!this.settings.fullscreen&&this.size==="xs"?this.setupFullscreen():(this.main.on("mousedown",i.proxy(this.mousedownEvent,this)).on("click",i.proxy(this.areaSelected,this)),i(this.id).after('<div class="'+this.elements.areaInfoClass+'"></div>')),this.settings.fullscreen&&i(window).on("resize",i.proxy(this.setSize,this))},s.prototype.setZoomControls=function(){if(this.settings.zoomBehavior||this.size!=="xs")this.setZoomBehavior(),e.select(this.id).call(this.zoomBehavior).on("dblclick.zoom",null),this.setupControls()},s.prototype.setupFullscreen=function(){var e=i(this.id);e.addClass("scot-ref-map--cta"),e.append('<button id="scot-ref-map--cta-btn">Explore the map</button>'),i("#scot-ref-map--cta-btn").on("mousedown",i.proxy(this.openFullscreen,this))},s.prototype.openFullscreen=function(){var e=i("body").append('<div class="scot-ref-map-overlay"><div id="scot-ref-map-overlay--content" class="scot-ref-map__container"></div></div>');n.pubsub.emit("scotref:map:fullscreen",[{id:"scot-ref-map-overlay--content"},{fullscreen:!0}]),i("html").addClass("scot-ref-map-overlay--on"),this.helper.logStats("open-fullscreen")},s.prototype.exitFullScreen=function(){i(".scot-ref-map-overlay").remove(),i("html").removeClass("scot-ref-map-overlay--on").height("auto")},s.prototype.getElements=function(e){this.view=e.find(".scot-ref-map-view")[0],this.svg=e.find(".election-map-svg")[0]},s.prototype.mousedownEvent=function(){this.mousedown=!0},s.prototype.areaSelected=function(){var t=e.select(e.event.target).datum(),n=this.helper.getDataGssId(t),r=this.baseUrls[this.config.type]+n;if(this.dragging>2){this.dragging=0,this.mousedown=!1;return}this.helper.logStats(this.statsPrefix+n),window.location.href=r},s.prototype.showAreaInfo=function(e){var t=i("."+this.elements.areaInfoClass),n=this.helper.getDataGssId(e),r=this.baseUrls[this.config.type]+n,s=this.helper.data[n]?this.helper.data[n]:{},o=s.name,u=s.shareYes,a=s.shareNo;t.html('<p><span class="election-map__area-share election-map__area-share--yes">Yes</span> '+u+"% </p>"+'<p><span class="election-map__area-share election-map__area-share--no">No</span> '+a+"% </p>"+'<a class="election-map__area-link" href="'+r+'">Live reports from <span>'+o+"</span></a>"),this.helper.logStats(this.statsPrefix+o)},s.prototype.clearAreaInfo=function(){i("."+this.elements.areaInfoClass).html("")},s.prototype.setupControls=function(){this.addControls(),this.settings.keys&&this.addKeys(),i(".election-map__control a").on("click",i.proxy(this.addControlsEvents,this)),i(".election-map__control--close").on("click",i.proxy(this.exitFullScreen,this))},s.prototype.addControls=function(){var e='<div class="election-map__control"><a class="election-map__control-btn election-map__control--reset election-map__control--disabled" data-zoom="1" title="Reset the map">Reset</a><a class="election-map__control-btn election-map__control--zoomIn" data-zoom="5" title="Zoom the map in"></a><a class="election-map__control-btn election-map__control--zoomOut election-map__control--disabled" data-zoom="0.2" title="Zoom the map out"></a></div>';i(this.id).append(e),this.settings.fullscreen&&i(this.id).before('<a class="election-map__control-btn election-map__control--close">Back</a>')},s.prototype.addKeys=function(){var e='<div class="election-map__keys"><p><span class="election-map__keys-info1"></span>No overall control</p><p><span class="election-map__keys-info2"></span>Result not in</p></div>';i(this.id).after(e)},s.prototype.addControlsEvents=function(e){e.preventDefault();var t=this.zoomBehavior,n=[this.width/2,this.height/2],r=t.scaleExtent(),s=t.translate(),o={x:s[0],y:s[1],k:t.scale()},u=i(e.target).data("zoom"),a=t.scale()*u;u===1?(a=1,o.x=0,o.y=0,this.reset=!0,this.clearAreaInfo(),this.statsTarget="reset"):(a=a<r[0]?r[0]:a>r[1]?r[1]:a,o.x+=n[0]-((n[0]-o.x)/o.k*a+o.x),o.y+=n[1]-((n[1]-o.y)/o.k*a+o.y),this.reset=!1,this.statsTarget="control"),this.interpolateZoom([o.x,o.y],a)},s.prototype.updateControlsClass=function(e,t,n){var r=this.zoomBehavior.scaleExtent(),s=parseInt(n,10);i("."+this.elements.zoomControlClass).removeClass(this.elements.disableControlClass),s===r[0]&&i("."+this.elements.zoomOutControlClass).addClass(this.elements.disableControlClass),s===r[1]&&i("."+this.elements.zoomInControlClass).addClass(this.elements.disableControlClass),e===0&&t===0&&s===1&&i("."+this.elements.zoomResetControlClass).addClass(this.elements.disableControlClass)},s.prototype.interpolateZoom=function(t,n){var r=this,i=this.zoomBehavior,s=0;this.size==="l"&&(s=350),e.transition().duration(s).tween("zoom",function(){var s=e.interpolate(i.translate(),t),o=e.interpolate(i.scale(),n);return function(e){i.scale(o(e)).translate(s(e)),r.target=r.svg,r.updateCssTransform(r.target,i.translate(),i.scale()),r.reset&&r.size!=="l"&&r.updateCssTransform(r.view,i.translate(),i.scale())}}).each("end",function(){r.helper.logStats(r.statsPrefix+r.statsTarget),r.zoomEnd(!0)})},s.prototype.setZoomBehavior=function(){this.zoomBehavior=e.behavior.zoom().size([this.width,this.height]).scaleExtent(this.settings.scaleExtent).on("zoomstart",i.proxy(this.zoomStart,this)).on("zoom",i.proxy(this.zoomed,this)).on("zoomend",i.proxy(this.zoomEnd,this))},s.prototype.zoomStart=function(){this.helper.visibleLabels()||this.size==="l"?this.target=this.svg:(this.switchCssTransform(this.svg,this.view),this.target=this.view),this.action=!1},s.prototype.zoomed=function(){this.dragging++,this.updateCssTransform(this.target,e.event.translate,e.event.scale),this.action="pinch"},s.prototype.zoomEnd=function(e){this.mousedown||(this.dragging=0),this.helper.getVisibleArea(this.id,this.centroid.k),this.updateControlsClass(this.centroid.x,this.centroid.y,this.centroid.k),this.target===this.view&&this.switchCssTransform(this.view,this.svg),!e&&this.action&&this.helper.logStats(this.statsPrefix+this.action)},s.prototype.switchCssTransform=function(e,t){var n=e.style.transform;this.setCssTransform(t,n),this.setCssTransform(e,"translatez(0)")},s.prototype.updateCssTransform=function(e,t,n){var r=t[0],i=t[1],s=n,o;this.size!=="l"&&(r=r.toFixed(2),i=i.toFixed(2),s=s.toFixed(2)),o="translate("+r+"px, "+i+"px) scale("+s+")",this.setCssTransform(e,o),this.centroid.k>n&&this.helper.hideLabels(),this.helper.visibleLabels()&&this.centroid.k!==n&&this.helper.resizeLabels(this.centroid.k),this.centroid.x=r,this.centroid.y=i,this.centroid.k=s},s.prototype.setCssTransform=function(e,t){var n=["transform","webkitTransform","mozTransform"];for(var r=n.length-1;r>=0;r-=1)e.style[n[r]]=t},s}),define("module/components/sport",["module/bootstrap","module/components/hardNewsUnit","translator"],function(e,t,n){var r=e.$;return{handleSuccess:function(e,n){this.selector=r(e.selector),this.teams=this.selector.find("#sport-teams").removeClass("hidden").hide(),this.sportStories=this.selector.find("#latest-sport-stories"),t.init(e.selector),this.sportStories.length&&this.teams.length&&this.renderTabs(),this.sportStories.length===0&&this.teams.length&&this.teams.show()},renderTabs:function(){this.selector.find("#latest-sport-stories").before(r('<ul class="tabs-list js-tabs-list" role="tablist">                <li id="tab-1" class="open" role="presentation"><a href="#latest-sport-stories"                    role="tab" tabindex="0">Latest stories<span class="off-screen"> selected</span>                    </a></li>                <li id="tab-2" role="presentation"><a href="#sport-teams"                     role="tab" tabindex="-1">Local teams</a></li></ul>')),this.selector.addClass("has-tabs"),this.tabs=this.selector.find(".js-tabs-list li"),this.tabs.find("a").on("click",r.proxy(this.toggleTabs,this)),this.tabs.find("a").on("keydown",r.proxy(this.handleKeypress,this))},toggleTabs:function(e){this.selector.find(".js-tab-content").attr("aria-hidden","true").hide(),this.tabs.removeClass("open"),this.tabs.find("a").attr("tabindex","-1");var t=r("#"+e.target.href.split("#")[1]),n=r(e.target),i=n.parent();return this.tabs.find("span.off-screen").appendTo(n),i.addClass("open"),n.attr("tabindex","0"),t.attr("aria-hidden","false").show(),!1},handleKeypress:function(e){var t=r(e.target).parent(),n=t.next().find("a"),i=t.prev().find("a"),s=t.parent().find("a").first(),o=t.parent().find("a").last(),u;e.which&&(e.which===39?u=n.length?n:s:e.which===37&&(u=i.length?i:o)),u&&(u.trigger("click"),u[0].focus())}}}),define("module/components/storiesGroup",["module/components/hardNewsUnit"],function(e){var t=!1;return{handleSuccess:function(n){t||(e.init(".stories-group"),t=!0)}}}),define("module/components/topStories",["module/bootstrap","module/components/liveEventPromo","module/components/hardNewsUnit","module/components/localLive"],function(e,t,n,r){return{handleSuccess:function(i){var s=e.$(i.selector);n.init(i.selector),s.hasClass("js-has-live-event-promo")&&t.handleSuccess(),s.hasClass("js-has-local-live-promo")&&r.handleSuccess("#comp-local-live")}}}),define("module/components/topicalStories",["module/components/hardNewsUnit"],function(e){return{handleSuccess:function(t){e.init(t.selector)}}}),define("module/dotcom/facade",["module/bootstrap"],function(e){return{onResize:function(){e.window&&e.window.bbcdotcom&&typeof e.window.bbcdotcom.reset!="undefined"&&e.window.bbcdotcom.reset()}}}),define("module/dotcom/handler",["module/bootstrap","module/dotcom/facade"],function(e,t){function r(){n.on("global:resize",i)}function i(e){t.onResize()}function s(e){r()}var n=e.pubsub;return{init:s}}),define("module/gazzetta",["module/bootstrap","module/tabbed/tabbed"],function(e,t){return{init:function(){var n=e.$,r=n("#tracker-tab li"),i=n(".tracker-container"),s=r[0]?new t(r,i):null,o;n("#tracker-tab").attr("data-knockout-status")==="started"&&s.tabs[1].activate(),n(".knockout__title").on("click",function(e){n(this).parent().toggleClass("knockout--closed")}),n("#live-scores")&&(o=n("#live-scores__refresh"),o.on("click",function(e){return e.preventDefault(),window.location.href=o.attr("href")+"#live-scores",window.location.reload(),!1}))}}}),define("module/hotspot",function(){}),define("module/local/local",["module/bootstrap"],function(e){var t=function(t){this.options=t||{},this.options.simple=this.options.simple||!1,this.options.story_limit=this.options.story_limit||2,this.options.append_ext=this.options.append_ext||undefined,e.pubsub.on("locator:locationChanged",e.$.proxy(this.updateLocalNews,this))};return t.prototype.updateLocalNews=function(t){t&&t.news&&t.news.id&&t.news.path?(e.pubsub.emit("local:requestStarted"),e.$.ajax({url:e.config.pathPrefix+"/local/"+t.news.path+(this.options.append_ext!==undefined?this.options.append_ext:"")+"?limit="+this.options.story_limit+"&simple="+this.options.simple,dataType:"html",type:"get",success:function(n){e.pubsub.emit("local:newsReceived",[n,t.news.path])},error:function(t){e.pubsub.emit("local:requestError","requestError")}})):e.pubsub.emit("local:locationInvalid","locationInvalid")},t}),define("module/local/localView",["module/bootstrap","module/timestamp","module/imageenhancer","module/components/hardNewsUnit","config","translator"],function(e,t,n,r,i,s){var o=function(t,n){this.container=e.$(t,n);if(!this.container.length)return;this.moduleTitle=e.$(".local-weather__title",n),this.hideLocal(),e.pubsub.on("local:requestStarted",e.$.proxy(this.handleLoading,this)),e.pubsub.on("local:newsReceived",e.$.proxy(this.handleSuccess,this)),e.pubsub.on("local:requestError",e.$.proxy(this.handleError,this))};return o.prototype={handleLoading:function(){this.setContent(null,"loading")},handleSuccess:function(e,t){this.showLocal(),this.setContent(e),t&&this.setTitle(t)},handleError:function(){this.setContent(s.get("localNewsCouldNotBeLoaded"),"error")},setTitle:function(t){var n,r=e.$("#local-stories",this.container);r&&r.attr("data-title")&&(n='<a href="{{link}}" class="local-weather__link right-arrow">{{title}}</a>'.replace("{{link}}","/news/"+t).replace("{{title}}",r.attr("data-title")),this.moduleTitle.html(n))},setContent:function(e,i){i&&(e='<div class="'+i+'">'+(e||"")+"</div>"),this.container.html(e);var s=new n,o=new t((new Date((new Date).toUTCString())).getTime());r.init("#local-stories")},hideLocal:function(){this.container.addClass("hidden")},showLocal:function(){this.container.removeClass("hidden")}},o}),define("module/weather/weather",["module/bootstrap"],function(e){var t=function(t){this.options=t||{},this.options.type=this.options.type||"hourly",this.options.append_ext=this.options.append_ext||undefined,e.pubsub.on("weather:locationChanged",e.$.proxy(this.updateWeather,this))};return t.prototype.updateWeather=function(t){t&&t.id&&(this.url=e.config.pathPrefix+"/weather/"+t.id.toString().toLowerCase()+"/"+this.options.type,e.pubsub.emit("weather:requestStarted"),e.$.ajax({url:this.url+(this.options.append_ext!==undefined?this.options.append_ext:""),type:"get",dataType:"html",success:function(n){e.pubsub.emit("weather:success",[n,t])},error:function(t){e.pubsub.emit("weather:requestError",[t])}}))},t}),define("module/weather/weatherView",["module/bootstrap"],function(e){var t=function(t){this.container=e.$(t);if(!this.container.length)return;this.weatherLinkHref=this.container.attr("href"),this.hideWeather(),e.pubsub.on("weather:success",e.$.proxy(this.handleSuccess,this)),e.pubsub.on("weather:requestError",e.$.proxy(this.handleError,this))};return t.prototype={setContent:function(e){this.container.html(e)},setLink:function(e){return e=e?e:"",this.weatherLinkHref+"/"+e.toString().toLowerCase()},setLocationName:function(t){if(t!==undefined){var n=e.$(".weather-location");n.length&&n.html('<h3 class="weather-location__current"><a href="'+this.setLink(this.location.id)+'" class="weather-location__current-link right-arrow">'+t+" weather</a></h3>")}},handleSuccess:function(e,t){this.setContent(e),this.location=t,this.container.attr("href",this.setLink(this.location.id)),this.showWeather(),this.setLocationName(this.location.name),this.highlightDropdownButton()},handleError:function(){this.hideWeather()},showWeather:function(){this.container.removeClass("hidden")},hideWeather:function(){this.container.addClass("hidden")},highlightDropdownButton:function(){e.$(".weather-location__show-locations").on("mouseenter",function(){e.$(".weather-location__current").addClass("hover")}).on("mouseleave",function(){e.$(".weather-location__current").removeClass("hover")}).on("keyup",function(t){var n=t.keyCode||t.which;n===9&&e.$(".weather-location__current").addClass("hover")}).on("blur",function(){e.$(".weather-location__current").removeClass("hover")})}},t}),define("module/weather/weatherLocation",["module/bootstrap"],function(e){var t=function(){this.retrieveWeatherItems()};return t.prototype={retrieveWeatherItems:function(){e.pubsub.emit("weatherLocation:requestStarted");var t=window.location.pathname,n=e.config.pathPrefix+"/weather/regions"+t.toLowerCase();e.$.ajax({url:n,type:"get",dataType:"html",success:function(t){e.pubsub.emit("weatherLocation:success",[t])},error:function(t){e.pubsub.emit("weatherLocation:requestError",[t])}})}},t}),define("module/weather/weatherLocationView",["module/bootstrap","deviceInspector"],function(e,t){var n=function(t){this.container=e.$(t),this.weatherModule=e.$(".weather-forecast");if(!this.container.length)return;this.hideWeatherLocation(),e.pubsub.on("weatherLocation:success",e.$.proxy(this.handleSuccess,this)),e.pubsub.on("weatherLocation:requestError",e.$.proxy(this.handleError,this))};return n.prototype={insertWeatherLocationDropdown:function(t){this.container.append(t),e.$(".weather-location__list li:first-child",this.container).length&&this.assignEventListeners();var n=e.$(".weather-location__current",this.container).attr("data-weather");e.pubsub.emit("weather:locationChanged",[{id:n}])},assignEventListeners:function(){this.locations=e.$(this.container),this.list=e.$(".weather-location__list",this.container),this.listItems=e.$("li",this.container),this.button=e.$(".weather-location__show-locations",this.container);var n=this;n.button[0].addEventListener("click",function(){n.list.hasClass("hidden")?n.button.text("Hide locations"):n.button.text("Show locations"),n.button.toggleClass("weather-location__show-locations--open"),n.list.toggleClass("hidden")},!0);var r=function(r){var i=r||window.event;if(r.type!=="keypress"||r.type==="keypress"&&i.keyCode===13){var s=i.target||i.srcElement,o=e.$(s),u={},a=document.getElementById("comp-local-weather");n.clicked=o.text(),n.listItems.removeClass("hidden"),o.addClass("hidden"),e.$(".weather-location__current",this.locations).text(n.clicked),n.button.removeClass("weather-location__show-locations--open"),n.list.addClass("hidden"),u.id=r.target.getAttribute("data-weather"),e.pubsub.emit("weather:locationChanged",[u]),!n.elementInView(n.button)&&t.getType()!=="desktop"&&a.scrollIntoView()}};e.$("li",n.list).each(function(){this.addEventListener("click",function(e){r(e)},!0)}),n.list[0].addEventListener("keypress",function(e){r(e)},!0)},elementInView:function(t){return t.offset().top>e.$(window).scrollTop()},handleSuccess:function(e){this.insertWeatherLocationDropdown(e),this.showWeatherLocation()},handleError:function(){this.hideWeatherLocation()},showWeatherLocation:function(){this.container.removeClass("hidden")},hideWeatherLocation:function(){this.container.addClass("hidden")}},n});try{define("module/localnewsandweather",["module/bootstrap","module/locatorFacade","module/local/local","module/local/localView","module/weather/weather","module/weather/weatherView","config","translator","module/weather/weatherLocation","module/weather/weatherLocationView"],function(e,t,n,r,i,s,o,u,a,f){var l={LOCATOR:".locator",WEATHER:".weather-forecast",LOCAL:".locator-stories-placeholder"},c={init:function(t){this.moduleElement=e.$(t);if(!this.moduleElement.length)return;this.moduleTitle=e.$(".local-weather__title",this.moduleElement),this.locatorElement=e.$(".locator",this.moduleElement),this.localNewsElement=e.$(".locator-stories-placeholder",this.moduleElement),this.titleLink=e.$("a",this.moduleTitle);var u=e.$(".weather-dropdown",this.moduleElement);u.length&&(this.weatherLocation=new a,this.weatherLocationView=new f(u),e.pubsub.on("weather:locationChanged",e.$.proxy(this.setTitleLink,this))),this.local=new n({simple:o.local&&o.local.simple?o.local.simple:!1,story_limit:o.local&&o.local.story_limit?o.local.story_limit:2,append_ext:o.local&&o.local.append_ext?o.local.append_ext:undefined}),this.type="average",o.local&&o.local.weather_type&&(this.type=o.local.weather_type),this.weather=new i({type:this.type,append_ext:o.local&&o.local.append_ext?o.local.append_ext:undefined}),this.localView=new r(l.LOCAL,this.moduleElement),this.weatherView=new s(l.WEATHER),this.locatorElement.length&&this.renderLocator(),this.localNewsElement.length&&this.renderLocal(),this.renderWeather(),this.show()},setTitle:function(e,t){t&&(e='<a href="{{link}}">{{title}}</a>'.replace("{{link}}",t).replace("{{title}}",e)),this.moduleTitle.html(e)},setTitleLink:function(e){this.weatherBaseUrl||(this.weatherBaseUrl=this.titleLink[0].href),this.titleLink.attr("href",this.weatherBaseUrl+"/"+e.id.toString().toLowerCase())},renderLocator:function(){t.open(l.LOCATOR),this.location=t.getLocation(),this.location||(this.setTitle(u.get("localNewsAndWeather")),e.pubsub.emit("locator:renderForm"))},renderLocal:function(){this.local.updateLocalNews(this.location)},renderWeather:function(){this.weather.updateWeather(this.location)},show:function(){this.moduleElement.removeClass("hidden")},hide:function(){this.moduleElement.addClass("hidden")}};return c})}catch(e){}define("module/rollingNews",["module/bootstrap","module/imageenhancer","config"],function(e,t,n){var r=e.$,i,s,o=!1;return{request:function(){r.ajax({url:"/"+n.service+"/api/"+s+".json?limit="+i.find(".rolling-news__story").length,type:"GET",success:function(t){o=!0,e.pubsub.emit("rollingNews:augment",[t]),i.find(".rolling-news__story--loading").each(function(){e.pubsub.emit("rollingNews:openAccordion",[r(this)])})},error:function(t){e.pubsub.emit("rollingNews:error",[t])},timeout:3e4})},augment:function(e){var n,s;i.find(".rolling-news__story a").each(function(){n=r(this),s=e[n.attr("href").trim()],s&&n.parent().find(".rolling-news__story__body__content").append(s)}),new t(".rolling-news img")},toggleAccordion:function(t){t.hasClass("rolling-news__story--open")||t.hasClass("rolling-news__story--loading")?e.pubsub.emit("rollingNews:closeAccordion",[t]):e.pubsub.emit("rollingNews:openAccordion",[t])},openAccordion:function(e){o&&e.hasClass("rolling-news__story--loading")&&e.removeClass("rolling-news__story--loading"),e.addClass(o?"rolling-news__story--open":"rolling-news__story--loading")},closeAccordion:function(e){e.removeClass(o?"rolling-news__story--open":"rolling-news__story--loading")},init:function(){i=r(".rolling-news__body"),s=r(".rolling-news").attr("data-asset-id"),e.pubsub.on("rollingNews:request",this.request,this),e.pubsub.on("rollingNews:augment",this.augment,this),e.pubsub.on("rollingNews:toggleAccordion",this.toggleAccordion,this),e.pubsub.on("rollingNews:openAccordion",this.openAccordion,this),e.pubsub.on("rollingNews:closeAccordion",this.closeAccordion,this),i.on("click",".rolling-news__story > a",function(t){t.preventDefault(),t.stopPropagation(),e.pubsub.emit("rollingNews:toggleAccordion",[r(this).parent()])}),e.pubsub.emit("rollingNews:request")}}}),define("module/sport/sportView",["module/bootstrap","module/deviceInspector","translator"],function(e,t,n){var r=e.$,i=function(){},s=4,o=r("#latest-sport-stories .sport-stories__more-button"),u,a=n.get("showMore"),f=n.get("showLess"),l=n.get("latestSportStories");return i.prototype={init:function(e,n){this.bindEvents(),u=n||t.init(),this.selectorContainer=e instanceof r?e:r(e),this.headlineContainer=this.selectorContainer.find(".sport-stories__headline-stories");if(this.selectorContainer.length===0)return;if(!/group(1|2)/i.test(u.getGroup()))return;this.setUpStories()},setUpStories:function(){var e=this.selectorContainer.find(".sport-stories__headline-story");if(e.length>s&&/group(1|2)/i.test(u.getGroup())){var t=e.slice(s);t.addClass("sport-stories__headline-story--toggle"),this.headlineContainer.addClass("sport-stories__headline-stories--hide"),this.appendButton()}},bindEvents:function(){r(window).on("resize",r.proxy(this.handleResize,this))},appendButton:function(){this.selectorContainer.find("#latest-sport-stories").append('<button class="sport-stories__more-button">'+a+'<span class="off-screen"> '+l+"</span></button>"),this.button=r(".sport-stories__more-button"),this.button.on("click",r.proxy(this.handleButtonEvent,this))},handleButtonEvent:function(){this.toggleStories(),this.toggleButtonState()},toggleButtonState:function(){var e=this.button[0].childNodes[0];e.nodeValue===a?(e.nodeValue=f,this.selectorContainer.find("a.sport-stories__headline-story--toggle")[0].focus()):(e.nodeValue=a,this.button[0].focus())},toggleStories:function(){this.headlineContainer.toggleClass("sport-stories__headline-stories--hide")},handleResize:function(e){/group3|4/i.test(u.getGroup())?(this.headlineContainer.hasClass("sport-stories__headline-stories--hide")&&(this.toggleStories(),this.button[0].textContent===f+" "+l&&this.toggleButtonState()),this.button&&this.button.css("display","none")):(r("#latest-sport-stories .sport-stories__more-button").length===0&&this.setUpStories(),this.headlineContainer.addClass("sport-stories__headline-stories--hide"),this.button.css("display","block"))}},i}),define("module/index",["module/bootstrap","module/transclude","module/tabbed/tabbed","module/imageenhancer","module/timestamp","module/history/history","module/localnewsandweather","module/rollingNews","module/sport/sportView","module/gazzetta","config"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e.$;return{init:function(){var e=new t,o=new i((new Date((new Date).toUTCString())).getTime()),h=c(".fetch").length,p=c("#travel"),d=new a,v;h?e.get(".fetch",{target:".panel-2 #most-popular-placeholder",complete:function(){var e=new n(c("#index-tabs li"),c("#index-panels > .panel"),!0,"top-stories"),t=new s(["tabs:activate"],{eventName:"tabs:activate",data:[0]}),i=new r}}):v=new r,l.features.localnews&&l.locatorFlagPole&&require(["module/localnewsandweather"],function(e){e.init("#comp-local-weather")}),c(".rolling-news").length&&u.init(),c("#comp-sport-stories").length>0&&d.init(c("#comp-sport-stories")),c("#live-scores").length&&f.init()}}}),define("module/live-event-component",["config","module/bootstrap","module/poller","module/timestamp"],function(e,t,n,r){return{pollingUrl:function(e,t,n){return typeof t=="undefined"&&(t={service:"nfp"}),e+"/"+t.service+"/walkietalkie/latest_index_asset/"+n},handleSuccess:function(){e.features.liveeventcomponent&&this.init(e.pollingHost,null)},init:function(i,s){var o=t.$,u=this;o("[data-channel]").each(function(){var t=o(".article-inner",this),a=o(".live-event-summary",t),f=o(".live-event-entries",t),l=o(this).attr("data-channel"),c=new n(3e4),h="",p=u.pollingUrl(i,e,l);c.startCacheBusting(),c.setUrl(p),c.startPolling({success:function(e){o.trim(f.html())||a.remove();if(e.entryId!==h){var t=null;if(e.createTime){var n=e.createTime.split(/[\-T:]/g),i=new Date(n[0],n[1]-1,n[2]);i.setHours(n[3],n[4],n[5]);var u=((new Date).getTime()-i.getTime())/1e3,l=new r(null),c=l.timeAgoInWords(u);c&&(t='<em class="entry-timestamp">'+c+"</em>")}if(t){var d=e.html.indexOf(">")+1,v=e.html.substring(0,d),m=e.html.substring(d);e.html=v+t+m}return s?s(f,e.html):(f.css("opacity","0"),setTimeout(function(){f.html(e.html).css("opacity","1")},1200)),h=e.entryId,p}},error:function(){o.trim(f.html())||(f.css("display","none"),a.css("visibility","visible"),c.stopPolling())}})})}}}),define("module/locator",["config","module/bootstrap","vendor/locator/main"],function(e,t,n){return new n({pubsub:t.pubsub,enableReverseGeocode:e.local&&e.local.allowLocationLookup?e.local.allowLocationLookup:!1,enableAutoComplete:e.local&&e.local.allowAutoComplete?e.local.allowAutoComplete:!1,host:e.locatorHost,confirmLocationSelection:!0,persistLocation:!0})}),define("module/mediaAssetPage/api",["module/bootstrap","module/featureDetector"],function(e,t){var n=function(){var t=this;e.pubsub.on("map:asset:load",function(e){t.request(e,"asset")}),e.pubsub.on("map:feed:load",function(n){e.config.configuration.get("showMapTopStories")?t.request(n,"feed"):e.pubsub.emit("map:feed:request:error",[n])})};return n.prototype={request:function(r,i,s){var o=e.config.pathPrefix;e.pubsub.emit("map:request:start",[r,i]),t.is("Holepunched")&&(o+="/holepunched"),e.$.ajax({url:o+"/api/av/"+i+"/"+r+".html",type:"get",dataType:"json",success:function(t){t.feed&&(t=t.feed),s&&s(t),e.pubsub.emit("map:"+i+":request:success",[r,t])},error:function(t){e.pubsub.emit("map:"+i+":request:error",[r,t])}})}},n}),define("module/mediaAssetPage/assetView",["module/bootstrap","module/media/mediaLoader","module/media/mediaFilter","module/timestamp","translator","config","deviceInspector","module/page"],function(e,t,n,r,i,s,o,u){function c(t){g(t),f=new r((new Date((new Date).toUTCString())).getTime()),e.pubsub.on("map:asset:request:success",b),e.pubsub.on("map:asset:request:error",E),e.pubsub.on("video:load",h),e.pubsub.on("map:asset:load",function(){a("#media-asset-page-video figure").remove()}),m()}function h(){var e=a("#media-asset-placeholder");e.length&&e.addClass("hide-placeholder")}function p(e){a(".story-inner .more-wrapper").css("display","block"),a(".story-inner .more-text").text(i.get("moreInfo"));var t=a(".map-body",e),n=1;t.children().first().is("figure")&&n++,e.addClass("contains-more-text"),t.append('<div class="hide-wrapper extra-content"></div>');var r=a(".hide-wrapper",e);a(".map-body > *",e).each(function(){n===0&&!a(this).hasClass("hide-wrapper")?r.append(this):--n}),t.removeClass("display-feature-phone-only")}function d(){var t=a(".story-inner"),n=a("#media-asset-page-text",t),r=a(".map-body",n),s='<div class="more-wrapper" style="display: none;"><a class="more-text" href="#" title="'+i.get("moreInfo")+'">'+i.get("moreInfo")+"</a></div>";n.after(s),a(".more-text",t).on("click",function(t){var r=t.target,s=a(".hide-wrapper",n);s.toggleClass("extra-content"),s.hasClass("extra-content")?(e.pubsub.emit("map:asset:summary",["close"]),r.innerHTML=i.get("moreInfo"),r.setAttribute("title",i.get("moreInfo"))):(e.pubsub.emit("map:asset:summary",["open"]),r.innerHTML=i.get("lessInfo"),r.setAttribute("title",i.get("lessInfo"))),t.preventDefault()})}function v(t){t!=="desktop"&&!l&&(e.pubsub.removeListener("device",v),d(),p(a(".story-inner #media-asset-page-text")))}function m(){var t=a(".story-inner"),n=a("#media-asset-page-text",t),r=a(".more-text",t),i=a(".map-body > *",n).length;i<=1||i===2&&a(".map-body .related-items",n).length>0||o.getType()==="desktop"||l?(a(".map-body",n).removeClass("display-feature-phone-only"),r.css("display","none"),n.removeClass("contains-more-text"),e.pubsub.on("deviceGroup",v)):(a(".more-text",t).length===0&&d(),p(n))}function g(e,r){var i,s,o=e.videos?e.videos:e.audios,u=o===e.videos?"video":"audio",a,f,l,c;for(i in o.primary)if(o.primary.hasOwnProperty(i)){s=o.primary[i],a=i;break}f={width:"100%",height:"100%",mediaType:u,forceErrorMessages:!0,mediaId:a},r&&(f.assetId=r),s.sourceFiles&&(l=new n(s.sourceFiles,u),f.href=l.url),s.image||(s.image=y(e)),c=new t("#media-asset-page-video",s,f)}function y(e){var t,n=[];if(e.images&&e.images.index){var r=e.images.index;for(t in r)r.hasOwnProperty(t)&&n.push(r[t]);return n.sort(function(e,t){return e.width===t.width?0:e.width<t.width?1:-1}),n[0]}return{}}function b(e,t){w(t.countername),g(t.media,t.assetId);var n=a("#media-asset-page-text");a("#media-asset-page-text").html(t.body),f.insertTime(),m(),window.scrollTo(0,1)}function w(e){u.setCountername(e)}function E(e,t,n){}var a=e.$,f,l=s.asset.asset_uri===s.pathPrefix+"/"+s.configuration.channelpagecandyid;return{init:c}}),define("module/mediaAssetPage/listView",["module/bootstrap","module/featureDetector","module/tabbed/tabbed","module/timestamp","translator","config"],function(e,t,n,r,i,s){function l(e,t,n){n(t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}function c(e,t){window.history.pushState({title:t,path:e},null,e)}function h(t,n){document.title=n,e.pubsub.emit("map:asset:load",[t.replace(s.pathPrefix+"/","")])}function p(n){S(),f=n,a=new r((new Date((new Date).toUTCString())).getTime()),e.pubsub.on("map:feed:request:success",x),e.pubsub.on("map:feed:request:error",T),e.pubsub.on("map:asset:request:success",C),e.pubsub.on("tabs:activate",b),t.can("UseHistoryApi")&&window.addEventListener("popstate",function(e){e.state!==null&&e.state.title&&e.state.path&&(e.state.path.indexOf("/news/video_and_audio/")===-1?h(e.state.path,e.state.title):window.history.go(0))});var i=o(".top_stories.showmore.open .media-feed-placeholder .media-feed-grid");i.length!==0&&i.append(v(L())),d(),w(),N()}function d(){var e=o(".media-feeds")[0];e.onclick=function(n){var r=n||window.event,i=r.target||r.srcElement;while(i!==e){var s=i.nodeName==="ARTICLE"||i.nodeName==="DIV"&&i.className.indexOf("HTML5article")!==-1;if(!t.is("Holepunched")&&s&&o(i).hasClass("media-feed-item")){l(r,i,m);break}if(i.nodeName==="H2"&&o("a",i).length!==0){l(r,i,y);break}if(o(i).hasClass("more-text")){l(r,i,E);break}i=i.parentNode}}}function v(e){var t='<div class="more-wrapper"><a class="more-text" href="#" data-cps-id="'+e+'" title="'+i.get("showMore")+'">'+i.get("showMore")+"</a></div>";return t}function m(e){if(o(e).hasClass("selected"))return!1;if(s.configuration.cms==="topcat"){e.attributes["data-uri"]!==null&&(window.location.href=e.attributes["data-uri"].value+window.location.search);return}if(t.can("UseHistoryApi")&&e.attributes["data-uri"]!==null){var n=s.service.charAt(0).toUpperCase()+s.service.slice(1).toLowerCase(),r=e.attributes["data-uri"].value+window.location.search,i="BBC "+n+" - "+e.attributes["data-headline"].value;return e.attributes["data-picture"]&&o("#media-asset-placeholder").attr("src",e.attributes["data-picture"].value),c(r,i),h(r,i),!1}}function g(e){return o('.media-feed[data-cps-id="'+e+'"]')}function y(t){var n=t.parentNode.attributes["data-cps-id"].value.replace(s.pathPrefix+"/",""),r=g(n),i=o(".media-feed-grid",r);r.toggleClass("open");var u=r.hasClass("open")?"open":"close",a=r.attr("data-event");e.pubsub.emit("map:index:toggle",[a,u]);if(i.length===0&&r.hasClass("open")){var f=o(".media-feed-error",r);f.length!==0&&f.remove(),r.addClass("loading-after"),e.pubsub.emit("map:feed:load",[n])}return!1}function b(t,n){var r=o(u.tabs[n].t).attr("data-cps-id");if(r){var i=g(r),s=o(".media-feed-grid",i);i.addClass("open"),s.length===0&&(i.addClass("loading-after"),e.pubsub.emit("map:feed:load",[r]))}}function w(){var e;o(".media-panel").each(function(t,n){o(n).hasClass("open")&&(e=t)}),u=new n(o("#media-tabs li"),o(".media-panel"),!0,"media-asset-list-view"),(s.configuration.showMapMostWatched||s.configuration.showMapTopStories)===!1&&(e=0),e&&(u.tabs[e].activate(),b("default",e))}function E(t){var n=t,r=g(n.getAttribute("data-cps-id"));return r.toggleClass("showmore"),r.hasClass("showmore")?(e.pubsub.emit("map:index:topstories",["close"]),n.innerHTML=i.get("showMore"),n.setAttribute("title",i.get("showMore"))):(e.pubsub.emit("map:index:topstories",["open"]),n.innerHTML=i.get("showLess"),n.setAttribute("title",i.get("showLess"))),!1}function S(){var e=o(".media-feed.top_stories"),t=o("h2",e);o("a",e).replaceWith(function(){return this.innerHTML}),t.text(o.trim(t.text())),e.addClass("primary-feed")}function x(e,t){var n=g(e),r=o(".media-feed-placeholder",n);t&&r.html(t),a.insertTime();if(n.hasClass("showmore")){var i=o(".media-feed-grid",r);i.append(v(e))}n.removeClass("loading-after"),k()}function T(e,t){var n=g(e);n.removeClass("loading-after"),o(".media-feed-error",n).length===0&&n.append('<div class="media-feed-error">'+i.get("mediaUnavailable")+"</div>")}function N(){var t=o(".media-feed.js-postload");t.each(function(t,n){var r=o(n).attr("data-cps-id");r!==null&&o(".media-feed-item",n).length===0&&(o(n).addClass("loading-after"),e.pubsub.emit("map:feed:load",[r]))})}function C(e,t){k(e);var n=o(".related-video-audio .media-feed-grid"),r=o(".related-video-audio .media-feed-error");n.length===1&&(n.replaceWith(t.related),u.tabs[0].activate()),r.length===1&&r.replaceWith(t.related)}function k(e){e&&(f=s.pathPrefix+"/"+e);var t=o(".media-feed-item.selected");t.each(function(e,t){var n=o(t);n.removeClass("selected"),o(".js-media-duration",n).text(n.attr("data-duration"))});var n=o('.media-feed-item[data-uri="'+f+'"]');n.each(function(e,t){var n=o(t);n.addClass("selected"),o(".js-media-duration",n).text(i.get("nowPlaying"))})}function L(){return s.configuration.hasOwnProperty("videotopiccandyid")&&!!s.configuration.videotopiccandyid?s.configuration.videotopiccandyid:"video_and_audio/top_stories"}var o=e.$,u,a,f;return{init:p,modifyTopStoriesHeader:S}}),define("module/mediaAssetPage/map",["module/bootstrap"],function(e){return{init:function(){this.liveStats=e.$("#livestats");var t=this;e.pubsub.on("map:asset:request:success",function(e,n){t.updateLiveStats(n.beacon),t.updateShareTools(n.shareTools)})},updateLiveStats:function(e){if(!this.liveStats.length)return;var t=this.liveStats.attr("src").split("?")[0]+"?";this.liveStats.attr("src",t+e)},updateShareTools:function(t){e.$(".share").replaceWith(t)}}}),define("module/mediaAssetPage/mediaAssetPage",["module/bootstrap","module/transclude","module/mediaAssetPage/assetView","module/mediaAssetPage/listView","module/mediaAssetPage/api","module/mediaAssetPage/map","config"],function(e,t,n,r,i,s,o){var u=new i,a=o.asset.asset_uri===o.pathPrefix+"/"+o.configuration.channelpagecandyid;return{init:function(i,o){var u,a=i.videos?i.videos.primary:i.audios.primary;for(var f in a)if(a.hasOwnProperty(f)){u=f;break}n.init(i),r.init(o),s.init();if(!e.config.configuration.get("showMapMostWatched"))e.pubsub.emit("map:feed:request:error",["most-watched"]);else{var l=new t;l.get(".media-tab.most-watched a",{target:".most-watched .media-feed-placeholder",success:function(){e.pubsub.emit("map:feed:request:success",["most-watched"])},error:function(){e.pubsub.emit("map:feed:request:error",["most-watched"])},insert:!0})}}}}),define("module/touchEvents",["module/bootstrap","module/featureDetector"],function(e,t){var n=e.$,r={touchStart:function(e){this.startX=e.originalEvent.targetTouches[0].clientX,this.fastFlick=!0,setTimeout(n.proxy(function(){this.fastFlick=!1},this),this.flickTime)},touchMove:function(t){this.endX=t.originalEvent.targetTouches[0].clientX,this.transformFunction(this.endX-this.startX),e.pubsub.emit("touch:move"),this.enableTouchMove=!0},isSwipeOrFlick:function(e){return Math.abs(e)>this.flickDistance&&this.fastFlick||Math.abs(e)>this.swipeDistance},handleTouchMove:function(){var e=this.endX-this.startX;this.slidingElementContainer.addClass("snap-position"),this.isSwipeOrFlick(e)?(this.swipe=!0,e>0?(this.transformFunction(this.snapInterval),this.swipeDirection="right"):(this.transformFunction(-this.snapInterval),this.swipeDirection="left")):this.transformFunction(0)},touchEnd:function(){this.enableTouchMove&&this.handleTouchMove(),this.enableTouchMove=!1},setSnapInterval:function(e){this.snapInterval=window.document.documentElement.clientWidth*(1+e)},swipeEnd:function(){e.pubsub.emit("touchmove:"+this.swipeDirection),this.transformFunction(0),this.swipe=!1},transitionEnd:function(){this.slidingElementContainer.removeClass("snap-position"),this.swipe&&this.swipeEnd(),e.pubsub.emit("touch:end")},handleResize:function(){this.setSwipeDistance(),this.setSnapInterval(this.spaceBetweenItemsRatio)},bindEvents:function(){this.container.on("touchstart",n.proxy(function(e){this.touchStart(e)},this)),this.container.on("touchmove",n.proxy(function(e){e.preventDefault(),this.touchMove(e)},this)),this.container.on("touchend",n.proxy(function(){this.touchEnd()},this)),n(window).on("resize",n.proxy(function(e){this.handleResize()},this)),this.slidingElementContainer.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",n.proxy(function(){this.transitionEnd()},this))},setSwipeDistance:function(){this.swipeDistance=window.document.documentElement.clientWidth*this.swipeDistanceRatio},transform3d:function(e){this.slidingElementContainer.css("transform","translate3d("+e+"px,0,0)")},transform:function(e){this.slidingElementContainer.css("transform","translateX("+e+"px)")},positionLeft:function(e){this.slidingElementContainer.css("left",e)},setTransformFunction:function(){return this.canTransform3d=!1,t.can("CssTransform3d")?(this.canTransform3d=!0,this.transform3d):t.can("CssTransform")?this.transform:(n("body").addClass("no-translate"),this.positionLeft)},config:function(e){this.container=n(e.touchEventContainer),this.slidingElementContainer=n(e.slidingElementContainer),this.swipeDistanceRatio=.5,this.flickDistance=30,this.flickTime=250,this.setSwipeDistance(),this.spaceBetweenItemsRatio=e.spaceBetweenItemsRatio,this.setSnapInterval(this.spaceBetweenItemsRatio)},handleTouchEventsSupport:function(e){this.config(e),this.transformFunction=this.setTransformFunction(),this.canTransform3d&&this.transform3d(0),this.enableTouchMove=!1,this.bindEvents(),n("html").addClass("swipe-on")},init:function(e){t.can("TouchEvents")&&this.handleTouchEventsSupport(e)}};return r}),define("module/pictureViewer",["module/bootstrap","module/featureDetector","vendor/lo-dash/lo-dash","module/touchEvents","module/urlShrinker"],function(e,t,n,r,i){var s=e.$,o,u,a={global:null,body:s(".direction"),request:function(t,n){s.ajax({url:e.config.pathPrefix+"/api/pictures/"+t,type:"get",dataType:"json",success:function(t){n&&n(),e.pubsub.emit("pictureViewer:loaded",[t])}}),this.pictureViewerRequested=!0},loadViewer:function(e){this.body.append(e.body),r.init({touchEventContainer:"#picture-viewer",slidingElementContainer:".picture-viewer__pictures",spaceBetweenItemsRatio:.2}),this.pictureViewer=s("#picture-viewer"),this.pictureContainer=s(".picture-viewer__pictures")},setHeightToFillScreen:function(){s(".image-container").height(this.browserHeight)},setImageHeight:function(e,t){e.element.css({height:t})},setImageMaxWidth:function(e,t){e.element.css({"max-width":t+"px"})},getWindowMeasurements:function(){var e=this.doc.documentElement;this.browserHeight=e.clientHeight,this.browserWidth=e.clientWidth,this.browserRatio=this.browserWidth/this.browserHeight},calculateDimensions:function(e){var t=e.height,n=e.width,r=e.ratio,i=1/r,s={};return e.element.attr("style",""),n>this.browserWidth&&t>this.browserHeight?r>this.browserRatio?(s.maxWidth=this.browserWidth,s.height=i*this.browserWidth):(s.height=this.browserHeight,s.maxWidth=r*this.browserHeight):n>this.browserWidth?s.height=i*this.browserWidth:t>this.browserHeight?(s.maxWidth=r*this.browserHeight,s.height=this.browserHeight):(s.maxWidth=n,s.height=t),s},handleImageCalculations:function(){o(),this.setImageDimensions(this.image,this.calculateDimensions(this.image)),u()},setImageDimensions:function(e,t){t.maxWidth&&this.setImageMaxWidth(e,t.maxWidth),t.height&&this.setImageHeight(e,t.height)},replaceDivWithImage:function(e,t){var n=e.element;if(!n.hasClass("image--placeholder"))return;n.replaceWith('<img src="'+n.attr("data-hq-src")+'" id="'+n.attr("id")+'" width="'+n.attr("data-width")+'" height="'+n.attr("data-height")+'" class="image">'),e.element=s(".image").eq(t)},calculateImageData:function(){this.images=s(".image").map(function(){var e=s(this),t=e.attr("data-width"),n=e.attr("data-height");return{element:e,width:t,height:n,ratio:t/n}}),this.numberOfImages=this.images.length,this.imageContainers=s(".picture")},toggleViewerVisibility:function(e){this.pictureViewer&&this.pictureViewer.length?this.pictureViewer.toggleClass("hidden"):(this.loadViewer(e),this.calculateImageData(),this.getWindowMeasurements(),this.setHeightToFillScreen())},handleResize:function(){this.getWindowMeasurements(),this.setHeightToFillScreen(),this.handleImageCalculations()},toggleViewerEvent:function(){var t=s("html"),n="picture-viewer-enable";t.hasClass(n)?(t.removeClass(n),s(this.global).off("resize",s.proxy(this.handleResize,this)),e.pubsub.emit("pictureViewer:close")):(t.addClass(n),s(this.global).on("resize",s.proxy(this.handleResize,this)),e.pubsub.emit("pictureViewer:open"))},toggleViewer:function(e){this.toggleViewerVisibility(e),this.toggleViewerEvent(),this.changeImage(),this.updatePaginationText()},handlePictureInteraction:function(){var e=s("#js-photos").attr("data-asset-id");this.pictureViewerRequested?this.toggleViewer(""):this.request(e)},createGalleryHeadline:function(e){this.pictureViewer.find(".picture__information").prepend('<h3 class="picture__headline">'+this.galleryHeadline+"</h3>")},toggleCaptionButtonText:function(){var e=s(".picture-viewer__button--captions").find("span");e.toggleClass("show")},getPrevPictureNumber:function(){var e=this.numberOfImages;return this.currentPictureNumber!==0&&(e=this.currentPictureNumber),e-1},getNextPictureNumber:function(){var e=this.currentPictureNumber+1;return this.currentPictureNumber===this.numberOfImages-1&&(e=0),e},paginate:function(e){var t="getNextPictureNumber",n=0;e==="left"&&(t="getPrevPictureNumber"),this.currentPictureNumber=this[t](),this.setHash(this.currentPictureNumber+1)},updatePaginationText:function(){s(".picture__picture-no").text(this.currentPictureNumber+1),s(".picture__picture-total").text(this.numberOfImages)},handleStats:function(t){var n=[];t.visibility&&n.push(t.visibility),s("#asset-type-pgl").length&&(n.push(t.targetClass.indexOf(t.selector)!==-1?t.position:t.defaultPosition),e.pubsub.emit(t.pubsubEvent,n))},statsBackButton:function(e){this.handleStats({position:"top",selector:"picture-viewer__button--back",defaultPosition:"bottom",pubsubEvent:"gallery:viewer:toggle",targetClass:e.target.className})},statsShowImageOnlyButton:function(){var t=this.pictureViewer.hasClass("show-image-only")?"on":"off";e.pubsub.emit("gallery:imageonly:toggle",[t])},statsCaptionButton:function(){var t=this.pictureViewer.hasClass("hide-captions")?"off":"on";e.pubsub.emit("gallery:caption:toggle",[t])},statsNavigation:function(e){this.handleStats({position:"left",selector:"picture-viewer__pagination--left",defaultPosition:"right",visibility:t.is("TouchDevice")?"off":"on",pubsubEvent:"gallery:paginate:click",targetClass:e&&e.target?e.target.className:""})},processPictureViewer:function(e,t){this.galleryHeadline=t,this.currentPictureNumber=e-1,this.handlePictureInteraction()},handlePaginateEvent:function(e,t){this.enableHiddenButtons&&(this.paginate(t),this.changeImage(),this.updatePaginationText(),this.statsNavigation(e)),this.enableHiddenButtons=!0},handleRemovalOfCoveringScreen:function(){var e=s("#js-hidegallery");e.length&&window.setTimeout(function(){e.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){e.remove()}),t.can("CssTransition")||e.remove(),e.addClass("hidden-content--visible")},0)},handleTurningHiddenButtonsOff:function(){this.enableHiddenButtons=!1},handleTurningHiddenButtonsOn:function(){this.enableHiddenButtons=!0},handlePictureSlidingRight:function(){this.paginate("right"),this.changeImage()},handlePictureSlidingLeft:function(){this.paginate("left"),this.changeImage()},handlePictureViewerLoaded:function(t){this.toggleViewer(t),this.createGalleryHeadline(),this.shareTools=this.pictureViewer.find(".share"),this.handleBackButtonFunctionality(),this.pictureViewer.on("click","#js-prev-picture",s.proxy(this.handleMovingToPrevPicture,this)),this.pictureViewer.on("click","#js-next-picture",s.proxy(this.handleMovingToNextPicture,this)),this.pictureViewer.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",s.proxy(this.updatePaginationText,this)),s(document).on("keydown",s.proxy(this.emitKeyEvents,this)),s(".picture-viewer__button--captions").on("click",s.proxy(this.handleTogglingCaptions,this)),s(".picture-viewer__show-image-only").on("click",s.proxy(this.handleTogglingUI,this)),s(".picture-viewer__button--grid").on("click",s.proxy(this.handleGoingBackToTheGrid,this)),s(".share__button").on("click",s.proxy(this.handleTogglingShareToolsVisibility,this)),i.find("#picture-viewer .shortenUrl").bindEvents(),e.pubsub.emit("pictureViewer:loadcomplete",[t])},emitKeyEvents:function(t){t.keyCode===37?e.pubsub.emit("key:left"):t.keyCode===39?e.pubsub.emit("key:right"):t.keyCode===27?e.pubsub.emit("key:escape"):t.keyCode===13&&e.pubsub.emit("key:enter")},handleTogglingCaptions:function(){this.shareTools.hasClass("share--visible")&&this.shareTools.hasClass("share--sliding")&&this.handleTogglingShareToolsVisibility(),this.pictureViewer.toggleClass("hide-captions"),this.toggleCaptionButtonText(),this.statsCaptionButton()},handleTogglingUI:function(){this.enableHiddenButtons&&(this.pictureViewer.toggleClass("show-image-only"),this.statsShowImageOnlyButton()),this.enableHiddenButtons=!0},handleMovingToPrevPicture:function(e){this.handlePaginateEvent(e,"left")},handleMovingToNextPicture:function(e){this.handlePaginateEvent(e,"right")},handleGoingBackToTheGrid:function(e){this.toggleViewerVisibility(),this.toggleViewerEvent(),this.setHash(""),this.statsBackButton(e)},handleBackButtonFunctionality:function(){var e=s(".picture-viewer__button--back");this.global.history.length===1?e.remove():e.on("click",s.proxy(this.goBack,this))},goBack:function(){this.global.history.back()},handleTogglingShareToolsVisibility:function(){!this.pictureViewer.hasClass("hide-captions")&&this.shareTools.hasClass("share--sliding")&&this.handleTogglingCaptions(),this.shareTools.toggleClass("share--visible")},bindEvents:function(){e.pubsub.on("gallery:picture:click",s.proxy(this.processPictureViewer,this)),e.pubsub.on("pictureViewer:open",s.proxy(this.handleRemovalOfCoveringScreen,this)),e.pubsub.on("touch:move",s.proxy(this.handleTurningHiddenButtonsOff,this)),e.pubsub.on("touch:end",s.proxy(this.handleTurningHiddenButtonsOn,this)),e.pubsub.on("touchmove:left",s.proxy(this.handlePictureSlidingRight,this)),e.pubsub.on("touchmove:right",s.proxy(this.handlePictureSlidingLeft,this)),e.pubsub.on("pictureViewer:loaded",s.proxy(this.handlePictureViewerLoaded,this)),e.pubsub.on("key:left",s.proxy(this.handleMovingToPrevPicture,this)),e.pubsub.on("key:right",s.proxy(this.handleMovingToNextPicture,this)),e.pubsub.on("key:escape",s.proxy(this.goBack,this)),e.pubsub.on("key:enter",s.proxy(this.handleTogglingCaptions,this))},setPictureClasses:function(e,t){this.imageContainers.removeClass("picture--before-current"),this.imageContainers.removeClass("picture--current"),this.imageContainers.removeClass("picture--after-current"),this.imageContainers.eq(e).addClass("picture--before-current"),this.imageContainers.eq(this.currentPictureNumber).addClass("picture--current"),this.imageContainers.eq(t).addClass("picture--after-current")},setImages:function(){var e=this.getPrevPictureNumber(),t=this.getNextPictureNumber();this.prevImage=this.images.eq(e)[0],this.image=this.images.eq(this.currentPictureNumber)[0],this.nextImage=this.images.eq(t)[0],this.setPictureClasses(e,t),this.setHash(this.currentPictureNumber+1)},changeImage:function(){this.setImages(),this.handleImageCalculations(),this.replaceDivWithImage(this.prevImage,this.getPrevPictureNumber()),this.replaceDivWithImage(this.image,this.currentPictureNumber),this.replaceDivWithImage(this.nextImage,this.getNextPictureNumber()),this.handleImageCalculations()},checkTouchSupport:function(){t.is("TouchDevice")||s("body").addClass("no-touch")},withinValidRange:function(e){return e>0&&e<=s(".photo").length},updateShareToolsUrl:function(){var e=this.stripHashCharacter();this.pictureViewer.find(".share__tool a").each(function(t,n){var r=n.href.replace(/%23$|%23\d+$|$/i,"%23"+e),i=n.getAttribute("data-target-url"),s=i?i.replace(/#$|#\d+$|$/i,"#"+e):null;n.href=r,n.setAttribute("data-target-url",s)})},stripHashCharacter:function(){return this.global.location.hash.slice(1)},checkHash:function(e){e=this.stripHashCharacter(),e=this.global.parseInt(e),this.withinValidRange(e)&&this.processPictureViewer(e,s("h1").html())},setHash:function(e){this.global.location.replace("#"+e),this.updateShareToolsUrl()},checkDevice:function(){t.is("IE10")&&s("body").addClass("ie10"),t.is("WindowsPhone")&&s("body").addClass("windows-phone")},init:function(e){this.global=e||window,this.doc=this.global.document,this.checkDevice(),this.pictureViewerRequested=!1,this.enableHiddenButtons=!0,this.currentPictureNumber=0,this.checkTouchSupport(),this.bindEvents()}};return o=n.debounce(function(){a.setImageDimensions(a.prevImage,a.calculateDimensions(a.prevImage))},100),u=n.debounce(function(){a.nextImage&&a.setImageDimensions(a.nextImage,a.calculateDimensions(a.nextImage))},100),a}),define("module/pictureGallery",["module/bootstrap","deviceInspector","vendor/lo-dash/lo-dash","module/pictureViewer"],function(e,t,n,r){var i=e.$,s,o={setConfigProperties:function(){this.threshold=t.getType()==="smart"?150:200,this.gutter=parseInt(i(".photo").eq(0).css("margin-left"),10),this.containerWidth=i("#js-photos").width()},getImages:function(){return i(".photos img")},getListOfImageRatios:function(e){return i.map(e,function(e){return e=i(e),{element:e[0],ratio:e.attr("width")/e.attr("height")}})},addArrayElements:function(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n];return t},calculateRowLength:function(e){var t;return t=i.map(e,function(e){return e.ratio}),Math.ceil(this.addArrayElements(t)*this.threshold)},setRowHeight:function(e,t){i.each(e,function(e,n){i(n.element).css({height:t+"px",width:Math.floor(n.ratio*t)+"px"})})},calculateAvailableWidth:function(e){var t;return t=this.gutter*e,this.containerWidth-t},calculateRowHeight:function(e,t){return Math.floor(this.threshold/e*t)-1},processImageRowsRecursively:function(e){var t,n,r,i,s=1;while(s<=e.length)t=this.calculateRowLength(e.slice(0,s)),n=this.calculateAvailableWidth(s),t>n&&(r=this.calculateRowHeight(t,n),i=e.splice(0,s),this.setRowHeight(i,r),this.processImageRowsRecursively(e)),s+=1;e.length&&this.setRowHeight(e,this.threshold)},calculateImages:function(){var e=this.allImages.slice(0);this.processImageRowsRecursively(e),i("#js-photos").addClass("grid-layout-complete")},storeImage:function(){o.loadedImages.push(this),e.pubsub.emit("image:stored")},processLoadedImages:function(){var e;while(e=this.loadedImages.shift())i(e).addClass("image-loaded")},isImageCached:function(){this.complete&&i(this).trigger("load")},checkHash:function(){window.location.hash&&e.pubsub.emit("pictureGallery:hashchange",[window.location.hash])},bindEvents:function(){e.pubsub.on("image:stored",i.proxy(this.processLoadedImages,this)),e.pubsub.on("pictureGallery:hashchange",i.proxy(r.checkHash,r)),i(".photos img").one("load",o.storeImage).each(this.isImageCached),i(".photos img").on("click",function(){e.pubsub.emit("gallery:picture:click",[this.getAttribute("data-photo-no"),i("h1").html()])}),i(window).on("resize",s),e.pubsub.on("pictureViewer:open",i.proxy(function(){i(window).off("resize",s)},this)),e.pubsub.on("pictureViewer:close",i.proxy(function(){this.setConfigProperties(),this.calculateImages(this.allImages),i(window).on("resize",s)},this))},init:function(){r.init(),this.loadedImages=[],this.allImages=this.getListOfImageRatios(this.getImages()),this.imageCount=this.allImages.length,this.setConfigProperties(),this.calculateImages(),this.bindEvents(),this.checkHash()}};return s=n.debounce(function(){o.setConfigProperties(),o.calculateImages(o.allImages)},50),o}),define("module/shareTools",["module/bootstrap","deviceInspector"],function(e,t){return{init:function(){var n,r,i,s,o=e.$;t.getType()==="desktop"&&(r=o(".share"),i=this,n=o(".share__tool--facebook a",r),n.on("click",function(e){e.preventDefault(),i.openSharePopup("Facebook",n)}),s=o(".share__tool--twitter a",r),s.on("click",function(e){e.preventDefault(),i.openSharePopup("Twitter",s)}))},openSharePopup:function(e,t){e==="Facebook"?window.open(t.attr("href"),"Facebook_Share","width=650,height=280"):e==="Twitter"&&window.open(t.attr("href"),"Twitter_Share","width=550,height=420")}}}),define("module/story",["module/bootstrap","module/timestamp","module/imageenhancer","module/transclude","module/media/mediaHandler","config"],function(e,t,n,r,i,s){return{init:function(){var o=new t((new Date((new Date).toUTCString())).getTime()),u=new n(".story-body img"),a=new r;e.$(".column--primary > .share--lightweight").toggleClass("show"),e.$(".column--primary > .share__title--lightweight").show();if(s.features.video){var f=new i({audio:!1});f.createMedia()}}}}),define("vendor/locator/autoCompleteView",["module/bootstrap"],function(e){var t,n,r,i;return t=e.$,r=2,i=500,n=function(){var n=this;this.inputHasFocus=!1,this.hasMouseDown=!1,this.$searchResults=null,this.highlightedSearchResultIndex=null,this.input=document.getElementById("locator-search-input"),this.$input=t("#locator-search-input"),this.$input.attr("autocomplete","off"),this.keyCode={enter:13,escape:27,upArrow:38,downArrow:40},this.input&&(this.$input.on("focus.locatorAutoCompleteInput",function(e){n.startInteraction(),e.preventDefault()}),this.$input.on("blur.locatorAutoCompleteInput",function(e){n.hasMouseDown||n.stopInteraction(),e.preventDefault()})),e.pubsub.on("locator:autoCompleteSearchResults",function(e){n.inputHasFocus&&(n.stopWaitingForRequest(),n.renderSearchResults(e))}),e.pubsub.on("locator:renderChangePrompt",function(e){n.inputHasFocus&&(n.stopInteraction(),n.currentSearchTerm=null)}),e.pubsub.on("locator:error",function(e,t){"autocomplete"===t&&n.stopWaitingForRequest(),e&&e.flagpoles&&!e.flagpoles.autoComplete&&(n.stopInteraction(),n.$input.off("focus.locatorAutoCompleteInput"),n.$input.off("blur.locatorAutoCompleteInput"))})},n.prototype.checkInput=function(){var t,n,r;t=this,n=this.prepareSearchTerm(this.input.value),r=this.isValidSearchTerm(n);if(!r)return this.$searchResults&&(this.clearInputChangedTimeout(),this.clearSearchResults()),this.currentSearchTerm=n,!1;if(this.currentSearchTerm===n||null!==this.highlightedSearchResultIndex)return!1;this.currentSearchTerm=n,this.clearInputChangedTimeout(),this.inputChangedTimeoutId=setTimeout(function(){e.pubsub.emit("locator:submitAutoCompleteSearch",[n]),t.startWaitingForRequest()},i)},n.prototype.prepareSearchTerm=function(e){return String(e).replace(/^\s\s*/,"").replace(/\s\s*$/,"")},n.prototype.isValidSearchTerm=function(e){var t,n;return"string"!=typeof e?!1:(t=this.prepareSearchTerm(e),n=t.length>=r,n?!0:!1)},n.prototype.renderSearchResults=function(e){var n,r,i,s;n=this,this.searchResultsData=e,s=e.results.length;if(0===s){this.clearSearchResults();return}null===this.$searchResults&&(t("body").append('<ul id="locator-autocomplete-results"></ul>'),this.$searchResults=t("#locator-autocomplete-results"),this.$searchResults.on("mouseover","li",function(e){n.highlightSearchResultByIndex(t(this).index(),!1)}).on("mouseout","li",function(e){n.searchResultMouseOutHandler(e.target)}),this.positionSearchResults(),this.addSearchResultClickListener(),n.addSearchResultKeyHandler()),r="";for(i=0;i<s;i++)r+="<li>"+e.results[i].fullName+"</li>";this.$searchResults.html(r)},n.prototype.clearSearchResults=function(){this.searchResultsData=null,this.highlightedSearchResultIndex=null,this.$searchResults&&(this.$searchResults.remove(),this.$searchResults=null,this.removeSearchResultKeyHandler())},n.prototype.addSearchResultKeyHandler=function(){var e;this.removeSearchResultKeyHandler(),e=this,t(document).on("keydown.locatorAutoCompleteSearchResults",function(t){e.keyDownHandler(t)})},n.prototype.removeSearchResultKeyHandler=function(){t(document).off("keydown.locatorAutoCompleteSearchResults")},n.prototype.keyDownHandler=function(e){switch(e.keyCode){case this.keyCode.escape:this.escapeKeyHandler();break;case this.keyCode.enter:this.enterKeyHandler(e);break;case this.keyCode.upArrow:e.preventDefault(),this.highlightPrevSearchResult();break;case this.keyCode.downArrow:this.highlightNextSearchResult();break;default:}},n.prototype.escapeKeyHandler=function(){null!==this.highlightedSearchResultIndex&&this.$input.val(this.currentSearchTerm),this.clearSearchResults()},n.prototype.enterKeyHandler=function(e){null!==this.highlightedSearchResultIndex&&(e.preventDefault(),this.submitSearchResultByIndex(this.highlightedSearchResultIndex)),this.clearInputChangedTimeout(),this.clearSearchResults()},n.prototype.highlightNextSearchResult=function(){var e;e=this.highlightedSearchResultIndex;if(null===e)e=0;else{e++;if(this.searchResultsData.results.length<=e){this.removeSearchResultHighlight(!0);return}}this.highlightSearchResultByIndex(e,!0)},n.prototype.highlightPrevSearchResult=function(){var e;e=this.highlightedSearchResultIndex;if(null===e)e=this.searchResultsData.results.length-1;else{e--;if(0>e){this.removeSearchResultHighlight(!0);return}}this.highlightSearchResultByIndex(e,!0)},n.prototype.highlightSearchResultByIndex=function(e,n){var r;this.removeSearchResultHighlight(),r=this.searchResultsData.results[e],this.highlightedSearchResultIndex=e,t(this.$searchResults.find("li")[e]).addClass("active"),n&&this.$input.val(r.fullName)},n.prototype.removeSearchResultHighlight=function(e){this.highlightedSearchResultIndex=null,this.$searchResults.find("li.active").removeClass("active"),e&&this.$input.val(this.currentSearchTerm)},n.prototype.searchResultMouseOutHandler=function(e){t(e).removeClass("active")},n.prototype.addSearchResultClickListener=function(){var t,n,r;t=this,this.$searchResults.on("mousedown",function(n){t.hasMouseDown=!0,e.$("body").one("mouseup",function(e){t.bodyMouseUpHandler(e)})})},n.prototype.bodyMouseUpHandler=function(e){var n,r;this.hasMouseDown=!1,this.$searchResults.find(e.target).length&&(r=t(e.target).index(),this.submitSearchResultByIndex(r)),this.clearSearchResults()},n.prototype.submitSearchResultByIndex=function(t){var n;n=this.searchResultsData.results[t],this.$input.val(n.fullName),e.pubsub.emit("locator:submitAutoCompleteLocation",[n.id,n.name])},n.prototype.positionSearchResults=function(){var e;e=this.$input.offset(),this.$searchResults.css({left:parseInt(e.left,0),top:parseInt(e.top,0)+this.$input.outerHeight()})},n.prototype.startInteraction=function(){var e=this;this.inputHasFocus=!0,this.$input.on("keyup",function(){e.checkInput()})},n.prototype.stopInteraction=function(){var e;e=this.$input.val(),null!==this.highlightedSearchResultIndex&&e!==this.currentSearchTerm&&(this.currentSearchTerm=e),this.clearInputChangedTimeout(),this.clearSearchResults(),this.stopWaitingForRequest(),this.$input.off("keyup"),this.inputHasFocus=!1},n.prototype.startWaitingForRequest=function(){this.$input.addClass("waiting")},n.prototype.stopWaitingForRequest=function(){this.$input.removeClass("waiting")},n.prototype.clearInputChangedTimeout=function(){this.inputChangedTimeoutId&&(clearTimeout(this.inputChangedTimeoutId),this.inputChangedTimeoutId=null)},n}),define("vendor/locator/bootstrap",["jquery","vendor/events/pubsub"],function(e){var t={pubsub:e,$:e,ajax:e.ajax};return t}),define("vendor/locator/locatorView",["module/bootstrap"],function(e){var t,n,r;return t="/locator/default/mobile/en-GB/confirm/",r=function(e){if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},n=function(t,n){var i=this,s='<div id="locator"><form id="locator-form" action="#">';n=n||{},typeof n.pubsub!="undefined"&&(e.pubsub=n.pubsub),this.inputPlaceholderMessage="Enter a UK town or postcode",this.autoCompleteEnabled=!1,!0===n.enableAutoComplete&&(this.autoCompleteEnabled=!0),this.supportsGeoLocation=!1,typeof navigator.geolocation!="undefined"&&n.enableReverseGeocode!==!1&&(this.geoLocationEnabled=!0,this.supportsGeoLocation=!0),this.supportsGeoLocation&&window.locator&&window.locator.disableGeoLocation&&(this.supportsGeoLocation=!1),this.supportsGeoLocation&&(s+='<a href="" id="locator-geolocation"><span class="link-text">Use my current location</span><span class="crosshair"></span></a><p id="geolocation-error"></p>'),s+='<div id="locator-search-container"><span class="locator-search-input"><label for="locator-search">Search Term</label><input id="locator-search-input" name="locator-search" type="text"/></span><input name="locator-submit" class="submit" type="submit" value="Search"/><button id="locator-submit" value="Search">Search <span class="magnifier"></span></button></div></form><p id="locator-message-search"/><ul id="locator-results"></ul><a id="locator-results-more" href="">Show More</a><a id="locator-prompt-change" href="">Change your location<span class="crosshair"></span></a></div>',e.$(t).append(s),this.elm=document.getElementById("locator"),this.form=document.getElementById("locator-form"),this.searchMessage=document.getElementById("locator-message-search"),this.changePrompt=document.getElementById("locator-prompt-change"),this.input=document.getElementById("locator-search-input"),this.results=document.getElementById("locator-results"),this.moreResults=document.getElementById("locator-results-more"),this.supportsPlaceholder=typeof this.input.placeholder!="undefined",this.supportsPlaceholder?this.input.placeholder=this.inputPlaceholderMessage:(this.inputFocusHandler=function(e){i.inputPlaceholderMessage===i.input.value&&(i.input.value="")},this.inputBlurHandler=function(e){""===i.input.value&&(i.input.value=i.inputPlaceholderMessage)},this.createEventListener(this.input,"focus",this.inputFocusHandler,!1),this.createEventListener(this.input,"blur",this.inputBlurHandler,!1)),this.autoCompleteView=null,this.autoCompleteEnabled&&require(["locator/autoCompleteView"],function(e){i.autoCompleteView=new e}),this.geolocation=null,this.supportsGeoLocation&&(this.geolocation=e.$("#locator-geolocation")[0],this.geolocationMessage=e.$("p#geolocation-error")[0]),this.formHandler=function(e){var t=i.input.value;return 0<t.length&&(i.input.blur(),i.clearResults(),i.sendSearchData(t.toLowerCase(),0)),r(e),!1},this.createEventListener(this.form,"submit",this.formHandler,!1),this.resultsHandler=function(t){var n,s,o,u,a;return r(t),n=t.target||t.srcElement,n.blur(),s=n.href,e.$("li",this).removeClass("selected"),e.$(n).parent("li").addClass("selected"),s&&0<s.length&&(a=s.match(/confirm\/(\w{0,2}\d+)\/?(\w+)?/),3===a.length&&(u=a[2]),2<=a.length&&(o=a[1],i.sendLocationData(o,u))),!1},this.createEventListener(this.results,"click",this.resultsHandler,!1),this.moreResultsHandler=function(t){r(t),i.moreResultsEnabled&&(e.$("#locator-results-error").remove(),i.disableMoreResults(),i.sendSearchData(i.currentResults.searchTerm,i.currentResults.offset+i.currentResults.limit))},this.createEventListener(this.moreResults,"click",this.moreResultsHandler,!1),this.supportsGeoLocation&&(this.geolocationClickHandler=function(t){r(t),i.geoLocationEnabled&&(i.clearResults(),i.disableGeolocation("active"),navigator.geolocation.getCurrentPosition(function(t){e.pubsub.emit("locator:geoLocation",[t])},function(e){var t="We were unable to detect your location.";e.code===e.PERMISSION_DENIED&&(t="Please enable Location Services in your device settings or browser"),i.setMessage(i.geolocationMessage,t,"error"),i.enableGeolocation()},{enableHighAccuracy:!0,maximumAge:60,timeout:1e4}))},this.createEventListener(this.geolocation,"click",this.geolocationClickHandler,!1)),this.createEventListener(this.changePrompt,"click",function(t){e.pubsub.emit("locator:changeLocationPrompt"),i.renderForm(),r(t)},!1),e.pubsub.on("locator:searchResults",function(e){i.renderSearchResults(e)}),e.pubsub.on("locator:newsLocalRegions",function(e){i.renderNewsLocalRegions(e)}),e.pubsub.on("locator:locationOutOfContext",function(e){i.setMessage(i.searchMessage,null),i.setMessage(i.geolocationMessage,"Sorry, location setting is not available for your location","error")}),e.pubsub.on("locator:renderForm",function(){i.renderForm()}),e.pubsub.on("locator:renderChangePrompt",function(){i.renderStopWait(),i.resetForm(),i.renderChangePrompt()}),e.pubsub.on("locator:renderWait",function(){i.renderWait()}),e.pubsub.on("locator:error",function(e,t){i.renderError(e,t)})},n.prototype.sendSearchData=function(t,n){e.pubsub.emit("locator:submitSearch",[t,n])},n.prototype.sendLocationData=function(t,n){e.pubsub.emit("locator:submitLocation",[t,n])},n.prototype.close=function(){this.elm.parentNode.removeChild(this.elm)},n.prototype.clearResults=function(){this.setMessage(this.searchMessage,null),this.setMessage(this.geolocationMessage,null),this.currentResults=null,this.results.innerHTML="",this.setMoreResultsDisplay("none")},n.prototype.renderChangePrompt=function(){this.setFormIsShown(!1),this.setChangePromptIsShown(!0)},n.prototype.renderForm=function(){this.setFormIsShown(!0),this.setChangePromptIsShown(!1),this.resetForm()},n.prototype.renderGeolocationResult=function(e){var t;this.resetForm(),this.setMessage(this.searchMessage,"Your location"),t='<li class="selected"><a href="#">'+e.name+"</a></li>",this.results.innerHTML=t,this.results.display=""},n.prototype.resetForm=function(){this.input.value=this.supportsPlaceholder?"":this.inputPlaceholderMessage,this.clearResults(),this.setMessage(this.searchMessage,null),this.enableGeolocation()},n.prototype.disableForm=function(){this.destroyEventListener(this.form,"submit",this.formHandler),this.createEventListener(this.form,"submit",function(e){return r(e),!1},!1),e.$("#locator-search-container").addClass("disabled"),e.$(this.input).attr("disabled",!0)},n.prototype.setFormIsShown=function(e){var t;t=e?"block":"none",this.form.style.display=t},n.prototype.setChangePromptIsShown=function(e){this.changePrompt.style.display=e?"block":"none"},n.prototype.enableMoreResults=function(){this.moreResultsEnabled=!0,e.$(this.moreResults).removeClass("disabled")},n.prototype.disableMoreResults=function(){this.moreResultsEnabled=!1,e.$(this.moreResults).addClass("disabled")},n.prototype.enableGeolocation=function(){this.geoLocationEnabled=!0,e.$(this.geolocation).removeClass("active")},n.prototype.disableGeolocation=function(t){this.geoLocationEnabled=!1,t=t||"disabled",e.$(this.geolocation).addClass(t)},n.prototype.setMessage=function(e,t,n){e&&(typeof n=="string"&&n.length>0&&(e.className=n),e.style.display=null===t||""===t?"none":"block",e.innerHTML=t)},n.prototype.setMoreResultsDisplay=function(e){e=e||"",this.moreResults.style.display=e},n.prototype.renderError=function(t,n){var r="Sorry an error has occurred, please try again";"autocomplete"!==n&&this.renderStopWait();if(t&&t.flagpoles){if(!t.flagpoles.locator){this.clearResults(),this.disableForm(),this.disableGeolocation(),this.setMessage(this.searchMessage,"Sorry location setting is not currently available","error");return}if(!t.flagpoles.reverseGeocode){this.disableGeolocation(),this.setMessage(this.geolocationMessage,'Sorry the "use my current location" feature is not currently available',"error");if("geolocate"===n)return}}"geolocate"===n?(this.setMessage(this.geolocationMessage,"Sorry an error occurred trying to detect your location. Please try again","error"),this.enableGeolocation()):"search"===n&&this.currentResults?e.$(this.moreResults).after('<p id="locator-results-error" class="error">'+r+"</p>"):"autocomplete"!==n&&this.setMessage(this.searchMessage,r,"error")},n.prototype.renderWait=function(){this.currentResults||this.setMessage(this.searchMessage,"Please wait...")},n.prototype.renderStopWait=function(){this.currentResults||this.setMessage(this.searchMessage,null)},n.prototype.renderSearchResults=function(n){var r,i,s="",o=t,u="?ptrt="+window.location,a=!1,f="";this.currentResults=n,this.renderStopWait(),this.enableGeolocation();if(0===n.results.length)this.setMessage(this.searchMessage,'There were no results for "'+n.searchTerm+'"');else{this.setMessage(this.searchMessage,"Search results:");for(i=0;i<n.results.length;i++)r=n.results[i],f=n.results.length===1?' class="selected"':"",s+="<li"+f+">",s+='<a href="'+o+r.id+u+'">'+r.name+"</a></li>"}this.results.style.display="",0===n.offset?(this.results.innerHTML=s,this.setFocusOnFirstResult(),a=n.limit<n.total):(e.$(this.results).append(s),a=n.offset+n.limit<n.total),this.setMoreResultsDisplay(a?"block":"none"),a&&this.enableMoreResults()},n.prototype.renderNewsLocalRegions=function(e){var n,r,i="",s=t+e.location.id+"/",o="?ptrt="+window.location;this.renderStopWait(),this.enableGeolocation(),this.setMessage(this.searchMessage,"Your chosen location falls between two News Regions. To set your location, please select one of the regions below.");for(r=0;r<e.regions.length;r++)n=e.regions[r],i+='<li><a href="'+s+n.id+o+'">'+n.name+"</a></li>";this.results.style.display="",this.results.innerHTML=i,this.setFocusOnFirstResult()},n.prototype.setFocusOnFirstResult=function(){var t;t=e.$("#locator-results li a"),t.length>0&&t[0].focus()},n.prototype.createEventListener=function(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on"+t,n)},n.prototype.destroyEventListener=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on"+t,n)},n}),define("vendor/locator/stats",["vendor/istats/istats"],function(e){var t,n;return t=function(e,t){n=e,typeof t=="function"&&(this.logEvent=t)},t.prototype.logEvent=function(n,r){r=r||{},r.screen=t.isMDot(document.location.hostname)?"mobile":"desktop",e.log(n,"locator",r)},t.prototype.applyEvents=function(){var e;e=this,n.on("locator:open",function(){e.logEvent("open",{supports_geolocation:typeof navigator.geolocation!="undefined"?1:0,has_locserv_cookie:t.hasLocation()})}),n.on("locator:changeLocationPrompt",function(){e.logEvent("open")}),n.on("locator:geoLocation",function(t){e.logEvent("geo_location",{latitude:t.coords.latitude,longitude:t.coords.longitude})}),n.on("locator:searchResults",function(t){var n;if(t.total===0){e.logEvent("no_search_results",{ns_search_term:t.searchTerm});return}typeof t.offset=="undefined"&&(t.offset=0),typeof t.limit=="undefined"&&(t.limit=10),n={ns_search_term:t.searchTerm,offset:t.offset,page_num:(t.offset+t.limit)/t.limit},n.page_num>1?e.logEvent("more_results",n):e.logEvent("search",n)}),n.on("locator:submitAutoCompleteSearch",function(t){var n;n={ns_search_term:t},e.logEvent("autocomplete_search",n)}),n.on("locator:submitAutoCompleteLocation",function(t,n){var r;r={location_id:t,location_name:n},e.logEvent("autocomplete_click",r)}),n.on("locator:error",function(){e.logEvent("http_error")}),n.on("locator:locationChanged",function(t){var n;if(t===null)return;n={location_id:t.id,location_name:t.name},t.local_region&&(n.news_region=t.local_region),e.logEvent("confirm",n)}),n.on("locator:newsLocalRegions",function(t){var n,r,i;n={location_id:t.location.id,location_name:t.location.name},i=[];for(r in t.regions)t.regions.hasOwnProperty(r)&&i.push(t.regions[r].name);n.location_regions=i.join(", "),e.logEvent("news_local_regions",n)})},t.isMDot=function(e){return!!e.match(/^m\.([a-z\.]*)?bbc(\.co\.uk|\.com)$/)},t.getCookie=function(){return document.cookie},t.hasLocation=function(){var e;return e=this.getCookie().match("locserv=(.*?)(;|$)"),!e||e.length<2?!1:!0},t});